/*
 * File: app/view/MyViewport.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('M_COL_DISTB.view.MyViewport', {
	extend : 'Ext.container.Viewport',
	alias : 'widget.myviewport',

	requires : [ 
		'M_COL_DISTB.view.MyViewportViewModel', 
		'M_COL_DISTB.view.TbButton', 
		'Ext.form.Panel', 
		'Ext.form.FieldSet', 
		'Ext.form.FieldContainer', 
		'Ext.form.field.Text', 
		'Ext.grid.Panel', 
		'Ext.grid.column.RowNumberer', 
		'Ext.grid.column.Number', 
		'Ext.view.Table', 
		'Ext.selection.CheckboxModel', 
		'Ext.grid.plugin.Exporter', 
		'Ext.grid.plugin.CellEditing', 
		'Ext.resizer.Splitter', 
		'Ext.button.Button', 
		'Ext.grid.column.Date', 
		'Ext.grid.selection.SpreadsheetModel', 
	],

	viewModel : {
		type : 'myviewport'
	},
	height : 250,
	style : 'background-color: white',
	width : 400,

	layout : {
		type : 'vbox',
		align : 'stretch'
	},
	items : [ {
		xtype : 'toolbarBtn'
	}, {
		xtype : 'form',
		bodyPadding : '0 10 0 10',
		header : false,
		title : 'My Form',
		layout : {
			type : 'hbox',
			align : 'stretch'
		},
		items : [ {
			xtype : 'fieldset',
			flex : 0.4,
			height : 150,
			maxHeight : 150,
			minHeight : 150,
			margin : '0 3 0 0',
			scrollable : 'horizontal',
			title : '[ 담보등록정보1 ]',
			layout : {
				type : 'vbox',
				align : 'stretch',
				pack : 'center'
			},
			items : [ {
				xtype : 'fieldcontainer',
				layout : {
					type : 'hbox',
					align : 'stretch'
				},
				items : [ {
					xtype : 'textfield',
					maxWidth : 250,
					minWidth : 250,
					width : 250,
					fieldLabel : '담보번호',
					name : 'search_field',
					fieldStyle : 'background-color: #ffefbb',
					emptyText : '(Double Click)',
					id : 'V_MAST_DB_NO',
					listeners : {
						afterrender : function(c) {
							c.getEl().on('dblclick', function() {
								var popup = Ext.create("M_COL_DISTB.view.WinCollPop");

								popup.setSize(Ext.getBody().getViewSize());

								popup.center();
								popup.show();

								M_COL_DISTB.app.getController("ColPopController").w_colSelBtnClick();
								// Ext.getStore('ColStore').removeAll();
							});
						}
					},
					editable : false
				}, {
					xtype : 'textfield',
					id : 'V_PO_NO',
					margin : '0 0 0 30',
					maxWidth : 250,
					minWidth : 250,
					width : 250,
					fieldLabel : '<span style=\'color:red\'>*</span>발주번호',
					name : 'search_field',
					emptyText : '(Double Click)',
					listeners : {
						afterrender : function(c) {
							c.getEl().on('dblclick', function() {
								var popup = Ext.create("M_COL_DISTB.view.WinPoPop");

								popup.setSize(Ext.getBody().getViewSize());
								popup.show();

								var store = Ext.getStore('PopStore');

								M_COL_DISTB.app.getController("PoPopController").w_poSelBtnClick();
								//                                              
								// store.removeAll();
							});
						}
					}
				}, {
					xtype : 'combobox',
					flex : 1,
					id : 'V_COL_TYPE',
					margin : '0 0 0 30',
					maxWidth : 250,
					minWidth : 250,
					width : 250,
					fieldLabel : '<span style=\'color:red\'>*</span>담보유형',
					displayField : 'DTL_NM',
					valueField : 'DTL_CD',
					editable : false,
					hidden : true
				}, ]
			}, {
				xtype : 'fieldcontainer',
				layout : {
					type : 'hbox',
					align : 'stretch'
				},
				items : [ {
					xtype : 'datefield',
					maxWidth : 250,
					minWidth : 250,
					width : 250,
					fieldLabel : '<span style=\'color:red\'>*</span>설정일자',
					name : 'search_field',
					format : 'Y-m-d',
					listeners : {
						render : function(datefield) {
							var nows = new Date();
							datefield.setValue(nows);
						}
					},
					id : 'V_COL_DT'
				}, {
					xtype : 'textfield',
					margin : '0 0 0 30',
					maxWidth : 500,
					minWidth : 500,
					width : 500,
					fieldLabel : '<span style=\'color:red\'>*</span>거래진행명',
					name : 'search_field',
					id : 'V_COL_TITLE'

				}, {

					xtype : 'textfield',
					margin : '0 0 0 30',
					maxWidth : 240,
					minWidth : 240,
					width : 240,
					fieldLabel : '품의번호',
					name : 'search_field',
					id : 'V_APPROV_NO',
					hidden : true
				}, {

					xtype : 'textfield',
					fieldLabel : 'V_CLS_AR_NO',
					id : 'V_CLS_AR_NO',
					hidden : true
				} ]

			}, ]
		}, {
			xtype : 'fieldset',
			flex : 0.2,
			height : 150,
			maxHeight : 150,
			minHeight : 150,
			margin : '0 3 0 0',
			scrollable : 'horizontal',
			title : '[ 담보등록정보2 ]',
			layout : {
				type : 'vbox',
				align : 'stretch',
				pack : 'center'
			},
			items : [ {
				xtype : 'fieldcontainer',
				layout : {
					type : 'hbox',
					align : 'stretch'
				},
				items : [ {
					xtype : 'textfield',
					maxWidth : 300,
					minWidth : 300,
					width : 300,
					fieldLabel : '<span style=\'color:red\'>*</span>매입처',
					name : 'search_field',
					id : 'V_M_BP_NM',
					editable : false,
					labelWidth : 90
				}, {
					xtype : 'textfield',
					margin : '0 0 0 30',
					maxWidth : 300,
					minWidth : 300,
					width : 300,
					fieldLabel : 'M_BP_CD',
					name : 'search_field',
					id : 'V_M_BP_CD',
					hidden : true
				}, {
					xtype : 'textfield',
					maxWidth : 250,
					minWidth : 250,
					width : 250,
					margin : '0 0 0 30',
					fieldLabel : '설정가능담보금액',
					labelWidth : 110,
					name : 'search_field',
					fieldStyle : 'text-align: right',
					id : 'V_COL_AVL_AMT',
					hidden : true
				},

				]
			}, {
				xtype : 'fieldcontainer',
				layout : {
					type : 'hbox',
					align : 'stretch'
				},
				items : [ {
					xtype : 'textfield',
					maxWidth : 300,
					minWidth : 300,
					width : 300,
					fieldLabel : '<span style=\'color:red\'>*</span>매출처',
					id : 'V_S_BP_NM',
					editable : false,
					labelWidth : 90
				}, {
					xtype : 'textfield',
					margin : '0 0 0 30',
					maxWidth : 250,
					minWidth : 250,
					width : 250,
					fieldLabel : 'S_BP_CD',
					name : 'search_field',
					id : 'V_S_BP_CD',
					hidden : true
				}, {
					xtype : 'textfield',
					margin : '0 0 0 30',
					maxWidth : 250,
					minWidth : 250,
					width : 250,
					fieldLabel : '담보설정금액',
					labelWidth : 110,
					name : 'search_field',
					id : 'V_COL_TOT_AMT',
					fieldStyle : 'text-align: right',
					hidden : true

				}, ]
			}, ]
		}, {
			xtype : 'fieldset',
			flex : 0.2,
			height : 150,
			maxHeight : 150,
			minHeight : 150,
			// margin: '0 3 0 0',
			scrollable : 'horizontal',
			title : '[ 기타 ]',
			layout : {
				type : 'vbox',
				align : 'stretch',
				pack : 'center'
			},
			items : [ {
				xtype : 'fieldcontainer',
				layout : {
					type : 'hbox',
					align : 'stretch'
				},
				items : [ {
					xtype : 'textfield',
					maxWidth : 250,
					minWidth : 250,
					width : 250,
					fieldLabel : '담보관리번호',
					name : 'search_field',
					id : 'V_COL_MGM_NO',
					editable : false
				}, {}, ]
			}, {
				xtype : 'fieldcontainer',
				layout : {
					type : 'hbox',
					align : 'stretch'
				},
				items : [ {
					xtype : 'textfield',
					maxWidth : 250,
					minWidth : 250,
					width : 250,
					fieldLabel : '기존담보번호',
					name : 'search_field',
					id : 'V_REF_COL_NO',
					editable : false
				}, ]
			}, ]
		} ]
	}, {
		xtype : 'container',
		flex : 1,
		layout : {
			type : 'hbox',
			align : 'stretch'
		},
		items : [ {
			xtype : 'container',
			flex : 1,
			layout : {
				type : 'vbox',
				align : 'stretch'
			},
			items : [ {
				xtype : 'gridpanel',
				flex : 0.4,
				style : 'border: 1px solid lightgray; padding: 5px;',
				header : false,
				title : 'My Grid Panel',
				store : 'MyStore2',
				id : 'myGrid2',
				tbar : [ {
					id : 'BO_JAN_AMT',
					xtype : 'textfield',
					label : '보증금잔액',
					emptyText : '개발용',
					hidden: true
				}, {
					id : 'BU_JAN_AMT',
					xtype : 'textfield',
					label : '부동산잔액',
					emptyText : '개발용',
					hidden: true
				}, {
					id : 'LOAD_YN',
					xtype : 'textfield',
					text : 'LOAD_YN',
					emptyText : '개발용',
					hidden: true
				}, {
					xtype : 'container',
					flex : 1
				}, {
					id : 'V_ERP_DB_YN',
					xtype : 'textfield',
					label : 'V_ERP_DB_YN',
					hidden : true
				}, {
             	   id: 'V_DB_TYPE_CHK', /*담보유형구분 ex무담보*/
            	   xtype: 'textfield',
            	   label: 'V_DB_TYPE_CHK',
            	   hidden: true 
               }, {
					xtype : 'button',
					id : 'tempGlCfmBtn',
					margin : '0 3 0 0',
					text : 'ERP담보생성',
					style : 'background-color: white; border: 0.5px solid #3367d6;',
					cls : 'blue-btn',
					disabled : true,
					listeners : {
						mouseover : function(button, e, eOpts) {
							var theTip = Ext.create('Ext.tip.ToolTip', {
								html : 'ERP 담보생성',
								target : 'tempGlCfmBtn',
								showDelay : 0,
								mouseOffset : [ 5, 5 ],
								trackMouse : true,
								shadow : false
							});
						}
					},
				}, {
					xtype : 'button',
					id : 'tempGlCancelBtn',
					margin : '0 3 0 0',
					text : 'ERP담보취소',
					style : 'background-color: white; border: 0.5px solid #3367d6;',
					cls : 'blue-btn',
					listeners : {
						mouseover : function(button, e, eOpts) {
							var theTip = Ext.create('Ext.tip.ToolTip', {
								html : 'ERP 담보취소',
								target : 'tempGlCancelBtn',
								showDelay : 0,
								mouseOffset : [ 5, 5 ],
								trackMouse : true,
								shadow : false
							});
						}
					},
					disabled : true
				}, {
					xtype : 'button',
					id : 'tempGlCfmBtn2',
					margin : '0 3 0 0',
					text : 'ERP전표생성',
					style : 'background-color: white; border: 0.5px solid #3367d6;',
					cls : 'blue-btn',
					listeners : {
						mouseover : function(button, e, eOpts) {
							var theTip = Ext.create('Ext.tip.ToolTip', {
								html : 'ERP 결의전표생성',
								target : 'tempGlCfmBtn2',
								showDelay : 0,
								mouseOffset : [ 5, 5 ],
								trackMouse : true,
								shadow : false
							});
						}
					},
					disabled : true
				}, {
					xtype : 'button',
					id : 'tempGlCancelBtn2',
					margin : '0 3 0 0',
					text : 'ERP전표취소',
					style : 'background-color: white; border: 0.5px solid #3367d6;',
					cls : 'blue-btn',
					listeners : {
						mouseover : function(button, e, eOpts) {
							var theTip = Ext.create('Ext.tip.ToolTip', {
								html : 'ERP 결의전표취소',
								target : 'tempGlCancelBtn2',
								showDelay : 0,
								mouseOffset : [ 5, 5 ],
								trackMouse : true,
								shadow : false
							});
						}
					},
					disabled : true
				}, {
					id : 'V_TEMP_GL_NO',
					xtype : 'textfield',
					label : '전표번호',
					editable : false,
					width : 150
				}, {
					xtype : 'button',
					glyph : 'xf1c3@FontAwesome',
					id : 'xlsxDown2',
					cfg : {
						type : 'excel07',
						ext : 'xlsx'
					},
					iconCls : 'grid-excel-btn',
				} ],

				columns : [ {
					xtype : 'gridcolumn',
					hidden : true,
					style : 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
					width : 114,
					dataIndex : 'V_TYPE',
					text : 'V_TYPE'
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					dataIndex : 'ITEM_NM',
					text : '품명',
				}, {
					xtype : 'numbercolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					align : 'end',
					dataIndex : 'DOC_AMT',
					text : '외화금액',
					width : 150,
					format : '0,000.00',
					summaryType : 'sum',
					summaryRenderer : function(value, summaryData, dataIndex) {
						return "<font color='green'>" + Ext.util.Format.number(value, '0,000.00') + "<font>";
					},
				}, {
					xtype : 'numbercolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					align : 'end',
					format : '0,000',
					dataIndex : 'LOC_AMT',
					text : '자국금액',
					width : 150,
					summaryType : 'sum',
					summaryRenderer : function(value, summaryData, dataIndex) {
						return "<font color='green'>" + Ext.util.Format.number(value, '0,000') + "<font>";
					},
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 151,
					dataIndex : 'TG_NO',
					text : '전표번호',
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 150,
					dataIndex : 'PO_NO',
					text : 'PO_NO',
				// hidden: true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 100,
					dataIndex : 'PO_SEQ',
					text : 'PO_SEQ',
				}, ],
				viewConfig : {
					enableTextSelection : true,
					getRowClass : function(record, index) {

						if (Ext.getCmp('V_MAST_DB_NO').getValue() == '') {
							var MAST_DB_NO = record.get('MAST_DB_NO');
							if (MAST_DB_NO != undefined) {
								return 'bg-gray';
							}
						}
					},
				},
				selModel : {
					selType : 'checkboxmodel',
					listeners : {
						beforeselect : function(grid, record, index, eOpts) {
							if (Ext.getCmp('V_MAST_DB_NO').getValue() == '') {
								if (record.get('MAST_DB_NO') != undefined) {
									return false;
								}
							}
						},
						select : function(rowmodel, record, index, eOpts) {
							record.set('V_TYPE', 'V');
						},
						deselect : function(rowmodel, record, index, eOpts) {
							record.set('V_TYPE', '');
						}
					}
				},
				plugins : [ {
					ptype : 'gridexporter'
				}, {
					ptype : 'cellediting',
					clicksToEdit : 2,
					listeners : {
						edit : function(editor, context, eOpts) {

							var COL_TYPE = context.record.get('COL_TYPE');
							var XCH_RATE = context.record.get('XCH_RATE');
							var COL_DOC_AMT = context.record.get('COL_DOC_AMT');

							var store = Ext.data.StoreManager.lookup('MyStore');
							if (context.column.dataIndex == 'COL_TYPE') {
								var LOAN_RT = context.column.field.lastSelectedRecords["0"].data.LOAN_RT;

								if (COL_TYPE == 'A') { // 현금
									context.record.set('COL_AVL_AMT', 0);
								} else if (COL_TYPE == 'B') { // 보증보험
									context.record.set('COL_AVL_AMT', Ext.getCmp('BO_JAN_AMT').getValue());
								} else if (COL_TYPE == 'D') { // 부동산
									context.record.set('COL_AVL_AMT', Ext.getCmp('BU_JAN_AMT').getValue());
								} else if ((COL_TYPE != 'A') && (COL_TYPE != 'B') && (COL_TYPE != 'D')) {
									context.record.set('COL_AVL_AMT', 0);
								}

								context.record.set('LOAN_RT', context.column.field.lastSelectedRecords["0"].data.LOAN_RT);
								context.record.set('COL_AMT', Math.ceil((COL_DOC_AMT * LOAN_RT * XCH_RATE) / 100000) * 100000);
							}
						},
						beforeedit : function(editor, context, eOpts) {
							/* 발주팝업에서 담보등록 있는 내역은 editor 없애기 */
							if (!!!Ext.getCmp('V_MAST_DB_NO').getValue()) {
								return false;
							}

							// 담보유형 가져오기
							bnStore = new Ext.create('Ext.data.Store', {
								autoLoad : true,
								storeId : 'store1',
								proxy : {
									type : 'ajax',
									extraParams : {
										V_TYPE : 'BN',
										V_PO_NO : Ext.getCmp('V_PO_NO').getValue()
									},
									api : {
										read : 'sql/M_COL_DISTB.jsp'
									},
									reader : {
										type : 'json',
										rootProperty : 'resultList'
									}
								}
							});
							var bnStore = Ext.getStore('store1');
							Ext.getCmp('V_COL_TYPE2').bindStore(bnStore);
							bnStore.load();
						},
					},
				}, {
					ptype : 'clipboard'
				}, ],
				features : [ {
					ftype : 'summary'
				} ],
			}, {
				xtype : 'gridpanel',
				flex : 0.6,
				style : 'border: 1px solid lightgray; padding: 5px;',
				header : false,
				title : 'My Grid Panel',
				store : 'MyStore',
				id : 'myGrid',
				tbar : [ {
					id : 'gridAddBtn',
					text : '',
					margin : '0 3 0 0',
					glyph : 'xf055@FontAwesome',
					iconCls : 'grid-add-btn',
				}, {
					id : 'gridDelBtn',
					text : '',
					margin : '0 3 0 0',
					glyph : 'xf056@FontAwesome',
					iconCls : 'grid-del-btn',
				}, {
					id : 'gridSaveBtn',
					xtype : 'button',
					glyph : 'xf0c7@FontAwesome',
					iconCls : 'grid-save-btn',
					margin : '0 3 0 0',
					hidden : true
				}, {
					id : 'gridCopyBtn',
					xtype : 'button',
					glyph : 'xf0c5@FontAwesome',
					iconCls : 'grid-copy-btn',
					margin : '0 3 0 0'
				}, {
					xtype : 'container',
					flex : 1
				}, {
					xtype : 'button',
					glyph : 'xf1c3@FontAwesome',
					id : 'xlsxDown1',
					cfg : {
						type : 'excel07',
						ext : 'xlsx'
					},
					iconCls : 'grid-excel-btn',
				} ],

				columns : [ {
					xtype : 'gridcolumn',
					hidden : true,
					style : 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
					width : 114,
					dataIndex : 'V_TYPE',
					text : 'V_TYPE'
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
					dataIndex : 'CONT_REMARK',
					text : '컨테이너분류',
					editor : {
						xtype : 'textfield'
					}
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					dataIndex : 'ITEM_NM',
					text : '품명',
				}, {
					xtype : 'numbercolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
					align : 'end',
					dataIndex : 'COL_DOC_AMT',
					text : '외화금액',
					width : 150,
					editor : {
						xtype : 'numberfield'
					},
					summaryType : 'sum',
					summaryRenderer : function(value, summaryData, dataIndex) {
						return "<font color='green'>" + Ext.util.Format.number(value, '0,000.00') + "<font>";
					},
				}, {
					xtype : 'numbercolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
					align : 'end',
					dataIndex : 'COL_LOC_AMT',
					text : '자국금액',
					width : 150,
					hidden : true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;  color: #3367d6',
					width : 114,
					text : '담보유형',
					dataIndex : 'COL_TYPE',
					editor : {
						xtype : 'combobox',
						displayField : 'DTL_NM',
						valueField : 'DTL_CD',
						editable : false,
						id : 'V_COL_TYPE2',
						store : Ext.create('Ext.data.Store', {
							autoLoad : true,
							storeId : 'store1',
							proxy : {
								type : 'ajax',
								extraParams : {
									V_MAST_CD : 'BA20',
									V_GRID : 'Y'
								},
								api : {
									read : '/HSPF01/common/sql/Combobox.jsp'
								},
								reader : {
									type : 'json',
									rootProperty : 'resultList'
								}
							}
						}),
						listeners : {
							select : function(combo, record, eOpts) {
								if (Ext.getCmp('LOAD_YN').getValue() != 'Y') {
									Ext.Ajax.request({
										url : 'sql/M_COL_DISTB.jsp',
										method : 'post',
										params : {
											V_TYPE : 'ERP_DB',
											V_S_BP_CD : Ext.getCmp('V_S_BP_CD').getValue(),
											V_DATE : new Date(),
										},
										success : function(response) {
											var jsonResult = Ext.JSON.decode(response.responseText);
											Ext.getCmp('BO_JAN_AMT').setValue(jsonResult.resultList['0'].BO_JAN_AMT);
											Ext.getCmp('BU_JAN_AMT').setValue(jsonResult.resultList['0'].BU_JAN_AMT);
											Ext.getCmp('LOAD_YN').setValue('Y');

										}
									});
								}
							}
						},
					},
					renderer : function(value, metaData, record, rowIndex, colIndex, store, view) {
						if (Ext.data.StoreManager.lookup('store1').findRecord('DTL_CD', value) !== null) {
							Ext.getCmp('V_DB_TYPE_CHK').setValue(record.get('COL_TYPE'));/*담보유형 추가 GR20200130*/
							return Ext.data.StoreManager.lookup('store1').findRecord('DTL_CD', value).get('DTL_NM');
						}
						return value;
					},

				}, {
					xtype : 'numbercolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;  color: #3367d6',
					align : 'end',
					dataIndex : 'COL_AVL_AMT',
					text : '설정가능금액',
					editor : {
						xtype : 'numberfield'
					},
					width : 120,
					format : '0,000.'
				}, {
					xtype : 'numbercolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
					align : 'end',
					dataIndex : 'COL_AMT',
					text : '설정금액',
					editor : {
						xtype : 'numberfield',
						listeners : {
            				afterrender : function(c) {
            					this.mon(this.getEl(), 'dblclick', function() {
            						var popup = Ext.create("M_COL_DISTB.view.MyWindow2");
            						popup.center();
            						popup.show();

            						var store = Ext.getStore('PopStore2');
            						store.removeAll();

            						Ext.getCmp('W_DT_FR2').setValue(Ext.getCmp('V_COL_DT').getValue());
            					});
            				}
            			}
					},
					summaryType : 'sum',
					summaryRenderer : function(value, summaryData, dataIndex) {
						return "<font color='green'>" + Ext.util.Format.number(value, '0,000') + "<font>";
					},
					width : 120,
					format : '0,000.'
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
					width : 114,
					dataIndex : 'BL_DOC_NO',
					text : 'B/L No.',
					editor : {
						xtype : 'textfield'
					}
				}, {
					xtype : 'datecolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
					width : 100,
					dataIndex : 'USE_DT',
					text : '사용일자',
					format : 'Y-m-d',
					align : 'center',
					editor : {
						xtype : 'datefield',
						format : 'Y-m-d',
					},
					hidden : true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 151,
					dataIndex : 'REMARK',
					text : '비고',
					editor : {
						xtype : 'textfield'
					}
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 151,
					dataIndex : 'TG_NO',
					text : '전표번호',
				}, {
					xtype : 'numbercolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					dataIndex : 'LOAN_RT',
					text : 'LOAN_RT',
					hidden : true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 151,
					dataIndex : 'COL_NO',
					text : 'COL_NO',
					hidden : true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 151,
					dataIndex : 'COL_SEQ',
					text : 'COL_SEQ',
					hidden : true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 151,
					dataIndex : 'MAST_DB_NO',
					text : 'MAST_DB_NO',
					hidden : true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 151,
					dataIndex : 'CONT_MGM_NO',
					text : 'CONT_MGM_NO',
					hidden : true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 100,
					dataIndex : 'XCH_RATE',
					text : 'XCH_RATE',
					hidden : true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 100,
					dataIndex : 'USE_YN',
					text : 'USE_YN',
					hidden : true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 150,
					dataIndex : 'MAST_DB_NO',
					text : '담보번호',
				// hidden: true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 100,
					dataIndex : 'PO_NO',
					text : 'PO_NO',
				// hidden: true
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 100,
					dataIndex : 'PO_SEQ',
					text : 'PO_SEQ',
				}, ],
				viewConfig : {
					enableTextSelection : true,
					getRowClass : function(record, index) {

						if (Ext.getCmp('V_MAST_DB_NO').getValue() == '') {
							var MAST_DB_NO = record.get('MAST_DB_NO');
							if (MAST_DB_NO != undefined) {
								return 'bg-gray';
							}
						}
					},
				},
				selModel : {
					selType : 'checkboxmodel',
					listeners : {
						beforeselect : function(grid, record, index, eOpts) {
							if (Ext.getCmp('V_MAST_DB_NO').getValue() == '') {
								if (record.get('MAST_DB_NO') != undefined) {
									return false;
								}
							}
						},
						select : function(rowmodel, record, index, eOpts) {
							record.set('V_TYPE', 'V');
						},
						deselect : function(rowmodel, record, index, eOpts) {
							record.set('V_TYPE', '');
						}
					}
				},
				plugins : [ {
					ptype : 'gridexporter'
				}, {
					ptype : 'cellediting',
					clicksToEdit : 2,
					listeners : {
						edit : function(editor, context, eOpts) {

							var COL_TYPE = context.record.get('COL_TYPE');
							var XCH_RATE = context.record.get('XCH_RATE');
							var COL_DOC_AMT = context.record.get('COL_DOC_AMT');

							var store = Ext.data.StoreManager.lookup('MyStore');
							if (context.column.dataIndex == 'COL_TYPE') {
								var LOAN_RT = context.column.field.lastSelectedRecords["0"].data.LOAN_RT;

								if (COL_TYPE == 'A' || COL_TYPE == 'G') { // 현금
									context.record.set('COL_AVL_AMT', 0);
								} else if (COL_TYPE == 'B') { // 보증보험
									context.record.set('COL_AVL_AMT', Ext.getCmp('BO_JAN_AMT').getValue());
								} else if (COL_TYPE == 'D') { // 부동산
									context.record.set('COL_AVL_AMT', Ext.getCmp('BU_JAN_AMT').getValue());
								} else if ((COL_TYPE != 'A') && (COL_TYPE != 'B') && (COL_TYPE != 'D')) {
									context.record.set('COL_AVL_AMT', 0);
								}

								context.record.set('LOAN_RT', context.column.field.lastSelectedRecords["0"].data.LOAN_RT);
								context.record.set('COL_AMT', Math.ceil((COL_DOC_AMT * LOAN_RT * XCH_RATE) / 100000) * 100000);
							}
						},
						afteredit : function(e) {
							var record = e.grid.getSelection()[0];
							var field = e.context.field;
							var val = e.context.value;
							var store = Ext.getStore('MyStore');
							
							var LOAN_RT = record.get('LOAN_RT');
							if(field == 'COL_TYPE'){
								store.each(function(rec, idx) {
				            		if(!!!rec.get(field)) {
										rec.set(field, val);
										
										var XCH_RATE = rec.get('XCH_RATE');
										var COL_DOC_AMT = rec.get('COL_DOC_AMT');
										
										if (val == 'A' || val == 'G') { // 현금
											rec.set('COL_AVL_AMT', 0);
										} else if (val == 'B') { // 보증보험
											rec.set('COL_AVL_AMT', Ext.getCmp('BO_JAN_AMT').getValue());
										} else if (val == 'D') { // 부동산
											rec.set('COL_AVL_AMT', Ext.getCmp('BU_JAN_AMT').getValue());
										} else if ((val != 'A') && (val != 'B') && (val != 'D')) {
											rec.set('COL_AVL_AMT', 0);
										}
										
										rec.set('LOAN_RT', LOAN_RT);
										rec.set('COL_AMT', Math.ceil((COL_DOC_AMT * LOAN_RT * XCH_RATE) / 100000) * 100000);
									}
				            	});
							}
						},
						beforeedit : function(editor, context, eOpts) {
							/* 발주팝업에서 담보등록 있는 내역은 editor 없애기 */
							if (Ext.getCmp('V_MAST_DB_NO').getValue() == '') {
								if (context.record.get('MAST_DB_NO') != undefined) {
									return false;
								}
							}

							// 담보유형 가져오기
							bnStore = new Ext.create('Ext.data.Store', {
								autoLoad : true,
								storeId : 'store1',
								proxy : {
									type : 'ajax',
									extraParams : {
										V_TYPE : 'BN',
										V_PO_NO : Ext.getCmp('V_PO_NO').getValue()
									},
									api : {
										read : 'sql/M_COL_DISTB.jsp'
									},
									reader : {
										type : 'json',
										rootProperty : 'resultList'
									}
								}
							});
							var bnStore = Ext.getStore('store1');
							Ext.getCmp('V_COL_TYPE2').bindStore(bnStore);
							bnStore.load();
						},
					},
				}, {
					ptype : 'clipboard'
				}, ],
				features : [ {
					ftype : 'summary',
					dock : 'bottom'
				} ],
			} ]
		}, {
			xtype : 'splitter',
			height : 10
		}, {
			xtype : 'container',
			flex : 0.3,
			layout : {
				type : 'vbox',
				align : 'stretch'
			},
			items : [ {
				xtype : 'container',
				flex : 1,
				layout : {
					type : 'vbox',
					align : 'stretch',
//					pack : 'center',
//					padding : 10
				},
				items : [ {
					xtype : 'container',
					layout : {
						type : 'vbox',
						align : 'stretch',
						pack : 'center',
						padding : 5
					},
					items : [ {
						xtype : 'textfield',
						maxWidth : 300,
						minWidth : 300,
						width : 300,
						fieldLabel : '미입금보증금액'
					}, {
						xtype : 'container',
						// flex: 1,
						layout : {
							type : 'hbox',
							align : 'stretch',
//							pack : 'center'
						},
						items : [ {
							xtype : 'button',
							id : 'bankRefBtn',
							margin : '0 0 10 0',
							maxWidth : 150,
							minWidth : 150,
							width : 150,
							text : '은행입금내역참조'
						}, {
							xtype : 'button',
							margin : '0 0 10 0',
							maxWidth : 150,
							minWidth : 150,
							width : 150,
							text : '보증금입금전표생성'
						}, ]
					},
					{
						xtype : 'textfield',
						maxWidth : 300,
						minWidth : 300,
						width : 300,
						fieldLabel : '전표번호'
					}, {
						xtype : 'button',
						margin : '0 0 10 0',
						maxWidth : 150,
						minWidth : 150,
						width : 150,
						text : '전표취소'
					}, ]
					
				}, {
					xtype : 'gridpanel',
					id : 'myGrid3',
					store : 'MyStore3',
					style : 'border: 1px solid lightgray; padding: 5px;',
					flex : 1,
					header : false,
					title : 'My Grid Panel',
					columns : [ {
						xtype : 'rownumberer',
						width : 40
					}, {
						xtype : 'gridcolumn',
						hidden : true,
						style : 'font-size: 12px; text-align: center; font-weight: bold;',
						width : 114,
						dataIndex : 'V_TYPE',
						text : 'V_TYPE'
					}, {
						xtype : 'gridcolumn',
						style : 'font-size: 12px; text-align: center; font-weight: bold;',
						width : 200,
						dataIndex : 'BC_NO',
						text : '미정리예금번호'
					}, {
						xtype : 'numbercolumn',
						style : 'font-size: 12px; text-align: center; font-weight: bold;',
						width : 120,
						align : 'end',
						format : '0,000',
						dataIndex : 'COL_AMT',
						text : '담보대상금액'
					}, {
						xtype : 'numbercolumn',
						style : 'font-size: 12px; text-align: center; font-weight: bold;',
						width : 120,
						align : 'end',
						format : '0,000',
						dataIndex : 'REMAIN_AMT',
						text : '잔액',
						hidden : true,
					}, ],
				} ]
			}, {
				xtype : 'splitter',
				height : 10
			}, {
				xtype : 'gridpanel',
				flex : 1,
				style : 'border: 1px solid lightgray; padding: 5px;',
				header : false,
				title : 'My Grid Panel',
				columns : [ {
					xtype : 'rownumberer',
					width : 40
				}, {
					xtype : 'gridcolumn',
					hidden : true,
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 114,
					dataIndex : 'V_TYPE',
					text : 'V_TYPE'
				}, {
					xtype : 'gridcolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					width : 140,
					dataIndex : 'string',
					text : '전표번호'
				}, {
					xtype : 'numbercolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					align : 'end',
					dataIndex : 'number',
					text : '금액'
				}, {
					xtype : 'datecolumn',
					style : 'font-size: 12px; text-align: center; font-weight: bold;',
					text : '전표일'
				} ],
				viewConfig : {
					height : 155
				},
				selModel : {
					selType : 'checkboxmodel',

				},
				plugins : [ {
					ptype : 'gridexporter'
				}, {
					ptype : 'cellediting'
				} ]
			} ]
		} ]
	} ]

});