 /*
 * File: app/controller/MyGridController.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('S_DN_PAPER_VIEW.controller.MyGridController', {
    extend: 'Ext.app.Controller',
    control: {
        "#allowBtn" : {
        	click: 'allowBtnClick'
        }, 
    },
    onLaunch: function() {
    	Ext.Ajax.request({
			url : 'sql/S_DN_PAPER_VIEW.jsp',
			method : 'post',
			params : {
				V_TYPE : 'LOAD', // 수정
			},
			callback : function(records, operations, success) {
				
			},
			success : function(response) {
				var jsonResult = Ext.JSON.decode(response.responseText);
				var PRINT_NO = jsonResult.resultList[0].PRINT_NO;
				var STATUS = jsonResult.resultList[0].STATUS;
				var FLAG = jsonResult.resultList[0].FLAG;

				if(STATUS == 'X') {
					Ext.Msg.alert('확인', '삭제된 요청서입니다.');
				} else {
					if(FLAG == 'C') { //출하취소요청서
						Ext.getCmp('main').setHtml('<iframe name="xxx" border =0 src="http://123.142.124.170:8080/aireport/on_server/S_DN_PAPER_N.jsp?PRINT_NO='+PRINT_NO+'" width="100%" height="100%"></iframe>');
					} else {
						Ext.getCmp('main').setHtml('<iframe name="xxx" border =0 src="http://123.142.124.170:8080/aireport/on_server/S_DN_PAPER_Y.jsp?PRINT_NO='+PRINT_NO+'" width="100%" height="100%"></iframe>');
					}
					
					if(STATUS == 'N') {
			    		Ext.getCmp('allowBtn').setDisabled(false);
			    	} else {
			    		Ext.getCmp('allowBtn').setDisabled(true);
			    	}
				}
			}
		});
	},
    	
	allowBtnClick: function() {
		
		Ext.MessageBox.confirm('확인', '요청을 승인하시겠습니까?', function(btn) {
			if(btn == 'yes') {
				Ext.Ajax.request({
					url : 'sql/S_DN_PAPER_VIEW.jsp',
					method : 'post',
					params : {
						V_TYPE : 'ALLOW', // 수정
					},
					callback : function(records, operations, success) {
						
					},
					success : function(response) {
						var STATUS = response.responseText;
						
				    	if(STATUS == 'N') {
				    		Ext.getCmp('allowBtn').setDisabled(false);
				    	} else if (STATUS == 'Y') {
				    		Ext.getCmp('allowBtn').setDisabled(true);
				    	}
						
					},
					scope : this
				});
			}
		});
		
	}
});
