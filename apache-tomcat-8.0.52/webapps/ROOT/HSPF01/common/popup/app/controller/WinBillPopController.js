/*
 * File: app/controller/WinBpPopController.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Popup.controller.WinBillPopController', {
	extend : 'Ext.app.Controller',

	views : [ 'WinBillPop' ],
	stores : [ 'WinBillPopStore', 'WinBillEmpPopStore' ],
	control : {
		"#BYREmpSelBtn" : {
			click : 'BYREmpSelBtnClick'
		},
		"#BillEmpSelBtn" : {
			click : 'BillEmpSelBtnClick'
		},
		"#WinBillEmpGrid" : {
			beforecelldblclick : 'cellDblClick'
		},
		"#billPrintBtn" : {
			click : 'billPrintBtnClick'
		},
		"#billSaveBtn" : {
			click : 'billSaveBtnClick'
		},
		"#billSendBtn" : {
			click : 'billSendBtnClick'
		},
		"#billDelSendBtn" : {
			click : 'billDelSendBtnClick'
		},
		"#billReSendBtn" : {
			click : 'billReSendBtnClick'
		},
		"#billSendListBtn" : {
			click : 'billSendListBtnClick'
		},
		"#billMinusAmendBtn" : {
			click : 'billMinusAmendBtnClick'
		},
		"#billAmendBtn" : {
			click : 'billAmendBtnClick'
		},
		"#billAmendListBtn" : {
			click : 'billAmendListBtnClick'
		},
		"#billAmendCancelBtn" : {
			click : 'billAmendCancelBtnClick'
		},
		"#billWindowCloseBtn" : {
			click : 'billWindowCloseBtnClick'
		},
	},
	BYREmpSelBtnClick : function(button, e, eOpts) {
		var pop = Ext.create('Popup.view.WinBillEmpPop');
		Ext.getCmp('fieldType').setValue('BYR');
		this.BillEmpSelBtnClick();
		
		
		pop.show();
	},
	BillEmpSelBtnClick : function(button, e, eOpts) {
		var store = Ext.getStore('WinBillEmpPopStore');
		var V_TYPE = '';
		if(Ext.getCmp('fieldType').getValue() == 'BYR'){
			V_TYPE = 'BYR_EMP_S';
		}
		else{
			V_TYPE = 'SUPP_EMP_S';
		}
		store.load({
			params:{
				V_TYPE : V_TYPE,
				V_SUPP_BP_CD : Ext.getCmp('V_SUPP_BP_CD').getValue(),
				V_BYR_BP_CD : Ext.getCmp('V_BYR_BP_CD').getValue(),
				V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
				V_EMP_NAME : Ext.getCmp('W_EMP_NM').getValue(),
				V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
				V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
			}
		});
	},
	cellDblClick : function(tableview, td, cellIndex, record, tr, rowIndex, e, eOpts) {
		var EMP_NAME = record.get('EMP_NAME');
		var EMAIL = record.get('EMAIL');
		var TEL_NO = record.get('TEL_NO');
		var HAND_TEL = record.get('HAND_TEL');
		
		if(Ext.getCmp('fieldType').getValue() == 'BYR') {
			Ext.getCmp('CUST_CHARGE_NAME1').setValue(EMP_NAME);
			Ext.getCmp('CUST_CHARGE_TEL1').setValue(TEL_NO);
			Ext.getCmp('CUST_CHARGE_PHONE1').setValue(HAND_TEL);
			Ext.getCmp('CUST_CHARGE_MAIL1').setValue(EMAIL);
		}
		
		var popWin=  Ext.getCmp('WinBillEmpPop');
		popWin.destroy();
		
	},
	billPrintBtnClick : function(button, e, eOpts) {
		var BILL_NO = '';
		
		if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
			BILL_NO = Ext.getCmp('V_BILL_NO').getValue();
		}
		else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
			BILL_NO = Ext.getCmp('V_TAX_BILL_NO').getValue();
		}
		
		
		var url = 'http://123.142.124.170:8080/aireport/TOT_HSPF/TAX_BILL_PRINT.jsp?&V_BILL_NO=' + BILL_NO;
		if(Ext.getCmp('V_VAT_TYPE_C').getValue() == 'true'){
			url = 'http://123.142.124.170:8080/aireport/TOT_HSPF/TAX_BILL_PRINT2.jsp?&V_BILL_NO=' + BILL_NO;
		}
		
		
		var myWin = new Ext.Window({
			title : '세금계산서',
			html : '<iframe name="xxx" border =0 src="'+url+'" width="100%" height="100%"></iframe>',
			width : 1000,
			height : 768,
			modal : true
		});
		myWin.show();
		myWin.setSize(Ext.getBody().getViewSize());
		myWin.setPagePosition(0, 0);
	},
	billSaveBtnClick : function(button, e, eOpts) {
		var WinBillController = this.getController("WinBillPopController");
		
		var flag = 'T';
		var msg = '';
		
		if(Ext.getCmp('SUPP_CHARGE_NAME').getValue() == ''  || Ext.getCmp('SUPP_CHARGE_NAME').getValue() == null  || Ext.getCmp('SUPP_CHARGE_NAME').getValue() == undefined ){
			flag = 'F';
			msg = '공급자의 담당자를 확인해주세요.'
		}
		else if(Ext.getCmp('SUPP_CHARGE_MAIL').getValue() == ''  || Ext.getCmp('SUPP_CHARGE_MAIL').getValue() == null  || Ext.getCmp('SUPP_CHARGE_MAIL').getValue() == undefined ){
			flag = 'F';
			msg = '공급자의 이메일을 확인해주세요.'
		}
		else if(Ext.getCmp('CUST_CHARGE_NAME1').getValue() == ''  || Ext.getCmp('CUST_CHARGE_NAME1').getValue() == null  || Ext.getCmp('CUST_CHARGE_NAME1').getValue() == undefined ){
			flag = 'F';
			msg = '공급받는자의 담당자를 확인해주세요.'
		}
		else if(Ext.getCmp('CUST_CHARGE_MAIL1').getValue() == ''  || Ext.getCmp('CUST_CHARGE_MAIL1').getValue() == null  || Ext.getCmp('CUST_CHARGE_MAIL1').getValue() == undefined ){
			flag = 'F';
			msg = '공급받는자의 이메일을 확인해주세요.'
		}
		else if(Ext.getCmp('CUST_BUSINESS_ADDRESS').getValue() == '' || Ext.getCmp('CUST_BUSINESS_ADDRESS').getValue() == undefined || Ext.getCmp('CUST_BUSINESS_ADDRESS').getValue() == null){
			flag = 'F';
			msg = '공급받는자 사업장주소가 없습니다. 전산팀에 문의하세요.'
		}
		
		if(flag == 'T'){
			Ext.MessageBox.confirm('확인', '저장하시겠습니까?', function(btn) {
				if (btn == 'yes') {
					var store = Ext.getStore('WinBillPopStore');
					var record = store.getRange(0,0);
					var A_TYPE = '';
					if(Ext.getCmp('SERIAL_NUMBER').getValue() == '' || Ext.getCmp('SERIAL_NUMBER').getValue() == null || Ext.getCmp('SERIAL_NUMBER').getValue() == undefined){
						//관리번호가없으면 생성
						A_TYPE = 'C';
					}
					else{
						//관리번호가 있으면 업데이트
						A_TYPE = 'U';
					}
					var BILL_NO = '';
					if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
						BILL_NO = Ext.getCmp('V_BILL_NO').getValue();
					}
					else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
						BILL_NO = Ext.getCmp('V_TAX_BILL_NO').getValue();
					}
					
					
					Ext.Ajax.request({
						url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
						method : 'post',
						params : {
							V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
							V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
							V_TYPE : 'SAVE',
							A_TYPE : A_TYPE,
							V_BILL_NO : BILL_NO,
							V_QTY_YN : Ext.getCmp('V_QTY_YN').getValue().QTY_YN,
							V_CUST_CHARGE_NAME1 : Ext.getCmp('CUST_CHARGE_NAME1').getValue(),
							V_CN_YN : Ext.getCmp('V_CN_YN').getValue().CN_YN,
							V_REMARK: record[0].data['REMARK'],
						},
						success : function(response) {
							var jResult = Ext.JSON.decode(response.responseText);
							if(jResult.success == false){
								Ext.Msg.alert('관리자에게 문의하세요', jResult.resultList.message);
							}
							else{
								Ext.Msg.alert('확인', '저장완료');
								
								if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
									Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_BILL_NO').getValue());
									Ext.getCmp('billSendBtn').setDisabled(false);
									Ext.getCmp('billSendListBtn').setDisabled(false);
									Ext.getCmp('V_TAX_BILL_YN').setValue('Y');
									
									WinBillController.loadWinPopInfo();
									
								}
								else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
									Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
									Ext.getCmp('billSendBtn').setDisabled(false);
									Ext.getCmp('billSendListBtn').setDisabled(false);
									Ext.getCmp('V_TAX_BILL_YN').setValue('Y');
									
									WinBillController.loadWinPopInfo();
									
								}
							}
						},
						scope : this
					});
				}
			});
		}
		else{
			Ext.Msg.alert('확인', msg);
		}
		
	},
	billSendBtnClick : function(button, e, eOpts) {
		var BILL_NO = '';
		if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
			BILL_NO = Ext.getCmp('V_BILL_NO').getValue();
		}
		else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
			BILL_NO = Ext.getCmp('V_TAX_BILL_NO').getValue();
		}
		
		Ext.Ajax.request({
			url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
			method : 'post',
			params : {
				V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
				V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
				V_TYPE : 'AMT_CHECK',
				V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
				V_BILL_NO : BILL_NO,
			},
			success : function(response) {
				if(response.responseText == 'SUCCESS'){
					Ext.MessageBox.confirm('확인', '발행하시겠습니까?', function(btn) {
						if (btn == 'yes') {
							Ext.Ajax.request({
								url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
								method : 'post',
								params : {
									V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
									V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
									V_TYPE : 'SEND',
									V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
									V_BILL_NO : BILL_NO,
								},
								success : function(response) {
									var jResult = Ext.JSON.decode(response.responseText);
									
									Ext.getCmp('billSaveBtn').setDisabled(true);
									Ext.getCmp('billSendBtn').setDisabled(true);
									Ext.getCmp('billDelSendBtn').setDisabled(false);
									Ext.getCmp('billSendListBtn').setDisabled(true);
									
									Ext.getCmp('billMinusAmendBtn').setDisabled(false);
									Ext.getCmp('billAmendBtn').setDisabled(true);
									Ext.getCmp('billAmendListBtn').setDisabled(false);
									Ext.getCmp('billAmendCancelBtn').setDisabled(true);
									
									Ext.Msg.alert('확인', '발행 완료');
									
									if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
										Ext.getCmp('V_TAX_BILL_SEND_YN').setValue('Y');
										Ext.getCmp('V_CR_TYPE').setValue('C');
									}
								},
								scope : this
							});
						}
					});
				}
				else{
					Ext.Msg.alert('확인', response.responseText);
				}
			}
		});
			
		
		
	},
	billDelSendBtnClick : function(button, e, eOpts) {
		var BILL_NO = '';
		if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
			BILL_NO = Ext.getCmp('V_BILL_NO').getValue();
		}
		else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
			BILL_NO = Ext.getCmp('V_TAX_BILL_NO').getValue();
		}
		
		var flag = 'T';
		var msg = '';
		
		if(Ext.getCmp('NTS_ISSUE_ID').getValue() == '' || Ext.getCmp('NTS_ISSUE_ID').getValue() == null || Ext.getCmp('NTS_ISSUE_ID').getValue() == undefined){
			flag = 'T';
		}
		else{
			flag = 'F';
			msg = '국세청 승인된건은 재발행 불가능합니다.';
		}
		
		if(flag == 'T'){
			Ext.MessageBox.confirm('확인', '삭제발행하시겠습니까?', function(btn) {
				if (btn == 'yes') {
					Ext.Ajax.request({
						url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
						method : 'post',
						params : {
							V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
							V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							V_TYPE : 'SEND_DEL',
							V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
							V_BILL_NO : BILL_NO,
						},
						success : function(response) {
							var jResult = Ext.JSON.decode(response.responseText);
							
							Ext.getCmp('billSaveBtn').setDisabled(false);
							Ext.getCmp('billSendBtn').setDisabled(true);
							Ext.getCmp('billDelSendBtn').setDisabled(true);
							Ext.getCmp('billReSendBtn').setDisabled(false);
							Ext.getCmp('billSendListBtn').setDisabled(true);
							
							Ext.getCmp('billMinusAmendBtn').setDisabled(true);
							Ext.getCmp('billAmendBtn').setDisabled(true);
							Ext.getCmp('billAmendListBtn').setDisabled(true);
							Ext.getCmp('billAmendCancelBtn').setDisabled(true);
							
							Ext.Msg.alert('확인', '삭제 발행 완료');
							
							if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
								Ext.getCmp('V_TAX_BILL_SEND_YN').setValue('Y');
								Ext.getCmp('V_CR_TYPE').setValue('SEND_DEL');
							}
						},
						scope : this
					});
				}
			});
		}
		else{
			Ext.Msg.alert('확인', msg);
		}
		
		
		
		
	},
	billReSendBtnClick : function(button, e, eOpts) {
		var BILL_NO = '';
		if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
			BILL_NO = Ext.getCmp('V_BILL_NO').getValue();
		}
		else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
			BILL_NO = Ext.getCmp('V_TAX_BILL_NO').getValue();
		}
		
		var flag = 'T';
		var msg = '';
		
		if(Ext.getCmp('NTS_ISSUE_ID').getValue() == '' || Ext.getCmp('NTS_ISSUE_ID').getValue() == null || Ext.getCmp('NTS_ISSUE_ID').getValue() == undefined){
			flag = 'T';
		}
		else{
			flag = 'F';
			msg = '국세청 승인된건은 재발행 불가능합니다.';
		}
		
		if(flag == 'T'){
			Ext.Ajax.request({
				url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
				method : 'post',
				params : {
					V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
					V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
					V_TYPE : 'AMT_CHECK',
					V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
					V_BILL_NO : BILL_NO,
				},
				success : function(response) {
					if(response.responseText == 'SUCCESS'){
						Ext.MessageBox.confirm('확인', '재발행하시겠습니까?', function(btn) {
							if (btn == 'yes') {
								Ext.Ajax.request({
									url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
									method : 'post',
									params : {
										V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
										V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
										V_TYPE : 'SEND_RE',
										V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
										V_BILL_NO : BILL_NO,
									},
									success : function(response) {
										var jResult = Ext.JSON.decode(response.responseText);
										
										Ext.getCmp('billSaveBtn').setDisabled(true);
										Ext.getCmp('billSendBtn').setDisabled(true);
										Ext.getCmp('billDelSendBtn').setDisabled(false);
										Ext.getCmp('billReSendBtn').setDisabled(true);
										Ext.getCmp('billSendListBtn').setDisabled(true);
										
										Ext.getCmp('billMinusAmendBtn').setDisabled(false);
										Ext.getCmp('billAmendBtn').setDisabled(true);
										Ext.getCmp('billAmendListBtn').setDisabled(true);
										Ext.getCmp('billAmendCancelBtn').setDisabled(true);
										
										Ext.Msg.alert('확인', '재발행 완료');
										
										if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
											Ext.getCmp('V_TAX_BILL_SEND_YN').setValue('Y');
											Ext.getCmp('V_CR_TYPE').setValue('U');
										}
									},
									scope : this
								});
							}
						});
					}
					else{
						Ext.Msg.alert('확인', response.responseText);
					}
				}
			});
		}
		else{
			Ext.Msg.alert('확인', msg);
		}
		
		
		
		
		
	},
	
	billSendListBtnClick : function(button, e, eOpts) {
		var BILL_NO = '';
		if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
			BILL_NO = Ext.getCmp('V_BILL_NO').getValue();
		}
		else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
			BILL_NO = Ext.getCmp('V_TAX_BILL_NO').getValue();
		}
		
		Ext.Ajax.request({
			url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
			method : 'post',
			params : {
				V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
				V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
				V_TYPE : 'AMT_CHECK',
				V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
				V_BILL_NO : BILL_NO,
			},
			success : function(response) {
				if(response.responseText == 'SUCCESS'){
					Ext.MessageBox.confirm('확인', '거래명세서 발행하시겠습니까?', function(btn) {
						if (btn == 'yes') {
							Ext.Ajax.request({
								url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
								method : 'post',
								params : {
									V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
									V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
									V_TYPE : 'SEND_LIST',
									V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
									V_BILL_NO : BILL_NO,
								},
								success : function(response) {
//									var jResult = Ext.JSON.decode(response.responseText);
									
									Ext.getCmp('billSaveBtn').setDisabled(true);
									Ext.getCmp('billSendBtn').setDisabled(true);
									Ext.getCmp('billDelSendBtn').setDisabled(false);
									Ext.getCmp('billSendListBtn').setDisabled(true);
									
									Ext.getCmp('billMinusAmendBtn').setDisabled(false);
									Ext.getCmp('billAmendBtn').setDisabled(true);
									Ext.getCmp('billAmendListBtn').setDisabled(true);
									Ext.getCmp('billAmendCancelBtn').setDisabled(true);
									
									Ext.Msg.alert('확인', '발행 완료');
									
									if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
										Ext.getCmp('V_TAX_BILL_SEND_YN').setValue('Y');
										Ext.getCmp('V_CR_TYPE').setValue('C');
									}
								},
								scope : this
							});
						}
					});
				}
				else{
					Ext.Msg.alert('확인', response.responseText);
				}
			}
		});
		
	
	
},
billMinusAmendBtnClick : function(button, e, eOpts) {
	var BILL_NO = '';
	if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
		BILL_NO = Ext.getCmp('V_BILL_NO').getValue();
	}
	else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
		BILL_NO = Ext.getCmp('V_TAX_BILL_NO').getValue();
	}
	
	Ext.MessageBox.confirm('확인', '세금계산서 마이너스 정정발행하시겠습니까?<br>(국세청 승인이 완료된 세금계산서 금액 만큼 마이너스로 발행합니다.)', function(btn) {
		if (btn == 'yes') {
			Ext.Ajax.request({
				url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
				method : 'post',
				params : {
					V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
					V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
					V_TYPE : 'SEND_MINUS_AMEND',
					V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
					V_BILL_NO : BILL_NO,
				},
				success : function(response) {
//					var jResult = Ext.JSON.decode(response.responseText);
					
					Ext.getCmp('billSaveBtn').setDisabled(true);
					Ext.getCmp('billSendBtn').setDisabled(true);
					Ext.getCmp('billDelSendBtn').setDisabled(true);
					Ext.getCmp('billSendListBtn').setDisabled(true);
					
					Ext.getCmp('billMinusAmendBtn').setDisabled(true);
					Ext.getCmp('billAmendBtn').setDisabled(false);
					Ext.getCmp('billAmendListBtn').setDisabled(false);
					Ext.getCmp('billAmendCancelBtn').setDisabled(false);
					
					Ext.Msg.alert('확인', '마이너스 정정발행 완료');
					
					if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
						Ext.getCmp('V_TAX_BILL_SEND_YN').setValue('Y');
						Ext.getCmp('V_CR_TYPE').setValue('M_AMEND');
					}
				},
				scope : this
			});
		}
	});


},
billAmendBtnClick : function(button, e, eOpts) {
	var BILL_NO = '';
	if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
		BILL_NO = Ext.getCmp('V_BILL_NO').getValue();
	}
	else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
		BILL_NO = Ext.getCmp('V_TAX_BILL_NO').getValue();
	}
	
	Ext.Ajax.request({
		url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
		method : 'post',
		params : {
			V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
			V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
			V_TYPE : 'AMT_CHECK',
			V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
			V_BILL_NO : BILL_NO,
		},
		success : function(response) {
			if(response.responseText == 'SUCCESS'){
				Ext.MessageBox.confirm('확인', '세금계산서 정정발행하시겠습니까?<br>(정정한 금액이 올바른지 확인 후 발행하세요.)', function(btn) {
					if (btn == 'yes') {
						Ext.Ajax.request({
							url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
							method : 'post',
							params : {
								V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
								V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
								V_TYPE : 'SEND_AMEND',
								V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
								V_BILL_NO : BILL_NO,
							},
							success : function(response) {
//								var jResult = Ext.JSON.decode(response.responseText);
								
								Ext.getCmp('billSaveBtn').setDisabled(true);
								Ext.getCmp('billSendBtn').setDisabled(true);
								Ext.getCmp('billDelSendBtn').setDisabled(true);
								Ext.getCmp('billSendListBtn').setDisabled(true);
								
								Ext.getCmp('billMinusAmendBtn').setDisabled(true);
								Ext.getCmp('billAmendBtn').setDisabled(true);
								Ext.getCmp('billAmendListBtn').setDisabled(true);
								Ext.getCmp('billAmendCancelBtn').setDisabled(false);
								
								Ext.Msg.alert('확인', '정정발행 완료');
								
								if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
									Ext.getCmp('V_TAX_BILL_SEND_YN').setValue('Y');
									Ext.getCmp('V_CR_TYPE').setValue('AMEND');
								}
							},
							scope : this
						});
					}
				});
			}
			else{
				Ext.Msg.alert('확인', response.responseText);
			}
		}
	});
	


},
billAmendListBtnClick : function(button, e, eOpts) {
	var BILL_NO = '';
	if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
		BILL_NO = Ext.getCmp('V_BILL_NO').getValue();
	}
	else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
		BILL_NO = Ext.getCmp('V_TAX_BILL_NO').getValue();
	}
	
	Ext.Ajax.request({
		url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
		method : 'post',
		params : {
			V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
			V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
			V_TYPE : 'AMT_CHECK',
			V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
			V_BILL_NO : BILL_NO,
		},
		success : function(response) {
			if(response.responseText == 'SUCCESS'){
				Ext.MessageBox.confirm('확인', '거래명세서(+세금계산서) 정정발행하시겠습니까?<br>(정정한 금액이 올바른지 확인 후 발행하세요.)', function(btn) {
					if (btn == 'yes') {
						Ext.Ajax.request({
							url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
							method : 'post',
							params : {
								V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
								V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
								V_TYPE : 'SEND_AMEND_LIST',
								V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
								V_BILL_NO : BILL_NO,
							},
							success : function(response) {
//								var jResult = Ext.JSON.decode(response.responseText);
								
								Ext.getCmp('billSaveBtn').setDisabled(true);
								Ext.getCmp('billSendBtn').setDisabled(true);
								Ext.getCmp('billDelSendBtn').setDisabled(true);
								Ext.getCmp('billSendListBtn').setDisabled(true);
								
								Ext.getCmp('billMinusAmendBtn').setDisabled(true);
								Ext.getCmp('billAmendBtn').setDisabled(true);
								Ext.getCmp('billAmendListBtn').setDisabled(true);
								Ext.getCmp('billAmendCancelBtn').setDisabled(false);
								
								Ext.Msg.alert('확인', '정정발행 완료');
								
								if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
									Ext.getCmp('V_TAX_BILL_SEND_YN').setValue('Y');
									Ext.getCmp('V_CR_TYPE').setValue('AMEND');
								}
							},
							scope : this
						});
					}
				});
			}
			else{
				Ext.Msg.alert('확인', response.responseText);
			}
		}
	});
	
	
	
},
billAmendCancelBtnClick : function(button, e, eOpts) {
	var BILL_NO = '';
	if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
		BILL_NO = Ext.getCmp('V_BILL_NO').getValue();
	}
	else if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR' || Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
		BILL_NO = Ext.getCmp('V_TAX_BILL_NO').getValue();
	}
	
	Ext.MessageBox.confirm('확인', '수정세금계산서 취소발행하시겠습니까?', function(btn) {
		if (btn == 'yes') {
			Ext.Ajax.request({
				url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
				method : 'post',
				params : {
					V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
					V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
					V_TYPE : 'SEND_AMEND_CANCEL',
					V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
					V_BILL_NO : BILL_NO,
				},
				success : function(response) {
//					var jResult = Ext.JSON.decode(response.responseText);
					
					Ext.getCmp('billSaveBtn').setDisabled(true);
					Ext.getCmp('billSendBtn').setDisabled(true);
					Ext.getCmp('billDelSendBtn').setDisabled(true);
					Ext.getCmp('billSendListBtn').setDisabled(true);
					
					Ext.getCmp('billMinusAmendBtn').setDisabled(false);
					Ext.getCmp('billAmendBtn').setDisabled(false);
					Ext.getCmp('billAmendListBtn').setDisabled(false);
					Ext.getCmp('billAmendCancelBtn').setDisabled(true);
					
					Ext.Msg.alert('확인', '취소발행 완료');
					
					if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
						Ext.getCmp('V_TAX_BILL_SEND_YN').setValue('Y');
						Ext.getCmp('V_CR_TYPE').setValue('C_AMEND');
					}
				},
				scope : this
			});
		}
	});
	
	
},
	
	billWindowCloseBtnClick : function(button, e, eOpts) {
		var window = Ext.getCmp('myWindow');
		window.destroy();
	},

	loadWinPopInfo : function(button, e, eOpts) {
		
		if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
			if(Ext.getCmp('V_TAX_BILL_YN').getValue() == 'Y'){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(false);
				Ext.getCmp('billSendListBtn').setDisabled(false);
			}
			if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'C' ){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(false);
				Ext.getCmp('billReSendBtn').setDisabled(false);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(true);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'SEND_DEL'){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(false);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(false);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(true);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'U'){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(false);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(true);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'M_AMEND' ){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendListBtn').setDisabled(false);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'AMEND' ){
				
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'AMEND_LIST' ){
				
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'C_AMEND' ){
				
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(false);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendListBtn').setDisabled(false);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			
			if(Ext.getCmp('V_DTL_TYPE').getValue() == 'LIST'){
				Ext.getCmp('billSendBtn').hide();
				Ext.getCmp('billDelSendBtn').hide();
				Ext.getCmp('billReSendBtn').hide();
				Ext.getCmp('billSendListBtn').show();
				
				Ext.getCmp('billMinusAmendBtn').hide();
				Ext.getCmp('billAmendBtn').hide();
				Ext.getCmp('billAmendListBtn').show();
			}
			else{
				Ext.getCmp('billSendBtn').show();
				Ext.getCmp('billDelSendBtn').show();
				Ext.getCmp('billReSendBtn').show();
				Ext.getCmp('billSendListBtn').hide();
				 
				Ext.getCmp('billMinusAmendBtn').show();
				Ext.getCmp('billAmendBtn').show();
				Ext.getCmp('billAmendListBtn').hide();
			}
			
			if(Ext.getCmp('V_VAT_TYPE').getValue() == 'C'){
				Ext.getCmp('V_VAT_TYPE_A').setValue(false);
				Ext.getCmp('V_VAT_TYPE_B').setValue(true);
			}
			else{
				Ext.getCmp('V_VAT_TYPE_A').setValue(true);
				Ext.getCmp('V_VAT_TYPE_B').setValue(false);
			}
			
			//저장된 계산서가 없는경우
			if(Ext.getCmp('SERIAL_NUMBER').getValue() == '' || Ext.getCmp('SERIAL_NUMBER').getValue() == null || Ext.getCmp('SERIAL_NUMBER').getValue() == undefined){
				
				//공급자 정보
				Ext.Ajax.request({
					url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
					method : 'post',
					params : {
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
						V_TYPE : 'SUPP_S',
						V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						V_SUPP_BP_CD : Ext.getCmp('V_SUPP_BP_CD').getValue(),
						V_BYR_BP_CD : Ext.getCmp('V_BYR_BP_CD').getValue(),
					},
					success : function(response) {
						var jResult = Ext.JSON.decode(response.responseText);
						
						Ext.getCmp('SUPP_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].BP_REGNO);
						Ext.getCmp('SUPP_BUSINESS_NAME').setValue(jResult.resultList[0].BP_NM);
						Ext.getCmp('SUPP_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].REG_NM);
						Ext.getCmp('SUPP_BUSINESS_ADDRESS').setValue(jResult.resultList[0].ADDRESS);
						Ext.getCmp('SUPP_IND_TYPE').setValue(jResult.resultList[0].IND_TYPE);
						Ext.getCmp('SUPP_IND_CLASS').setValue(jResult.resultList[0].IND_CLASS);
					},
					scope : this
				});
				
				//공급받는자 정보
				Ext.Ajax.request({
					url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
					method : 'post',
					params : {
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
						V_TYPE : 'BYR_S',
						V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						V_SUPP_BP_CD : Ext.getCmp('V_SUPP_BP_CD').getValue(),
						V_BYR_BP_CD : Ext.getCmp('V_BYR_BP_CD').getValue(),
					},
					success : function(response) {
						var jResult = Ext.JSON.decode(response.responseText);
						
						Ext.getCmp('CUST_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].BP_REGNO);
						Ext.getCmp('CUST_BUSINESS_NAME').setValue(jResult.resultList[0].BP_NM);
						Ext.getCmp('CUST_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].REG_NM);
						Ext.getCmp('CUST_BUSINESS_ADDRESS').setValue(jResult.resultList[0].ADDRESS);
						Ext.getCmp('CUST_IND_TYPE').setValue(jResult.resultList[0].IND_TYPE);
						Ext.getCmp('CUST_IND_CLASS').setValue(jResult.resultList[0].IND_CLASS);
					},
					scope : this
				});
				
				if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_BILL_TOT_HSPF'){
					//좌측 담당자 정보
					Ext.Ajax.request({
						url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
						method : 'post',
						params : {
							V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
							V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							V_TYPE : 'MY_INFO',
							V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						},
						success : function(response) {
							var jResult = Ext.JSON.decode(response.responseText);
							
							Ext.getCmp('SUPP_CHARGE_NAME').setValue(jResult.resultList[0].EMP_NAME);
							Ext.getCmp('SUPP_CHARGE_TEL').setValue(jResult.resultList[0].TEL_NO);
							Ext.getCmp('SUPP_CHARGE_PHONE').setValue(jResult.resultList[0].HAND_TEL);
							Ext.getCmp('SUPP_CHARGE_MAIL').setValue(jResult.resultList[0].EMAIL);
						},
						scope : this
					});
					
					//품목정보
					var store = Ext.getStore('WinBillPopStore');
					if(Ext.getCmp('V_DTL_TYPE').getValue() == 'LIST'){
						store.load({
							params:{
								V_TYPE : 'TOT_BILL_INFO_LIST',
								V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
								V_BILL_NO : Ext.getCmp('V_BILL_NO').getValue(),
								V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
								V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							},
							callback : function(records, operation, success) {
								var jResult = Ext.JSON.decode(operation._response.responseText);
								
								Ext.Ajax.request({
									url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
									method : 'post',
									params : {
										V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
										V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
										V_TYPE : 'TOT_BILL_INFO',
										V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
										V_BILL_NO : Ext.getCmp('V_BILL_NO').getValue(),
									},
									success : function(response) {
										var jResult = Ext.JSON.decode(response.responseText);
										
										Ext.getCmp('V_ISSUE_DT').setValue(jResult.resultList[0].PUR_DATE);
										Ext.getCmp('V_SUPP_AMT').setValue(jResult.resultList[0].SUPPLY_AMOUNT);
										Ext.getCmp('V_TAX').setValue(jResult.resultList[0].TAX);
										Ext.getCmp('TOTAL_AMOUNT').setValue(jResult.resultList[0].TOTAL_AMOUNT);
									},
									scope : this
								});
								
								
							}
						});
					}
					else{
						store.load({
							params:{
								V_TYPE : 'TOT_BILL_INFO',
								V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
								V_BILL_NO : Ext.getCmp('V_BILL_NO').getValue(),
								V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
								V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							},
							callback : function(records, operation, success) {
								var jResult = Ext.JSON.decode(operation._response.responseText);
								
								Ext.getCmp('V_ISSUE_DT').setValue(jResult.resultList[0].PUR_DATE);
								Ext.getCmp('V_SUPP_AMT').setValue(jResult.resultList[0].SUPPLY_AMOUNT);
								Ext.getCmp('V_TAX').setValue(jResult.resultList[0].TAX);
								Ext.getCmp('TOTAL_AMOUNT').setValue(jResult.resultList[0].TOTAL_AMOUNT);
								
							}
						});
					}
					
				}
			}
			else{
				//저장된 계산서가 있는경우
				var store = Ext.getStore('WinBillPopStore'); 
				store.removeAll();
				
				Ext.Ajax.request({
					url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
					method : 'post',
					params : {
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
						V_TYPE : 'BILL_S',
						V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						V_BILL_NO : Ext.getCmp('V_BILL_NO').getValue(),
					},
					success : function(response) {
						var jResult = Ext.JSON.decode(response.responseText);
						
						Ext.getCmp('SUPP_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].SUP_COM_REGNO);
						Ext.getCmp('SUPP_BUSINESS_NAME').setValue(jResult.resultList[0].SUP_COM_NAME);
						Ext.getCmp('SUPP_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].SUP_NAME);
						Ext.getCmp('SUPP_BUSINESS_ADDRESS').setValue(jResult.resultList[0].SUP_COM_ADDR);
						Ext.getCmp('SUPP_IND_TYPE').setValue(jResult.resultList[0].SUP_COM_TYPE);
						Ext.getCmp('SUPP_IND_CLASS').setValue(jResult.resultList[0].SUP_COM_CLASSIFY);
						
						Ext.getCmp('SUPP_CHARGE_NAME').setValue(jResult.resultList[0].SUP_EMP_NAME);
						Ext.getCmp('SUPP_CHARGE_TEL').setValue(jResult.resultList[0].SUP_EMP_TEL_NO);
//						Ext.getCmp('SUPP_CHARGE_PHONE').setValue(jResult.resultList[0].SUP_EMP_TEL_NO);
						Ext.getCmp('SUPP_CHARGE_MAIL').setValue(jResult.resultList[0].SUP_EMP_EMAIL);
						
						Ext.getCmp('CUST_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].BYR_COM_REGNO);
						Ext.getCmp('CUST_BUSINESS_NAME').setValue(jResult.resultList[0].BYR_COM_NAME);
						Ext.getCmp('CUST_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].BYR_NAME);
						Ext.getCmp('CUST_BUSINESS_ADDRESS').setValue(jResult.resultList[0].BYR_COM_ADDR);
						Ext.getCmp('CUST_IND_TYPE').setValue(jResult.resultList[0].BYR_COM_TYPE);
						Ext.getCmp('CUST_IND_CLASS').setValue(jResult.resultList[0].BYR_COM_CLASSIFY);
						
						Ext.getCmp('CUST_CHARGE_NAME1').setValue(jResult.resultList[0].BYR_EMP_NAME);
						Ext.getCmp('CUST_CHARGE_TEL1').setValue(jResult.resultList[0].BYR_EMP_TEL_NO);
//						Ext.getCmp('CUST_CHARGE_PHONE1').setValue(jResult.resultList[0].BYR_EMP_TEL_NO);
						Ext.getCmp('CUST_CHARGE_MAIL1').setValue(jResult.resultList[0].BYR_EMP_EMAIL);
						
						Ext.getCmp('V_ISSUE_DT').setValue(jResult.resultList[0].TAX_DT);
						Ext.getCmp('V_SUPP_AMT').setValue(jResult.resultList[0].SUP_AMOUNT);
						Ext.getCmp('V_TAX').setValue(jResult.resultList[0].TAX_AMOUNT);
						
						Ext.getCmp('TOTAL_AMOUNT').setValue(jResult.resultList[0].TOT_AMOUNT);
						
						Ext.getCmp('NTS_ISSUE_ID').setValue(jResult.resultList[0].NTS_ISSUE_ID);
						
						//품목정보
						var store = Ext.getStore('WinBillPopStore');
						if(Ext.getCmp('V_DTL_TYPE').getValue() == 'LIST'){
							store.load({
								params:{
									V_TYPE : 'TOT_BILL_INFO_LIST',
									V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
									V_BILL_NO : Ext.getCmp('V_BILL_NO').getValue(),
									V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
									V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
								},
								callback : function(records, operation, success) {
									var jResult = Ext.JSON.decode(operation._response.responseText);
									
									
									
								}
							});
						}
						else{
							var rec = Ext.create('Popup.model.MyModel', {
								PUR_DATE : jResult.resultList[0].TAX_DT,
								ITEM_NM : jResult.resultList[0].ITEM_NM,
								SPEC : '.',
								QTY : jResult.resultList[0].ITEM_QTY,
								PRICE : jResult.resultList[0].ITEM_PRICE,
								SUPPLY_AMOUNT : jResult.resultList[0].SUP_AMOUNT,
								TAX : jResult.resultList[0].TAX_AMOUNT,
								REMARK : jResult.resultList[0].REMARK,
								
							});
							store.insert(0, rec);
						}
						
						
						
					},
					scope : this
				});
				
				
			}
		}
		
		//일반무역 거래명세서
		if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_DISTR'){
			if(Ext.getCmp('V_TAX_BILL_YN').getValue() == 'Y'){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(false);
				Ext.getCmp('billSendListBtn').setDisabled(false);
			}
			if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'C' ){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(false);
				Ext.getCmp('billReSendBtn').setDisabled(false);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(true);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'SEND_DEL'){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(false);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(false);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(true);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'U'){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(false);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(true);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'M_AMEND' ){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendListBtn').setDisabled(false);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'AMEND' ){
				
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'AMEND_LIST' ){
				
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'C_AMEND' ){
				
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(false);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendListBtn').setDisabled(false);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			
			if(Ext.getCmp('V_DTL_TYPE').getValue() == 'LIST'){
				Ext.getCmp('billSendBtn').hide();
				Ext.getCmp('billDelSendBtn').hide();
				Ext.getCmp('billReSendBtn').hide();
				Ext.getCmp('billSendListBtn').show();
				
				Ext.getCmp('billMinusAmendBtn').hide();
				Ext.getCmp('billAmendBtn').hide();
				Ext.getCmp('billAmendListBtn').show();
			}
			else{
				Ext.getCmp('billSendBtn').show();
				Ext.getCmp('billDelSendBtn').show();
				Ext.getCmp('billReSendBtn').show();
				Ext.getCmp('billSendListBtn').hide();
				 
				Ext.getCmp('billMinusAmendBtn').show();
				Ext.getCmp('billAmendBtn').show();
				Ext.getCmp('billAmendListBtn').hide();
			}
			
			//일반무역은 항상 면세
			Ext.getCmp('V_VAT_TYPE_A').setValue(false);
			Ext.getCmp('V_VAT_TYPE_B').setValue(false);
			Ext.getCmp('V_VAT_TYPE_C').setValue(true);
//			if(Ext.getCmp('V_VAT_TYPE').getValue() == 'C'){
//				Ext.getCmp('V_VAT_TYPE_A').setValue(false);
//				Ext.getCmp('V_VAT_TYPE_B').setValue(true);
//			}
//			else{
//				Ext.getCmp('V_VAT_TYPE_A').setValue(true);
//				Ext.getCmp('V_VAT_TYPE_B').setValue(false);
//			}
			
			//저장된 계산서가 없는경우
			if(Ext.getCmp('SERIAL_NUMBER').getValue() == '' || Ext.getCmp('SERIAL_NUMBER').getValue() == null || Ext.getCmp('SERIAL_NUMBER').getValue() == undefined){
				
				//공급자 정보
				Ext.Ajax.request({
					url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
					method : 'post',
					params : {
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
						V_TYPE : 'SUPP_S',
						V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						V_SUPP_BP_CD : Ext.getCmp('V_SUPP_BP_CD').getValue(),
						V_BYR_BP_CD : Ext.getCmp('V_BYR_BP_CD').getValue(),
					},
					success : function(response) {
						var jResult = Ext.JSON.decode(response.responseText);
						
						Ext.getCmp('SUPP_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].BP_REGNO);
						Ext.getCmp('SUPP_BUSINESS_NAME').setValue(jResult.resultList[0].BP_NM);
						Ext.getCmp('SUPP_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].REG_NM);
						Ext.getCmp('SUPP_BUSINESS_ADDRESS').setValue(jResult.resultList[0].ADDRESS);
						Ext.getCmp('SUPP_IND_TYPE').setValue(jResult.resultList[0].IND_TYPE);
						Ext.getCmp('SUPP_IND_CLASS').setValue(jResult.resultList[0].IND_CLASS);
					},
					scope : this
				});
				
				//공급받는자 정보
				Ext.Ajax.request({
					url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
					method : 'post',
					params : {
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
						V_TYPE : 'BYR_S',
						V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						V_SUPP_BP_CD : Ext.getCmp('V_SUPP_BP_CD').getValue(),
						V_BYR_BP_CD : Ext.getCmp('V_BYR_BP_CD').getValue(),
					},
					success : function(response) {
						var jResult = Ext.JSON.decode(response.responseText);
						
						Ext.getCmp('CUST_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].BP_REGNO);
						Ext.getCmp('CUST_BUSINESS_NAME').setValue(jResult.resultList[0].BP_NM);
						Ext.getCmp('CUST_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].REG_NM);
						Ext.getCmp('CUST_BUSINESS_ADDRESS').setValue(jResult.resultList[0].ADDRESS);
						Ext.getCmp('CUST_IND_TYPE').setValue(jResult.resultList[0].IND_TYPE);
						Ext.getCmp('CUST_IND_CLASS').setValue(jResult.resultList[0].IND_CLASS);
					},
					scope : this
				});
				
					//좌측 담당자 정보
					Ext.Ajax.request({
						url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
						method : 'post',
						params : {
							V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
							V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							V_TYPE : 'MY_INFO',
							V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						},
						success : function(response) {
							var jResult = Ext.JSON.decode(response.responseText);
							
							Ext.getCmp('SUPP_CHARGE_NAME').setValue(jResult.resultList[0].EMP_NAME);
							Ext.getCmp('SUPP_CHARGE_TEL').setValue(jResult.resultList[0].TEL_NO);
							Ext.getCmp('SUPP_CHARGE_PHONE').setValue(jResult.resultList[0].HAND_TEL);
							Ext.getCmp('SUPP_CHARGE_MAIL').setValue(jResult.resultList[0].EMAIL);
						},
						scope : this
					});
					
					//품목정보
					var store = Ext.getStore('WinBillPopStore');
					if(Ext.getCmp('V_DTL_TYPE').getValue() == 'LIST'){
						store.load({
							params:{
								V_TYPE : 'S_TAX_DISTR_INFO_LIST',
								V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
								V_BILL_NO : Ext.getCmp('V_TAX_BILL_NO').getValue(),
								V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
								V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							},
							callback : function(records, operation, success) {
								var jResult = Ext.JSON.decode(operation._response.responseText);
								
								Ext.Ajax.request({
									url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
									method : 'post',
									params : {
										V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
										V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
										V_TYPE : 'TOT_BILL_INFO',
										V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
										V_BILL_NO : Ext.getCmp('V_TAX_BILL_NO').getValue(),
									},
									success : function(response) {
										var jResult = Ext.JSON.decode(response.responseText);
										
										Ext.getCmp('V_ISSUE_DT').setValue(jResult.resultList[0].PUR_DATE);
										Ext.getCmp('V_SUPP_AMT').setValue(jResult.resultList[0].SUPPLY_AMOUNT);
										Ext.getCmp('V_TAX').setValue(jResult.resultList[0].TAX);
										Ext.getCmp('TOTAL_AMOUNT').setValue(jResult.resultList[0].TOTAL_AMOUNT);
									},
									scope : this
								});
								
								
							}
						});
					}
					else{
						store.load({
							params:{
								V_TYPE : 'S_TAX_DISTR_INFO',
								V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
								V_BILL_NO : Ext.getCmp('V_TAX_BILL_NO').getValue(),
								V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
								V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							},
							callback : function(records, operation, success) {
								var jResult = Ext.JSON.decode(operation._response.responseText);
								
								Ext.getCmp('V_ISSUE_DT').setValue(jResult.resultList[0].PUR_DATE);
								Ext.getCmp('V_SUPP_AMT').setValue(jResult.resultList[0].SUPPLY_AMOUNT);
								Ext.getCmp('V_TAX').setValue(jResult.resultList[0].TAX);
								Ext.getCmp('TOTAL_AMOUNT').setValue(jResult.resultList[0].TOTAL_AMOUNT);
								
							}
						});
					}
					
			}
			else{
				//저장된 계산서가 있는경우
				var store = Ext.getStore('WinBillPopStore'); 
				store.removeAll();
				
				Ext.Ajax.request({
					url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
					method : 'post',
					params : {
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
						V_TYPE : 'BILL_S',
						V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						V_BILL_NO : Ext.getCmp('V_TAX_BILL_NO').getValue(),
					},
					success : function(response) {
						var jResult = Ext.JSON.decode(response.responseText);
						
						Ext.getCmp('SUPP_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].SUP_COM_REGNO);
						Ext.getCmp('SUPP_BUSINESS_NAME').setValue(jResult.resultList[0].SUP_COM_NAME);
						Ext.getCmp('SUPP_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].SUP_NAME);
						Ext.getCmp('SUPP_BUSINESS_ADDRESS').setValue(jResult.resultList[0].SUP_COM_ADDR);
						Ext.getCmp('SUPP_IND_TYPE').setValue(jResult.resultList[0].SUP_COM_TYPE);
						Ext.getCmp('SUPP_IND_CLASS').setValue(jResult.resultList[0].SUP_COM_CLASSIFY);
						
						Ext.getCmp('SUPP_CHARGE_NAME').setValue(jResult.resultList[0].SUP_EMP_NAME);
						Ext.getCmp('SUPP_CHARGE_TEL').setValue(jResult.resultList[0].SUP_EMP_TEL_NO);
//						Ext.getCmp('SUPP_CHARGE_PHONE').setValue(jResult.resultList[0].SUP_EMP_TEL_NO);
						Ext.getCmp('SUPP_CHARGE_MAIL').setValue(jResult.resultList[0].SUP_EMP_EMAIL);
						
						Ext.getCmp('CUST_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].BYR_COM_REGNO);
						Ext.getCmp('CUST_BUSINESS_NAME').setValue(jResult.resultList[0].BYR_COM_NAME);
						Ext.getCmp('CUST_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].BYR_NAME);
						Ext.getCmp('CUST_BUSINESS_ADDRESS').setValue(jResult.resultList[0].BYR_COM_ADDR);
						Ext.getCmp('CUST_IND_TYPE').setValue(jResult.resultList[0].BYR_COM_TYPE);
						Ext.getCmp('CUST_IND_CLASS').setValue(jResult.resultList[0].BYR_COM_CLASSIFY);
						
						Ext.getCmp('CUST_CHARGE_NAME1').setValue(jResult.resultList[0].BYR_EMP_NAME);
						Ext.getCmp('CUST_CHARGE_TEL1').setValue(jResult.resultList[0].BYR_EMP_TEL_NO);
//						Ext.getCmp('CUST_CHARGE_PHONE1').setValue(jResult.resultList[0].BYR_EMP_TEL_NO);
						Ext.getCmp('CUST_CHARGE_MAIL1').setValue(jResult.resultList[0].BYR_EMP_EMAIL);
						
						Ext.getCmp('V_ISSUE_DT').setValue(jResult.resultList[0].TAX_DT);
						Ext.getCmp('V_SUPP_AMT').setValue(jResult.resultList[0].SUP_AMOUNT);
						Ext.getCmp('V_TAX').setValue(jResult.resultList[0].TAX_AMOUNT);
						
						Ext.getCmp('TOTAL_AMOUNT').setValue(jResult.resultList[0].TOT_AMOUNT);
						
						Ext.getCmp('NTS_ISSUE_ID').setValue(jResult.resultList[0].NTS_ISSUE_ID);
						
						//품목정보
						var store = Ext.getStore('WinBillPopStore');
						if(Ext.getCmp('V_DTL_TYPE').getValue() == 'LIST'){
							store.load({
								params:{
									V_TYPE : 'TOT_BILL_INFO_LIST',
									V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
									V_BILL_NO : Ext.getCmp('V_TAX_BILL_NO').getValue(),
									V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
									V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
								},
								callback : function(records, operation, success) {
									var jResult = Ext.JSON.decode(operation._response.responseText);
									
									
									
								}
							});
						}
						else{
							var rec = Ext.create('Popup.model.MyModel', {
								PUR_DATE : jResult.resultList[0].TAX_DT,
								ITEM_NM : jResult.resultList[0].ITEM_NM,
								SPEC : '.',
								QTY : jResult.resultList[0].ITEM_QTY,
								PRICE : jResult.resultList[0].ITEM_PRICE,
								SUPPLY_AMOUNT : jResult.resultList[0].SUP_AMOUNT,
								TAX : jResult.resultList[0].TAX_AMOUNT,
								REMARK : jResult.resultList[0].REMARK,
								
							});
							store.insert(0, rec);
						}
						
						
						
					},
					scope : this
				});
				
				
			}
		}
		
		//철강팀 거래명세서
		if(Ext.getCmp('V_SHOW_TYPE').getValue() == 'S_TAX_STEEL'){
			if(Ext.getCmp('V_TAX_BILL_YN').getValue() == 'Y'){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(false);
				Ext.getCmp('billSendListBtn').setDisabled(false);
			}
			if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'C' ){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(false);
				Ext.getCmp('billReSendBtn').setDisabled(false);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(true);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'SEND_DEL'){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(false);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(false);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(true);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'U'){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(false);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(true);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'M_AMEND' ){
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendListBtn').setDisabled(false);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'AMEND' ){
				
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'AMEND_LIST' ){
				
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(true);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendBtn').setDisabled(true);
				Ext.getCmp('billAmendListBtn').setDisabled(true);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			else if(Ext.getCmp('V_TAX_BILL_SEND_YN').getValue() == 'Y' && Ext.getCmp('V_CR_TYPE').getValue() == 'C_AMEND' ){
				
				Ext.getCmp('SERIAL_NUMBER').setValue(Ext.getCmp('V_TAX_BILL_NO').getValue());
				Ext.getCmp('billSendBtn').setDisabled(true);
				Ext.getCmp('billSaveBtn').setDisabled(false);
				Ext.getCmp('billDelSendBtn').setDisabled(true);
				Ext.getCmp('billReSendBtn').setDisabled(true);
				Ext.getCmp('billSendListBtn').setDisabled(true);
				
				Ext.getCmp('billMinusAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendBtn').setDisabled(false);
				Ext.getCmp('billAmendListBtn').setDisabled(false);
				Ext.getCmp('billAmendCancelBtn').setDisabled(false);
			}
			
			if(Ext.getCmp('V_DTL_TYPE').getValue() == 'LIST'){
				Ext.getCmp('billSendBtn').hide();
				Ext.getCmp('billDelSendBtn').hide();
				Ext.getCmp('billReSendBtn').hide();
				Ext.getCmp('billSendListBtn').show();
				
				Ext.getCmp('billMinusAmendBtn').hide();
				Ext.getCmp('billAmendBtn').hide();
				Ext.getCmp('billAmendListBtn').show();
			}
			else{
				Ext.getCmp('billSendBtn').show();
				Ext.getCmp('billDelSendBtn').show();
				Ext.getCmp('billReSendBtn').show();
				Ext.getCmp('billSendListBtn').hide();
				 
				Ext.getCmp('billMinusAmendBtn').show();
				Ext.getCmp('billAmendBtn').show();
				Ext.getCmp('billAmendListBtn').hide();
			}
			
			
//			if(Ext.getCmp('V_VAT_TYPE').getValue() == 'C'){
//				Ext.getCmp('V_VAT_TYPE_A').setValue(false);
//				Ext.getCmp('V_VAT_TYPE_B').setValue(true);
//			}
//			else{
//				Ext.getCmp('V_VAT_TYPE_A').setValue(true);
//				Ext.getCmp('V_VAT_TYPE_B').setValue(false);
//			}
			
			//저장된 계산서가 없는경우
			if(Ext.getCmp('SERIAL_NUMBER').getValue() == '' || Ext.getCmp('SERIAL_NUMBER').getValue() == null || Ext.getCmp('SERIAL_NUMBER').getValue() == undefined){
				
				//공급자 정보
				Ext.Ajax.request({
					url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
					method : 'post',
					params : {
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
						V_TYPE : 'SUPP_S',
						V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						V_SUPP_BP_CD : Ext.getCmp('V_SUPP_BP_CD').getValue(),
						V_BYR_BP_CD : Ext.getCmp('V_BYR_BP_CD').getValue(),
					},
					success : function(response) {
						var jResult = Ext.JSON.decode(response.responseText);
						
						Ext.getCmp('SUPP_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].BP_REGNO);
						Ext.getCmp('SUPP_BUSINESS_NAME').setValue(jResult.resultList[0].BP_NM);
						Ext.getCmp('SUPP_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].REG_NM);
						Ext.getCmp('SUPP_BUSINESS_ADDRESS').setValue(jResult.resultList[0].ADDRESS);
						Ext.getCmp('SUPP_IND_TYPE').setValue(jResult.resultList[0].IND_TYPE);
						Ext.getCmp('SUPP_IND_CLASS').setValue(jResult.resultList[0].IND_CLASS);
					},
					scope : this
				});
				
				//공급받는자 정보
				Ext.Ajax.request({
					url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
					method : 'post',
					params : {
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
						V_TYPE : 'BYR_S',
						V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						V_SUPP_BP_CD : Ext.getCmp('V_SUPP_BP_CD').getValue(),
						V_BYR_BP_CD : Ext.getCmp('V_BYR_BP_CD').getValue(),
					},
					success : function(response) {
						var jResult = Ext.JSON.decode(response.responseText);
						
						Ext.getCmp('CUST_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].BP_REGNO);
						Ext.getCmp('CUST_BUSINESS_NAME').setValue(jResult.resultList[0].BP_NM);
						Ext.getCmp('CUST_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].REG_NM);
						Ext.getCmp('CUST_BUSINESS_ADDRESS').setValue(jResult.resultList[0].ADDRESS);
						Ext.getCmp('CUST_IND_TYPE').setValue(jResult.resultList[0].IND_TYPE);
						Ext.getCmp('CUST_IND_CLASS').setValue(jResult.resultList[0].IND_CLASS);
					},
					scope : this
				});
				
					//좌측 담당자 정보
					Ext.Ajax.request({
						url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
						method : 'post',
						params : {
							V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
							V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							V_TYPE : 'MY_INFO',
							V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						},
						success : function(response) {
							var jResult = Ext.JSON.decode(response.responseText);
							
							Ext.getCmp('SUPP_CHARGE_NAME').setValue(jResult.resultList[0].EMP_NAME);
							Ext.getCmp('SUPP_CHARGE_TEL').setValue(jResult.resultList[0].TEL_NO);
							Ext.getCmp('SUPP_CHARGE_PHONE').setValue(jResult.resultList[0].HAND_TEL);
							Ext.getCmp('SUPP_CHARGE_MAIL').setValue(jResult.resultList[0].EMAIL);
						},
						scope : this
					});
					
					//품목정보
					var store = Ext.getStore('WinBillPopStore');
					if(Ext.getCmp('V_DTL_TYPE').getValue() == 'LIST'){
						store.load({
							params:{
								V_TYPE : 'S_TAX_STEEL_INFO_LIST',
								V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
								V_BILL_NO : Ext.getCmp('V_TAX_BILL_NO').getValue(),
								V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
								V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							},
							callback : function(records, operation, success) {
								var jResult = Ext.JSON.decode(operation._response.responseText);
								
								Ext.Ajax.request({
									url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
									method : 'post',
									params : {
										V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
										V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
										V_TYPE : 'TOT_BILL_INFO',
										V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
										V_BILL_NO : Ext.getCmp('V_TAX_BILL_NO').getValue(),
									},
									success : function(response) {
										var jResult = Ext.JSON.decode(response.responseText);
										
										Ext.getCmp('V_ISSUE_DT').setValue(jResult.resultList[0].PUR_DATE);
										Ext.getCmp('V_SUPP_AMT').setValue(jResult.resultList[0].SUPPLY_AMOUNT);
										Ext.getCmp('V_TAX').setValue(jResult.resultList[0].TAX);
										Ext.getCmp('TOTAL_AMOUNT').setValue(jResult.resultList[0].TOTAL_AMOUNT);
									},
									scope : this
								});
								
								
							}
						});
					}
					else{
						store.load({
							params:{
								V_TYPE : 'S_TAX_STEEL_INFO',
								V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
								V_BILL_NO : Ext.getCmp('V_TAX_BILL_NO').getValue(),
								V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
								V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							},
							callback : function(records, operation, success) {
								var jResult = Ext.JSON.decode(operation._response.responseText);
								
								Ext.getCmp('V_ISSUE_DT').setValue(jResult.resultList[0].PUR_DATE);
								Ext.getCmp('V_SUPP_AMT').setValue(jResult.resultList[0].SUPPLY_AMOUNT);
								Ext.getCmp('V_TAX').setValue(jResult.resultList[0].TAX);
								Ext.getCmp('TOTAL_AMOUNT').setValue(jResult.resultList[0].TOTAL_AMOUNT);
								
							}
						});
					}
					
			}
			else{
				//저장된 계산서가 있는경우
				var store = Ext.getStore('WinBillPopStore'); 
				store.removeAll();
				
				Ext.Ajax.request({
					url : '/HSPF01/common/popup/sql/bill_pop_mgm.jsp',
					method : 'post',
					params : {
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
						V_TYPE : 'BILL_S',
						V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
						V_BILL_NO : Ext.getCmp('V_TAX_BILL_NO').getValue(),
					},
					success : function(response) {
						var jResult = Ext.JSON.decode(response.responseText);
						
						Ext.getCmp('SUPP_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].SUP_COM_REGNO);
						Ext.getCmp('SUPP_BUSINESS_NAME').setValue(jResult.resultList[0].SUP_COM_NAME);
						Ext.getCmp('SUPP_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].SUP_NAME);
						Ext.getCmp('SUPP_BUSINESS_ADDRESS').setValue(jResult.resultList[0].SUP_COM_ADDR);
						Ext.getCmp('SUPP_IND_TYPE').setValue(jResult.resultList[0].SUP_COM_TYPE);
						Ext.getCmp('SUPP_IND_CLASS').setValue(jResult.resultList[0].SUP_COM_CLASSIFY);
						
						Ext.getCmp('SUPP_CHARGE_NAME').setValue(jResult.resultList[0].SUP_EMP_NAME);
						Ext.getCmp('SUPP_CHARGE_TEL').setValue(jResult.resultList[0].SUP_EMP_TEL_NO);
//						Ext.getCmp('SUPP_CHARGE_PHONE').setValue(jResult.resultList[0].SUP_EMP_TEL_NO);
						Ext.getCmp('SUPP_CHARGE_MAIL').setValue(jResult.resultList[0].SUP_EMP_EMAIL);
						
						Ext.getCmp('CUST_BUSINESS_LICENSE_NUMBER').setValue(jResult.resultList[0].BYR_COM_REGNO);
						Ext.getCmp('CUST_BUSINESS_NAME').setValue(jResult.resultList[0].BYR_COM_NAME);
						Ext.getCmp('CUST_REPRESENTATIVE_NAME').setValue(jResult.resultList[0].BYR_NAME);
						Ext.getCmp('CUST_BUSINESS_ADDRESS').setValue(jResult.resultList[0].BYR_COM_ADDR);
						Ext.getCmp('CUST_IND_TYPE').setValue(jResult.resultList[0].BYR_COM_TYPE);
						Ext.getCmp('CUST_IND_CLASS').setValue(jResult.resultList[0].BYR_COM_CLASSIFY);
						
						Ext.getCmp('CUST_CHARGE_NAME1').setValue(jResult.resultList[0].BYR_EMP_NAME);
						Ext.getCmp('CUST_CHARGE_TEL1').setValue(jResult.resultList[0].BYR_EMP_TEL_NO);
//						Ext.getCmp('CUST_CHARGE_PHONE1').setValue(jResult.resultList[0].BYR_EMP_TEL_NO);
						Ext.getCmp('CUST_CHARGE_MAIL1').setValue(jResult.resultList[0].BYR_EMP_EMAIL);
						
						Ext.getCmp('V_ISSUE_DT').setValue(jResult.resultList[0].TAX_DT);
						Ext.getCmp('V_SUPP_AMT').setValue(jResult.resultList[0].SUP_AMOUNT);
						Ext.getCmp('V_TAX').setValue(jResult.resultList[0].TAX_AMOUNT);
						
						Ext.getCmp('TOTAL_AMOUNT').setValue(jResult.resultList[0].TOT_AMOUNT);
						
						Ext.getCmp('NTS_ISSUE_ID').setValue(jResult.resultList[0].NTS_ISSUE_ID);
						
						
						if(Number(jResult.resultList[0].ITEM_QTY) > 0){
							Ext.getCmp('V_QTY_YN').setValue({QTY_YN:['Y']});
						}
						else{
							Ext.getCmp('V_QTY_YN').setValue({QTY_YN:['N']});
						}
						
						//품목정보
						var store = Ext.getStore('WinBillPopStore');
						if(Ext.getCmp('V_DTL_TYPE').getValue() == 'LIST'){
							store.load({
								params:{
									V_TYPE : 'TOT_BILL_INFO_LIST',
									V_SHOW_TYPE : Ext.getCmp('V_SHOW_TYPE').getValue(),
									V_BILL_NO : Ext.getCmp('V_TAX_BILL_NO').getValue(),
									V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
									V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
								},
								callback : function(records, operation, success) {
									var jResult = Ext.JSON.decode(operation._response.responseText);
									
									
									
								}
							});
						}
						else{
							var rec = Ext.create('Popup.model.MyModel', {
								PUR_DATE : jResult.resultList[0].TAX_DT,
								ITEM_NM : jResult.resultList[0].ITEM_NM,
								SPEC : '.',
								QTY : jResult.resultList[0].ITEM_QTY,
								PRICE : jResult.resultList[0].ITEM_PRICE,
								SUPPLY_AMOUNT : jResult.resultList[0].SUP_AMOUNT,
								TAX : jResult.resultList[0].TAX_AMOUNT,
								REMARK : jResult.resultList[0].REMARK,
								
							});
							store.insert(0, rec);
						}
						
						
						
					},
					scope : this
				});
				
				
			}
		}
		
		
	},

});
