/*
 * File: app/controller/MyGridController.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('M_BL_TOT_HSPF.controller.MyGridController', {
    extend: 'Ext.app.Controller',

    control: {
        "#gridAddBtn": {
            click: 'gridAddBtnClick'
        },
        "#gridDelBtn": {
            click: 'gridDelBtnClick'
        },
        "#blClsQtyBtn" : {
			click : 'blClsQtyBtnClick'
		},
        "#xlsxDown": {
            click: 'xlsxDownClick'
        },
        "#moveToChBtn": {
        	click: 'moveToChBtnClick'
        },
     
    },

    gridAddBtnClick: function(button, e, eOpts) {
        //var popup = Ext.create("B_COMP_HSPF.view.WinAddRow");
        //popup.show();
        //Ext.getCmp('rowCount').setValue(1);
    },

    gridDelBtnClick: function(button, e, eOpts) {
        var store = Ext.getStore('MyStore');
            	var gridRecord = Ext.getCmp('myGrid').getSelectionModel().getSelection();

            	if(gridRecord.length > 0) {
            		Ext.Msg.confirm('확인','삭제하시겠습니까?', function(button){
            			if(button == 'yes') {
            				for(var i=0; i<gridRecord.length; i++) {
            		    		if(gridRecord[i].data['V_TYPE']=='V') {
            		    			gridRecord[i].data['V_TYPE'] = 'D';
            		    		}
            		    	}
            		    	store.sync({
            					params: {
            						V_USR_ID : 'admin',//parent.Ext.getCmp('GUSER_ID').getValue(),
            					},
            		    		callback: function(records, operation, success) {
            		    			store.reload();
            					}
            		    	});
            			}
            		});
            	}
    },
    
    blClsQtyBtnClick : function(button, e, eOpts) {
		var store = Ext.getStore('MyStore');
		var gridRecord = Ext.getCmp('myGrid').getSelectionModel().getSelection();
	
		if(gridRecord.length < 1){
			Ext.Msg.alert('확인', '선택된 행이 없습니다.');
			return;
		}
			
		for (var i = 0; i < gridRecord.length; i++) {
			gridRecord[i].set('V_TYPE', 'CLS');
		}
		
		Ext.Msg.confirm('확인', '잔량삭제 하시겠습니까?', function(button) {
			if (button == 'yes') {
				store.sync({
					params : {
						V_TYPE : 'CLS',
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
					},
					callback : function(records, operation, success) {
						var tbController = M_BL_TOT_HSPF.app.getController("TbButtonController");
						tbController.selBtnClick();
						
						Ext.getCmp('V_BL_NO').setValue('');
						var nows = new Date();
						Ext.getCmp('V_LOADING_DT').setValue(nows);
						Ext.getCmp('V_M_BP_NM2').setValue('');
						Ext.getCmp('V_M_BP_CD2').setValue('');
						Ext.getCmp('V_BL_DOC_NO').setValue('');
						Ext.getCmp('V_TRANS_TYPE').setValue('');
						Ext.getCmp('V_VESSEL_NO').setValue('');
						Ext.getCmp('V_VESSEL_NM').setValue('');
						Ext.getCmp('V_IN_TERMS').setValue(null);
						Ext.getCmp('V_PAY_METH').setValue(null);
						Ext.getCmp('V_CUR').setValue('USD');
						Ext.getCmp('V_XCH_RATE').setValue(1);
						Ext.getCmp('V_IV_TYPE').setValue('');
						Ext.getCmp('V_FIRST_YN').setValue(false);
					},
					success : function(response) {
						Ext.toast({
							title : ' ',
							timeout : 1000,
							html : '잔량삭제완료',
							style : 'text-align: center',
							align : 't',
							width : 130,
						});
					}
				});
			}
		});
	},

    xlsxDownClick: function(button, e, eOpts) {
        var currentDate = Ext.util.Format.date(new Date(), 'Y-m-d His');
            	var grid = Ext.getCmp('myGrid');
            	grid.saveDocumentAs({
                    type: 'xlsx',
                    title: 'B/L등록(상단)', //엑셀내타이틀
                    fileName: currentDate+'.xlsx' //엑셀파일이름
        		});
    },
moveToChBtnClick: function(button, e, eOpts) {
    	var STEP = '';
    	var BAS_NO = '';
    	if(Ext.getCmp('V_FIRST_YN').getValue() == true){
    		STEP = 'VL';
    		BAS_NO = Ext.getCmp('V_LC_NO').getValue();
    		BAS_DOC_NO = Ext.getCmp('V_LC_DOC_NO').getValue();
    	}
    	else{
    		STEP = 'VB';
    		BAS_NO = Ext.getCmp('V_BL_NO').getValue();
    		BAS_DOC_NO = Ext.getCmp('V_BL_DOC_NO').getValue();
    	}

    	
    	var dynamicTab={
				xtype:'panel',
				title : '부대경비등록',
				autoScroll: true,
				html : '<iframe name="xxx" border =0 src="/HSPF01/TOT/ch/m_charge_tot_hspf/M_CHARGE_TOT_HSPF.jsp?S_TYPE=AUTO&STEP=' + STEP +'&BAS_NO=' + BAS_NO + '&BAS_DOC_NO='+ BAS_DOC_NO + '"  width="100%" height="100%"></iframe>',
				closable : true,
		};
		parent.Ext.getCmp('myTab').add(dynamicTab).show();
		
    },
    
});
