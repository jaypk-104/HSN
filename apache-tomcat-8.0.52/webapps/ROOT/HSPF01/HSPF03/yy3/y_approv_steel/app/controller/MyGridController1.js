/*
 * File: app/controller/MyGridController1.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Y_APPROV_STEEL.controller.MyGridController1', {
    extend: 'Ext.app.Controller',
	stores : [  'MyStore', 'MyStore1'],
	control : {
		"#gridSaveBtn1" : { // 
			click : 'gridSaveBtn1Click'
		},
		"#xlsxDown2" : { // 
			click : 'xlsxDown2Click'
		},
	},
	
	xlsxDown2Click: function(button, e, eOpts) {
	        var currentDate = Ext.util.Format.date(new Date(), 'Y-m-d His');
        	var grid = Ext.getCmp('myGrid1');
        	grid.saveDocumentAs({
                type: 'xlsx',
                title: '품의서 원가표', //엑셀내타이틀
                fileName: currentDate+'.xlsx' //엑셀파일이름
    		});
    },
	
	gridSaveBtn1Click: function() {
		var store = this.getMyStoreStore(); 
		var store1 = this.getMyStore1Store(); 
		var flag = '';
		var gridRecord = Ext.getCmp('myGrid').getSelectionModel().getSelection();
		var gridRecord1 = Ext.getCmp('myGrid1').getSelectionModel().getSelection();

		store.each(function(record, idx) {
			if(record.get('PO_NO') == undefined) {
				flag = 'T';
				return false;
			} else {
				flag = 'F';
			}
		});
//		flag = 'T';
		
		if(flag == 'T') {
			store1.each(function(record, idx) {
				record.set('V_TYPE', 'I');
			});
			store1.sync({
				params : {
					V_TAB_TYPE: 'T1',
					V_TYPE : 'SYNC2',
					V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
					V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
					V_APPROV_MGM_NO:Ext.getCmp('V_APPROV_MGM_NO').getValue(),
					V_APPROV_MGM_SEQ: 0
				},
				callback : function(records, operation, success) {
					var res = records.operations[0]._response.responseText;
					
					if(res.match('Exception')) {
						Ext.Msg.alert('확인', res);
					} else {
						store1.reload();
					}
				}, 
				success: function() {
				}
			});
		} else {
			Ext.Msg.alert('확인', '발주가 생성된 품의는 계산 할 수 없습니다.');
		}
		
	},
	
});
