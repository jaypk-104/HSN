/*
 * File: app/controller/MyController.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('S_SO_HSPF.controller.MySearchFormController', {
    extend: 'Ext.app.Controller',
    control: {
        "#frmCfmBtn": {
            click: 'frmCfmBtnClick'
        },
        "#saveBtn": {
            click: 'saveBtnClick'
        },
        "#delBtn": {
            click: 'delBtnClick'
        },
        "#clsBtn": {
            click: 'clsBtnClick'
        },
        "mysearchform textfield[name=search_field]": {
            specialkey: 'tfEnter'
        }
    },
    
    //수주헤더저장
    frmCfmBtnClick: function() {
    	var store = Ext.getStore('MyStore');
    	if(Ext.getCmp('V_SO_CFM').getValue()=='Y') {
    		Ext.MessageBox.confirm('확인', '확정취소하시겠습니까?', function(btn) {
    			if(btn == 'yes') {
    				Ext.Ajax.request({
    		    		url: 'sql/s_so_hspf_H.jsp',
    		    		method: 'post',
    		    		params: {
    		    			V_TYPE: 'SC',
    						V_COMP_ID: parent.Ext.getCmp('GCOMP_ID').getValue(),
    						V_USR_ID: parent.Ext.getCmp('GUSER_ID').getValue(),
    						V_SO_NO: Ext.getCmp('V_SO_NO').getValue(),
    						V_SO_CFM: 'N'
    		    		},
    		    		callback : function(records,operations,success){
    		    			Ext.getCmp('gridAddBtn').setDisabled(false);
    		    			Ext.getCmp('gridDelBtn').setDisabled(false);
    		    			Ext.getCmp('gridSaveBtn').setDisabled(false);
    		    			Ext.getCmp('saveBtn').setDisabled(false);
    		    			Ext.getCmp('delBtn').setDisabled(false);
    		    			
    		    			Ext.getCmp('V_SO_NO').setEditable(true);
	    					Ext.getCmp('V_SO_TYPE').show();
	    					Ext.getCmp('V_SO_TYPE_N').hide();
	    					Ext.getCmp('V_SO_DT').show();
	    					Ext.getCmp('V_SO_DT_N').hide();
	    					Ext.getCmp('V_PAY_METH').show();
	    					Ext.getCmp('V_PAY_METH_N').hide();
	    					Ext.getCmp('V_DLVY_HOPE_DT').show();
	    					Ext.getCmp('V_DLVY_HOPE_DT_N').hide();
	    					Ext.getCmp('V_CUST_ORDER_NO').setEditable(true);
	    					Ext.getCmp('V_BP_NM').setEditable(true);
	    					Ext.getCmp('V_CUR').show();
	    					Ext.getCmp('V_CUR_N').hide();
	    					Ext.getCmp('V_XCH_RATE').show();
	    					Ext.getCmp('V_XCH_RATE_N').hide();
	    					
	    					Ext.getCmp('V_SO_CFM').setValue('N');
	    					
	    					Ext.toast({
	    						  title: ' ',
	    						  timeout: 1000,
	    						  html: '확정취소완료',
	    						  style: 'text-align: center',
	    						  align: 't',
	    						  width: 130,
	    					});
	    					
	    					store.reload();
    		    	    },
    		    	    success : function(response) {
    		    	    },
    		    		scope: this
    		    	});
    			}
    		});
    	} else if(Ext.getCmp('V_SO_CFM').getValue() == 'N') { 
    		var store = Ext.getStore('MyStore');
    		
    		Ext.MessageBox.confirm('확인', '확정하시겠습니까?', function(btn) {
    			if(btn == 'yes') {
    				var myMask = new Ext.LoadMask(Ext.getCmp('myGrid') , {msg:"인터페이스 중"});
					myMask.show();
    				
					Ext.Ajax.request({
    		    		url: 'sql/s_so_hspf_H.jsp',
    		    		method: 'post',
    		    		params: {
    		    			V_TYPE: 'SC',
    						V_COMP_ID: parent.Ext.getCmp('GCOMP_ID').getValue(),
    						V_USR_ID: parent.Ext.getCmp('GUSER_ID').getValue(),
    						V_SO_NO: Ext.getCmp('V_SO_NO').getValue(),
    						V_SO_CFM: 'Y'
    		    		},
    		    		callback : function(records,operations,success){
    		    			Ext.Msg.alert('확인', '수주확정 완료');
    		    			
    		    			Ext.getCmp('gridAddBtn').setDisabled(true);
    		    			Ext.getCmp('gridDelBtn').setDisabled(true);
    		    			Ext.getCmp('gridSaveBtn').setDisabled(true);
    		    			Ext.getCmp('saveBtn').setDisabled(true);
    		    			Ext.getCmp('delBtn').setDisabled(true);
    		    			
    		    			Ext.getCmp('V_SO_NO').setEditable(false);
	    					Ext.getCmp('V_SO_TYPE').hide();
	    					Ext.getCmp('V_SO_TYPE_N').show();
	    					Ext.getCmp('V_SO_DT').hide();
	    					Ext.getCmp('V_SO_DT_N').show();
	    					Ext.getCmp('V_PAY_METH').hide();
	    					Ext.getCmp('V_PAY_METH_N').show();
	    					Ext.getCmp('V_DLVY_HOPE_DT').hide();
	    					Ext.getCmp('V_DLVY_HOPE_DT_N').show();
	    					Ext.getCmp('V_CUST_ORDER_NO').setEditable(false);
	    					Ext.getCmp('V_BP_NM').setEditable(false);
	    					Ext.getCmp('V_CUR').hide();
	    					Ext.getCmp('V_CUR_N').show();
	    					Ext.getCmp('V_XCH_RATE').hide();
	    					Ext.getCmp('V_XCH_RATE_N').show();
	    					
	    					Ext.getCmp('V_SO_CFM').setValue('Y');
	    					store.reload();
	    					myMask.hide();
    		    	    },
    		    	    success : function(response) {
    		    	    	
    		    	    },
    		    		scope: this
    		    	});
					
    				
    			}
    		});
    	}
    },
    onLaunch: function(application) {
    	
    }

});
