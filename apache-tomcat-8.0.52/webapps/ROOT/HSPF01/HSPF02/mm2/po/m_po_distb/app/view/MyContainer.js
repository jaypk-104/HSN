/*
 * File: app/view/MyContainer.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('M_PO_DISTB.view.MyContainer', {
    extend: 'Ext.container.Container',
    alias: 'widget.mycontainer',
    
    requires: [
        'M_PO_DISTB.view.MyContainerViewModel',
        'M_PO_DISTB.view.MyContainerViewController',
        'Ext.form.FieldSet',
        'Ext.form.FieldContainer',
        'Ext.form.field.ComboBox',
        'Ext.form.field.Date',
        'Ext.grid.Panel',
        'Ext.view.Table',
        'Ext.grid.column.RowNumberer',
        'Ext.form.field.Number',
        'Ext.grid.column.Number',
        'Ext.grid.column.Date',
        'Ext.selection.CheckboxModel',
        'Ext.grid.plugin.Exporter',
        'Ext.grid.plugin.CellEditing'
    ],
    id: 'mycontainer',
    controller: 'mycontainer',
    viewModel: {
        type: 'mycontainer'
    },
    flex: 1,
    padding: '0 10 0 10',

    layout: {
        type: 'vbox',
        align: 'stretch'
    },
    items: [
        {
            xtype: 'container',
            items: [
                {
                    xtype: 'fieldset',
                    cls: 'gridfieldset',
                    height: 180,
                    maxHeight: 180,
                    minHeight: 180,
                    title: '발주정보',
                    layout: {
                        type: 'vbox',
                        align: 'stretch',
                        pack: 'center',
                        padding: 10
                    },
                    items: [
                        {
                            xtype: 'fieldcontainer',
                            layout: {
                                type: 'hbox',
                                align: 'stretch'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    flex: 1,
                                    id: 'V_PO_NO',
                                    maxWidth: 230,
                                    minWidth: 230,
                                    width: 230,
                                    fieldLabel: '발주번호',
                                    labelWidth: 80,
                                    emptyText: '(Double Click)',
                                    listeners: {
                                        afterrender: function(c) {
                                        	c.getEl().on('dblclick', function() {
                                        		var popup = Ext.create("M_PO_DISTB.view.WinPoPop");
                                                
                                                popup.setSize(Ext.getBody().getViewSize());
                                                popup.show();
                                                
                                                var store = Ext.getStore('PopStore');
                                                M_PO_DISTB.app.getController("PoPopController").w_poSelBtnClick();
//                                        		store.removeAll();
                                            });
                                        }
                                    },
                                    fieldStyle: 'background-color: #ffefbb'
                                },
                                {
                                    xtype: 'textfield',
                                    flex: 1,
                                    id: 'V_APPROV_NO',
                                    margin: '0 0 0 30',
                                    maxWidth: 230,
                                    minWidth: 230,
                                    width: 230,
                                    fieldLabel: '품의번호',
                                    labelWidth: 80,
                                    emptyText: '(Double Click)',
                                    listeners: {
                                        afterrender: function(c) {
                                        	c.getEl().on('dblclick', function() {
                                        		var popup = Ext.create("M_PO_DISTB.view.WinConPop");
                                                
                                                popup.setSize(Ext.getBody().getViewSize());
                                                popup.show();
                                                
                                                M_PO_DISTB.app.getController("ConPopController").w_conSelBtnClick();
//                                        		
                                                
                                            });
                                        }
                                    },
                                },
                                {
                                    xtype: 'combobox',
                                    flex: 1,
                                    id: 'V_PO_TYPE',
                                    margin: '0 0 0 30',
                                    maxWidth: 230,
                                    minWidth: 230,
                                    width: 230,
                                    fieldLabel: '<span style=\'color:red\'>*</span>발주유형',
                                    labelWidth: 80,
                                    displayField: 'DTL_NM',
                                    valueField: 'DTL_CD',
                                    editable: false,
                                    store: Ext.create('Ext.data.Store',{
                                  		autoLoad: true,
                                  		storeId: 'store1',
                                  		proxy: {
                                              type: 'ajax',
                                              extraParams: {
                                               	V_MAST_CD: 'MA02',
                                               	V_GRID: 'Y'
                                              },	
                                              api: {
                                                  read: '/HSPF01/common/sql/Combobox.jsp'
                                              },
                                              reader: {
                                                  type: 'json',
                                                  rootProperty: 'resultList'
                                              }
                                          }
                                  	}),
                                  	listConfig: {
                                        itemTpl: [
                                            '<div>{DTL_NM} ({DTL_CD})</div>'
                                        ]
                                    }
                                },
                                {
                                    xtype: 'checkboxfield',
                                    fieldLabel: 'B/L생성유무',
                                    labelAlign: 'right',
                                    boxLabel: '',
                                    id: 'V_BL_YN'
                                },
                                {
                                	xtype: 'checkboxfield',
                                	fieldLabel: '양도/양수',
                                	labelAlign: 'right',
                                	boxLabel: '',
                                    width: 120,
                                    labelWidth:60,
                                    margin: '0 0 0 10',
                                    id: 'V_TRANSFER'
                                },
                                {
                                    xtype: 'datefield',
                                    id: 'V_PO_DT',
//                                    margin: '0 0 0 30',
                                    maxWidth: 230,
                                    minWidth: 230,
                                    style: '',
                                    width: 230,
                                    fieldLabel: '<span style=\'color:red\'>*</span>발주일자',
                                    labelWidth: 80,
                                    name: 'search_field',
                                    format: 'Y-m-d',
                                    listeners : {
                                        render : function(datefield) {
                                        	var nows = new Date();
                                            datefield.setValue(nows);
                                        },
                                        change : function () {
//                                        	console.log(Ext.getCmp('V_PO_TYPE').getValue());
                                        		if(Ext.getCmp('V_PO_TYPE').getValue() != 'DO') { //내수아닌경우
                                            		//환율 가져오기
                                    				Ext.Ajax.request({
                                    					url : '/HSPF01/common/sql/ERP_DB.jsp',
                                    					method : 'post',
                                    					params: {
                                    						V_TYPE: 'XCH_RT',
                                    						V_DATE : Ext.getCmp('V_PO_DT').getValue(),
                                    						V_CUR : Ext.getCmp('V_CUR').getValue(),
                                    						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
                                    						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
                                    					},
                                    					success: function(response) {
                                    						var res = response.responseText;
                                    						if(res == 'NODATA') {
//                                    							Ext.Msg.alert('확인', '해당 날짜 환율정보가 없습니다. 관리자에게 문의하거나 임의로 입력하세요.');
                                    						} else {
                                    							Ext.getCmp('V_XCH_RATE').setValue(res);
                                    						}
                                    					}
                                    				});
                                            	} else {
                                            		Ext.getCmp('V_XCH_RATE').setValue(1);
                                            	}
                                        }
                                    },
                                }
                            ]
                        },
                        {
                            xtype: 'fieldcontainer',
                            layout: {
                                type: 'hbox',
                                align: 'stretch'
                            },
                            items: [
                                {
                                    xtype: 'numberfield',
                                    id: 'V_XCH_RATE',
                                    flex: 1,
                                    maxWidth: 230,
                                    minWidth: 230,
                                    width: 230,
                                    fieldLabel: '<span style=\'color:red\'>*</span>환율',
                                    labelWidth: 80,
                                    format: '0,000.00.0000',
                                    value: 1,
                                    listeners: {
                                    	change: function(ct, nv, ov) {
                                    		var store = Ext.getStore('MyStore');
                                    		store.each(function(rec, idx) {
                                    			rec.set('PO_LOC_AMT', rec.get('PO_AMT') * nv);
                                    		});
                                    	}
                                    }
                                },
                                {
                                    xtype: 'combobox',
                                    flex: 1,
                                    id: 'V_CUR',
                                    margin: '0 0 0 30',
                                    maxWidth: 230,
                                    minWidth: 230,
                                    width: 230,
                                    fieldLabel: '<span style=\'color:red\'>*</span>화폐단위',
                                    labelWidth: 80,
                                    displayField: 'DTL_NM',
                                    valueField: 'DTL_CD',
                                    value: 'USD',
                                    editable: false,
                                    store: Ext.create('Ext.data.Store',{
                                  		autoLoad: true,
                                  		storeId: 'store1',
                                  		proxy: {
                                              type: 'ajax',
                                              extraParams: {
                                               	V_MAST_CD: 'BA04',
                                               	V_GRID: 'Y'
                                              },	
                                              api: {
                                                  read: '/HSPF01/common/sql/Combobox.jsp'
                                              },
                                              reader: {
                                                  type: 'json',
                                                  rootProperty: 'resultList'
                                              }
                                          }
                                  	}),
                                  	listeners: {
                                  		 change : function () {
                                         	//환율 가져오기
                                  			 
                                  			if(Ext.getCmp('V_PO_TYPE').getValue() != 'DO') { //내수아닌경우
	                             				Ext.Ajax.request({
	                             					url : '/HSPF01/common/sql/ERP_DB.jsp',
	                             					method : 'post',
	                             					params: {
	                             						V_TYPE: 'XCH_RT',
	                             						V_DATE : Ext.getCmp('V_PO_DT').getValue(),
	                             						V_CUR : Ext.getCmp('V_CUR').getValue(),
	                             						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
	                             						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
	                             					},
	                             					success: function(response) {
	                             						var res = response.responseText;
	                             						if(res == 'NODATA') {
	                             							Ext.Msg.alert('확인', '해당 날짜 환율정보가 없습니다. 관리자에게 문의하거나 임의로 입력하세요.');
	                             						} else {
	                             							Ext.getCmp('V_XCH_RATE').setValue(res);
	                             						}
	                             					}
	                             				});
                                  			} else {
                                  				Ext.getCmp('V_XCH_RATE').setValue(1);
                                  			}
                                         }
                                  	}
                                },
                                {
                                    xtype: 'combobox',
                                    flex: 1,
                                    id: 'V_IN_TERMS',
                                    margin: '0 0 0 30',
                                    maxWidth: 300,
                                    minWidth: 300,
                                    width: 300,
                                    fieldLabel: '<span style=\'color:red\'>*</span>가격조건',
                                    labelWidth: 80,
                                    displayField: 'DTL_NM',
                                    valueField: 'DTL_CD',
                                    editable: false,
                                    store: Ext.create('Ext.data.Store',{
                                  		autoLoad: true,
                                  		storeId: 'store1',
                                  		proxy: {
                                              type: 'ajax',
                                              extraParams: {
                                               	V_MAST_CD: 'MA04',
                                               	V_GRID: 'Y'
                                              },	
                                              api: {
                                                  read: '/HSPF01/common/sql/Combobox.jsp'
                                              },
                                              reader: {
                                                  type: 'json',
                                                  rootProperty: 'resultList'
                                              }
                                          }
                                  	}),
                                  	listConfig: {
                                        itemTpl: [
                                            '<div>{DTL_NM} ({DTL_CD})</div>'
                                        ],
                                    }
                                },
                                {
                                    xtype: 'combobox',
                                    flex: 1,
                                    id: 'V_PAY_METH',
                                    margin: '0 0 0 30',
                                    maxWidth: 350,
                                    minWidth: 350,
                                    width: 350,
                                    fieldLabel: '<span style=\'color:red\'>*</span>결제방법',
                                    displayField: 'DTL_NM',
                                    valueField: 'DTL_CD',
                                    labelWidth: 80,
                                    editable: false,
                                    store: Ext.create('Ext.data.Store',{
                                  		autoLoad: true,
                                  		storeId: 'store1',
                                  		proxy: {
                                              type: 'ajax',
                                              extraParams: {
                                               	V_MAST_CD: 'MA03',
                                               	V_GRID: 'Y'
                                              },	
                                              api: {
                                                  read: '/HSPF01/common/sql/Combobox.jsp'
                                              },
                                              reader: {
                                                  type: 'json',
                                                  rootProperty: 'resultList'
                                              }
                                          }
                                  	}),
                                  	listConfig: {
                                        itemTpl: [
                                            '<div>{DTL_NM} ({DTL_CD})</div>'
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'fieldcontainer',
                            layout: {
                                type: 'hbox',
                                align: 'stretch'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    flex: 1,
                                    id: 'V_M_BP_NM',
                                    maxWidth: 230,
                                    minWidth: 230,
                                    width: 230,
                                    fieldLabel: '<span style=\'color:red\'>*</span>매입처',
                                    labelWidth: 80,
                                    emptyText: '(Double Click)',
                                    listeners: {
                                        afterrender: function(c) {
                                        	c.getEl().on('dblclick', function() {
                                    			var popup = Ext.create("Popup.view.WinMBpPop");
                                    			popup.show();
                                    			
                                    			Ext.getCmp('fieldType').setValue('M_PO_DISTB');
                                    			var store = Ext.getStore('WinMBpPopStore');
                                    			store.removeAll();
                                            });
                                        },
                                        change: function(field, newValue, oldValue, eOpts) {
                                        	if(newValue.length == 0) {
                                        		Ext.getCmp('V_M_BP_CD').setValue('');
                                        	}
                                        }
                                    }
                                },
                                {
                                	xtype: 'textfield',
                                	flex: 1,
                                	id: 'V_M_BP_CD',
                                	maxWidth: 230,
                                	minWidth: 230,
                                	width: 230,
                                	fieldLabel: '공급사코드',
                                	labelWidth: 80,
                                	hidden: true
                                },
                                {
                                	xtype: 'textfield',
                                	flex: 1,
                                	id: 'V_PO_CFM',
                                	maxWidth: 230,
                                	minWidth: 230,
                                	width: 230,
                                	fieldLabel: 'PO_CFM',
                                	labelWidth: 80,
                                	hidden: true
                                },
                                {
                                    xtype: 'textfield',
                                    flex: 1,
                                    id: 'V_S_BP_NM',
                                    margin: '0 0 0 30',
                                    maxWidth: 230,
                                    minWidth: 230,
                                    width: 230,
                                    fieldLabel: '<span style=\'color:red\'>*</span>수주처',
                                    labelWidth: 80,
                                    emptyText: '(Double Click)',
                                    listeners: {
                                        afterrender: function(c) {
                                        	c.getEl().on('dblclick', function() {
                                    			var popup = Ext.create("Popup.view.WinSBpPop");
                                    			popup.show();
                                    			
                                    			Ext.getCmp('fieldType').setValue('M_PO_DISTB');
                                    			var store = Ext.getStore('WinSBpPopStore');
                                    			store.removeAll();
                                            });
                                        }
                                    }
                                },
                                {
                                	xtype: 'textfield',
                                	flex: 1,
                                	id: 'V_S_BP_CD',
                                	margin: '0 0 0 30',
                                	maxWidth: 230,
                                	minWidth: 230,
                                	width: 230,
                                	fieldLabel: '고객사',
                                	labelWidth: 80,
                                	hidden: true
                                },
                                {
                                    xtype: 'textfield',
                                    flex: 1,
                                    id: 'V_PUR_USR',
                                    margin: '0 0 0 30',
                                    maxWidth: 230,
                                    minWidth: 230,
                                    width: 230,
                                    fieldLabel: '구매담당',
                                    labelWidth: 80,
                                    hidden : true
                                },
                                {
                                    xtype: 'textfield',
                                    flex: 1,
                                    id: 'V_PUR_USR_NM',
                                    margin: '0 0 0 30',
                                    maxWidth: 230,
                                    minWidth: 230,
                                    width: 230,
                                    fieldLabel: '구매담당',
                                    labelWidth: 80
                                },
                                {
                                    xtype: 'combobox',
                                    flex: 1,
                                    id: 'V_TRANSPORT',
                                    value: 'SHP',
                                    fieldLabel: '<span style=\'color:red\'>*</span>운송방법',
                                    margin: '0 0 0 30',
                                    maxWidth: 230,
                                    minWidth: 230,
                                    width: 230,
                                    displayField: 'DTL_NM',
                                    valueField: 'DTL_CD',
                                    labelWidth: 80,
                                    editable: false,
                                    store: Ext.create('Ext.data.Store',{
                                  		autoLoad: true,
                                  		storeId: 'store1',
                                  		proxy: {
                                              type: 'ajax',
                                              extraParams: {
                                               	V_MAST_CD: 'BA06',
                                               	V_GRID: 'Y'
                                              },	
                                              api: {
                                                  read: '/HSPF01/common/sql/Combobox.jsp'
                                              },
                                              reader: {
                                                  type: 'json',
                                                  rootProperty: 'resultList'
                                              }
                                          }
                                  	}),
                                  	listConfig: {
                                        itemTpl: [
                                            '<div>{DTL_NM} ({DTL_CD})</div>'
                                        ]
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    flex: 1,
                                    id: 'V_REMARK',
                                    margin: '0 0 0 30',
                                    maxWidth: 300,
                                    minWidth: 300,
                                    width: 300,
                                    fieldLabel: '비고',
                                    labelWidth: 80
                                },
                                {
                                	xtype: 'textfield',
                                	flex: 1,
                                	id: 'V_APPROV_MGM_NO',
                                	margin: '0 0 0 30',
                                	maxWidth: 200,
                                	minWidth: 200,
                                	width: 200,
                                	fieldLabel: '비고',
                                	labelWidth: 80,
                                	hidden: true
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            xtype: 'container',
            flex: 1,
            layout: 'fit',
            items: [
                {
                    xtype: 'gridpanel',
                    store: 'MyStore',
                    tbar: [
                        {
                            id: 'gridAddBtn',
                            text: '',
                            margin: '0 3 0 0',
                            glyph: 'xf055@FontAwesome',
                            iconCls: 'grid-add-btn'
                        },
                        {
                            id: 'gridDelBtn',
                            text: '',
                            margin: '0 3 0 0',
                            glyph: 'xf056@FontAwesome',
                            iconCls: 'grid-del-btn'
                        },
                        {
                            xtype: 'container',
                            flex: 1
                        },
                        {
                        	id: 'gridPoEnd',
                        	xtype: 'button',
                        	text: '오퍼취소',
                        	margin: '0 3 0 0',
//                        	disabled: true,
                        	cls: 'blue-btn',
                        	style: 'background-color: white; border: 0.5px solid #3367d6;'
                        },
                        {
                        	id: 'gridPoSave',
                        	xtype: 'button',
                        	text: '발주저장',
                        	margin: '0 3 0 0',
//                        	disabled: true,
                            cls: 'blue-btn',
                            style: 'background-color: white; border: 0.5px solid #3367d6;'
                        },
                        {
                        	id: 'gridPoCfm',
                        	xtype: 'button',
                        	text: '확정/취소',
                        	margin: '0 3 0 0',
//                        	disabled: true,
                        	cls: 'blue-btn',
                        	style: 'background-color: white; border: 0.5px solid #3367d6;'
                        },
                        {
                        	xtype: 'button',
                            id: 'gridPoConfBtn',
                            text: '확정/취소',
                            margin: '0 3 0 0',
                            disabled: true,
                            hidden: true,
                            cls: 'blue-btn',
                            style: 'background-color: white; border: 0.5px solid #3367d6;'
                        },
                        {
                            xtype: 'button',
                            glyph: 'xf1c3@FontAwesome',
                            id: 'xlsxDown',
                            cfg: {
                                type: 'excel07',
                                ext: 'xlsx'
                            },
                            iconCls: 'grid-excel-btn',
                        }
                    ],
                    id: 'myGrid',
                    margin: '-15 -15 0 -15',
                    padding: 10,
                    bodyBorder: false,
                    header: false,
                    store: 'MyStore',
                    columns: [
                        {
                            xtype: 'rownumberer',
                            width: 40
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            text: 'V_TYPE'
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'text-align: center; font-weight: bold;',
                            dataIndex: 'PO_NO',
                            text: '발주번호',
                            width: 170
                        },
                        {
                            xtype: 'numbercolumn',
                            style: 'text-align: center; font-weight: bold;',
                            align: 'end',
                            dataIndex: 'PO_SEQ',
                            enableTextSelection: true,
                            text: '발주순번',
                            format: '0,000'
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'text-align: center; font-weight: bold; color: #3367d6',
                            dataIndex: 'ITEM_CD',
                            text: '<span style=\'color:red\'>*</span>품목코드',
                            width: 130,
                            editor: {
                                xtype: 'textfield',
                                allowBlank: false,
                                emptyText: 'Double Click',
                                editable: false,
                                listeners: {
                                    afterrender: function(c) {
                                    	c.getEl().on('dblclick', function() {
                                    		var popup = Ext.create("Popup.view.WinItemPop");
                                            popup.show();
                                            
                                            var store = Ext.getStore('WinItemPopStore');
                                    		store.removeAll();
                                    		
                                    		Ext.getCmp('W_TYPE').setValue('PO_DISTB');
//                                    		Ext.getCmp('W_M_BP_CD').setValue(Ext.getCmp('V_M_BP_CD2').getValue());
                                        });
                                    }
                                }
                            }
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'text-align: center; font-weight: bold;',
                            dataIndex: 'ITEM_NM',
                            text: '품목명',
                            width: 200
                        },
                        {
                        	xtype: 'gridcolumn',
                        	style: 'text-align: center; font-weight: bold;',
                        	dataIndex: 'UNIT',
                        	text: '단위',
                        	width: 85
                        },
                        {
                            xtype: 'numbercolumn',
                            style: 'text-align: center; font-weight: bold;  color: #3367d6',
                            align: 'end',
                            dataIndex: 'PO_QTY',
                            enableTextSelection: true,
                            exportStyle: {
                                alignment: {
                                    horizontal: 'Right'
                                }
                            },
                            text: '<span style=\'color:red\'>*</span>발주수량',
//                            format: '0,000.00',
                            editor: {
                                xtype: 'numberfield',
                                allowBlank: false,
                                allowExponential: false,
                                minValue: 0
                            } ,
                            summaryType: 'sum',
                            summaryRenderer: function(value, summaryData, dataIndex) {
                                return "<font color='green'>"+Ext.util.Format.number(value, '0,000.00')+"<font>"; 
                            }
                        },
                        {
                            xtype: 'numbercolumn',
                            style: 'text-align: center; font-weight: bold; color: #3367d6',
                            align: 'end',
                            dataIndex: 'PO_PRC',
                            enableTextSelection: true,
                            exportStyle: {
                                alignment: {
                                    horizontal: 'Right'
                                }
                            },
                            text: '<span style=\'color:red\'>*</span>발주단가',
                            format: '0,000.00',
                            editor: {
                                xtype: 'numberfield',
                                allowBlank: false,
                                allowExponential: false,
                                minValue: 0
                            }
                        },
                        {
                            xtype: 'numbercolumn',
                            style: 'text-align: center; font-weight: bold;',
                            align: 'end',
                            dataIndex: 'PO_AMT',
                            enableTextSelection: true,
                            exportStyle: {
                                alignment: {
                                    horizontal: 'Right'
                                }
                            },
                            text: '발주금액',
                            format: '0,000.00',
                            editor: {
                                xtype: 'numberfield',
                                allowBlank: false,
                                allowExponential: false,
                                minValue: 0
                            } ,
                            summaryType: 'sum',
                            summaryRenderer: function(value, summaryData, dataIndex) {
                                return "<font color='green'>"+Ext.util.Format.number(value, '0,000.00')+"<font>"; 
                            },
                            width: 130
                        },
                        {
                            xtype: 'numbercolumn',
                            style: 'text-align: center; font-weight: bold;',
                            align: 'end',
                            dataIndex: 'PO_LOC_AMT',
                            enableTextSelection: true,
                            exportStyle: {
                               
                                alignment: {
                                    horizontal: 'Right'
                                }
                            },
                            text: '발주자국금액',
                            format: '0,000.',
                            editor: {
                                xtype: 'numberfield',
                                allowBlank: false,
                                allowExponential: false,
                                minValue: 0
                            } ,
                            summaryType: 'sum',
                            summaryRenderer: function(value, summaryData, dataIndex) {
                                return "<font color='green'>"+Ext.util.Format.number(value, '0,000')+"<font>"; 
                            },
                            width: 130
                        },
                        {
                        	xtype: 'gridcolumn',
                        	style: 'text-align: center; font-weight: bold; color: #3367d6; ',
                        	text: '<span style=\'color:red\'>*</span>부가세유형',
                        	dataIndex: 'VAT_TYPE',
                        	width: 200,
                        	align: 'left',
                        	editor: {
                        		xtype: 'combobox',
                        		displayField: 'DTL_NM',
                        		autoLoadOnValue: true,
                        		valueField: 'DTL_CD',
                        		editable: false,
                        		store: Ext.create('Ext.data.Store',{
                        			autoLoad: true,
                        			storeId: 'store1',
                        			proxy: {
                        		           type: 'ajax',
                        		           extraParams: {
                        		            	V_MAST_CD: 'BA05',
                        		            	V_GRID: 'Y'
                        		           },	
                        		           api: {
                        		               read: '/HSPF01/common/sql/Combobox.jsp'
                        		           },
                        		           reader: {
                        		               type: 'json',
                        		               rootProperty: 'resultList'
                        		           }
                        		       }
                        		}),
                        	},
                        	renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                if(Ext.data.StoreManager.lookup('store1').findRecord('DTL_CD',value) !==null)
                                {
                                    return Ext.data.StoreManager.lookup('store1').findRecord('DTL_CD',value).get('DTL_NM');
                                }
                                return value;
                            },
                            emptyCellText: '(필수)',
                        },
                        {
                            xtype: 'numbercolumn',
                            style: 'text-align: center; font-weight: bold;',
                            text: '부가세율',
                            dataIndex: 'VAT_RATE'
                        },
                        {
                            xtype: 'numbercolumn',
                            style: 'text-align: center; font-weight: bold;',
                            align: 'end',
                            dataIndex: 'VAT_AMT',
                            enableTextSelection: true,
                            exportStyle: {
                                alignment: {
                                    horizontal: 'Right'
                                }
                            },
                            text: '부가세금액',
                            format: '0,000.00',
                            summaryType: 'sum',
                            summaryRenderer: function (value, summaryData, dataIndex) {
                                return "<font color='green'>"+Ext.util.Format.number(value, '0,000.00')+"<font>"; 
                            }
                        },
                        {
                            xtype: 'datecolumn',
                            style: 'text-align: center; font-weight: bold; color: #3367d6',
                            align: 'center',
                            dataIndex: 'DLVY_HOPE_DT',
                            enableTextSelection: true,
                            exportStyle: {
                                format: 'Short Date'
                            },
                            text: '납기요청일',
                            format: 'Y-m-d',
                            editor: {
                                xtype: 'datefield',
                            	format: 'Y-m-d',
                            },
                            hidden: true
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'text-align: center; font-weight: bold;  color: #3367d6',
                            text: '납기요청창고',
                            dataIndex: 'HOPE_SL_CD',
                            width: 150,
                            hidden: true,
                            editor: {
                        		xtype: 'combobox',
                        		editable: false,
                        		displayField: 'DTL_NM',
                        		autoLoadOnValue: true,
                        		valueField: 'DTL_CD',
                        		store: Ext.create('Ext.data.Store',{
                        			autoLoad: true,
                        			storeId: 'sl_combo',
                        			proxy: {
                        		           type: 'ajax',
                        		           extraParams: {
                        		            	V_MAST_CD: 'SL_DISTR',
                        		            	V_GRID: 'Y'
                        		           },	
                        		           api: {
                        		               read: '/HSPF01/common/sql/Combobox.jsp'
                        		           },
                        		           reader: {
                        		               type: 'json',
                        		               rootProperty: 'resultList'
                        		           }
                        		       }
                        		})
                        	},
                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                if(Ext.data.StoreManager.lookup('sl_combo').findRecord('DTL_CD',value) !==null)
                                {
                                    return Ext.data.StoreManager.lookup('sl_combo').findRecord('DTL_CD',value).get('DTL_NM');
                                }
                                return value;
                            },
                        },
                        {
                            xtype: 'gridcolumn',
                            text: '브랜드',
                            editor: {
                                xtype: 'textfield'
                            },
                            dataIndex: 'BRAND',
                            style: 'text-align: center; font-weight: bold; color: #3367d6',
                            editor: {
                                xtype: 'textfield'
                            },
                            width: 150
                        },
                        {
                            xtype: 'gridcolumn',
                            text: '원산지',
                            dataIndex: 'ORIGIN',
                            style: 'text-align: center; font-weight: bold; color: #3367d6',
                            editor: {
                        		xtype: 'combobox',
                        		displayField: 'DTL_NM',
                        		autoLoadOnValue: true,
                        		valueField: 'DTL_CD',
                        		editable: false,
                        		store: Ext.create('Ext.data.Store',{
                        			autoLoad: true,
                        			storeId: 'stored',
                        			proxy: {
                        		           type: 'ajax',
                        		           extraParams: {
                        		            	V_MAST_CD: 'ORIGIN',
                        		            	V_GRID: 'Y'
                        		           },	
                        		           api: {
                        		               read: '/HSPF01/common/sql/Combobox.jsp'
                        		           },
                        		           reader: {
                        		               type: 'json',
                        		               rootProperty: 'resultList'
                        		           }
                        		       }
                        		}),
                        		listConfig: {
                                    itemTpl: [
                                        '<div>{DTL_NM} ({DTL_CD})</div>'
                                    ]
                                },
                        	},
                        	renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                if(Ext.data.StoreManager.lookup('stored').findRecord('DTL_CD',value) !==null)
                                {
                                    return Ext.data.StoreManager.lookup('stored').findRecord('DTL_CD',value).get('DTL_NM');
                                }
                                return value;
                            },
                        },
                        {
                        	xtype: 'gridcolumn',
                        	text: '컨테이너분류',
                        	dataIndex: 'CONT_REMARK',
                        	style: 'text-align: center; font-weight: bold; ',
                        	editor: {
                        		xtype: 'textfield'
                        	},
                        },
                        {
                        	xtype: 'numbercolumn',
                        	text: '컨테이너수량',
                        	dataIndex: 'CONT_QTY',
                        	style: 'text-align: center; font-weight: bold; ',
                        	align: 'right',
                        	format: '0,000.',
                        	width: 110,
                        	editor: {
                        		xtype: 'numberfield'
                        	},
                        },
                        {
                        	xtype: 'gridcolumn',
                        	text: '공장번호',
                        	dataIndex: 'PLANT_NO',
                        	style: 'text-align: center; font-weight: bold; color: #3367d6',
                        	editor: {
                        		xtype: 'textfield'
                        	},
                            hidden: true
                        },
                        {
                            xtype: 'numbercolumn',
                            style: 'text-align: center; font-weight: bold;  color: #3367d6',
                            align: 'end',
                            dataIndex: 'OVER_TOL',
                            enableTextSelection: true,
                            exportStyle: {
                                alignment: {
                                    horizontal: 'Right'
                                }
                            },
                            text: 'OVER TOL',
                            format: '0,000.00',
                            editor: {
                                xtype: 'numberfield',
                                allowBlank: false,
                                allowExponential: false,
                                minValue: 0
                            }
                        },
                        {
                        	xtype: 'numbercolumn',
                        	style: 'text-align: center; font-weight: bold;  color: #3367d6',
                        	align: 'end',
                        	dataIndex: 'UNDER_TOL',
                        	enableTextSelection: true,
                        	text: 'UNDER TOL',
                        	format: '0,000.00',
                        	editor: {
                        		xtype: 'numberfield',
                        		allowBlank: false,
                        		allowExponential: false,
                        		minValue: 0
                        	}
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'text-align: center; font-weight: bold;  color: #3367d6',
                            dataIndex: 'HS_CD',
                            enableTextSelection: true,
                            text: 'HSCODE',
                            editor: {
                            	xtype: 'textfield'
                            },
                            hidden: true
                        },
                        {
                        	xtype: 'gridcolumn',
                        	style: 'text-align: center; font-weight: bold;  color: #3367d6',
                        	dataIndex: 'APPROV_MGM_NO',
                        	enableTextSelection: true,
                        	text: 'APPROV_MGM_NO',
                        	hidden: true
                        },
                        {
                        	xtype: 'gridcolumn',
                        	style: 'text-align: center; font-weight: bold;  color: #3367d6',
                        	dataIndex: 'APPROV_MGM_SEQ',
                        	enableTextSelection: true,
                        	text: 'APPROV_MGM_SEQ',
                        	hidden: true
                        },
                        {
                        	xtype: 'gridcolumn',
                        	style: 'text-align: center; font-weight: bold; ',
                        	dataIndex: 'MAST_DB_NO',
                        	enableTextSelection: true,
                        	text: '담보번호',
                        	width: 150
//                        	hidden: true
                        },
                        {
                        	xtype: 'gridcolumn',
                        	style: 'text-align: center; font-weight: bold; ',
                        	dataIndex: 'END_FLAG',
                        	enableTextSelection: true,
                        	text: '취소여부',
                        	width: 100,
                        	align: 'center'
//                        	hidden: true
                        },
                        {
                        	xtype: 'gridcolumn',
                        	style: 'text-align: center; font-weight: bold; color: #3367d6',
                        	dataIndex: 'END_APPROV_NO',
                        	enableTextSelection: true,
                        	text: '취소품의번호',
                        	width: 150,
                        	editor: {
                        		xtype: 'textfield'
                        	}
                        },
                    ],
                    selModel: {
                        selType: 'checkboxmodel',
                        listeners: {
                        	select: function(rowmodel, record, index, eOpts) {
                            	record.set('V_TYPE', 'V');
                            },
                            deselect: function(rowmodel, record, index, eOpts) {
                            	record.set('V_TYPE', '');
                            }
                        }
                    },
                    viewConfig: {
                    	enableTextSelection: true,
                    },
                    plugins: [
                        {
                            ptype: 'gridexporter'
                        },
                        {
                            ptype: 'cellediting',
                            clicksToEdit: 1,
                            listeners: {
                            	edit: function(editor, context, eOpts) {
                            		var XCH_RT = Ext.getCmp('V_XCH_RATE').getValue();

                            		var PO_QTY = context.record.get('PO_QTY'); 
                            		var PO_PRC = context.record.get('PO_PRC'); 
                            		var HOPE_SL_CD = context.record.get('HOPE_SL_CD'); 
                            		var VAT_TYPE = context.record.get('VAT_TYPE');
                            		var store = Ext.data.StoreManager.lookup('MyStore');
                            		
                            		
                            		if ((context.column.dataIndex == 'PO_QTY' ||
                        				context.column.dataIndex == 'PO_PRC'	) 
                            			&& (PO_QTY != undefined) 
                            			&& (PO_PRC != undefined)) {
                            			context.record.set('PO_LOC_AMT', PO_QTY * PO_PRC* XCH_RT);
                            			context.record.set('PO_AMT', PO_QTY * PO_PRC );
                            		}
                            		
                            		if (context.column.dataIndex == 'VAT_TYPE') {
                            			// 부가세유형 변경시 다른 ROW도 일괄 변경합니다.
                            			
                            			store.each(function(record,idx) {
                            				var PO_QTY2 = store.getAt(idx).get('PO_QTY'); 
                            				var PO_PRC2 = store.getAt(idx).get('PO_PRC'); 
                            				
                            				if (VAT_TYPE == 'A') {
                            					store.getAt(idx).set('VAT_TYPE', 'A');
                            					store.getAt(idx).set('VAT_AMT', PO_QTY2 * PO_PRC2 * 0.1);
                            					store.getAt(idx).set('VAT_RATE', 10);
                            				} else {
                            					store.getAt(idx).set('VAT_TYPE', VAT_TYPE);
                                        		store.getAt(idx).set('VAT_AMT', 0); //부가세금액
                                        		store.getAt(idx).set('VAT_RATE', 0);
                            				}
                            			})
                            		}
                            		
                            		if (context.column.dataIndex == 'HOPE_SL_CD') {
                            			store.each(function(record, idx) {
                            				store.getAt(idx).set('HOPE_SL_CD', HOPE_SL_CD);
                            			})
                            		}
                            	}
                            	}
                        }
                    ]
                    ,
                    features: [
                       {
                           ftype: 'summary'
                       }
                    ],
                    viewConfig: {
                      	enableTextSelection: true,
                    	getRowClass: function(record, index) {
                    		
                    			var END_FLAG = record.get('END_FLAG');
                    			if(END_FLAG == 'Y') {
                    				return 'bg-gray';
                    			}
                        },
                    },

                }
            ]
        }
    ]

});