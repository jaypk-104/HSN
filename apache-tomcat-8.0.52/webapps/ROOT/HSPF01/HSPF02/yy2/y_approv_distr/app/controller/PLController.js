/*
 * File: app/controller/PLController.js
 *
 * This file was generated by Sencha Architect version 4.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Y_APPROV_DISTR.controller.PLController', {
    extend: 'Ext.app.Controller',

    control: {
        "#PLGridAddBtn": {
            click: 'PLGridAddBtnClick'
        },
        "#PLGridDelBtn": {
            click: 'PLGridDelBtnClick'
        },
        "#PLAddCfmBtn": {
            click: 'PLAddCfmBtnClick'
        },
        "#PLSaveBtn": {
            click: 'PLSaveBtnClick'
        }
    },

    PLGridAddBtnClick: function(button, e, eOpts) {
        var window = Ext.create('Y_APPROV_DISTR.view.PLAddWindow');
        var store = this.getStore('PLAddStore');
        store.removeAll();
        store.load({
            params:{
                V_TYPE : 'ADD_S'
            }
        });
        window.show();
    },

    PLGridDelBtnClick: function(button, e, eOpts) {
        var store = this.getStore('PLStore');
        var record = Ext.getCmp('PLGrid').getSelectionModel().getSelection();


        Ext.MessageBox.confirm('확인', '삭제 하시겠습니까?', function(btn) {
        	if (btn == 'yes') {
                Ext.Ajax.request({
                    url : 'sql/Y_APPROV_DISTR_PL.jsp',
                    method : 'post',
                    params : {
                        V_COMP_ID : 'HSN',
                        V_TYPE : 'D',
                        V_APPROV_NO : Ext.getCmp('V_PL_APPROV_NO').getValue(),
                        V_SEQ : record[0].data['SEQ'],
                        V_BAS_DT : record[0].data['BAS_DT'],
                        V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue()

                    },
                    callback : function(batch) {
                        store.reload();
                    },
                    scope : this
                });
            }
        });



    },

    PLAddCfmBtnClick: function(button, e, eOpts) {
        var record = Ext.getCmp('PLAddGrid').getSelectionModel().getSelection();

        var store = this.getStore('PLStore');

        var EMP_NO_ARR = new Array;
        var NAME_ARR = new Array;

        if(record.length >= 1){
            for(var i = 0 ; i < record.length ; i ++){
                if(store.find('EMP_NO',record[i].data['EMP_NO']) == -1){
                    store.add({
                        'V_TYPE': 'I'
                        ,'EMP_NO':record[i].data['EMP_NO']
                        ,'NAME':record[i].data['NAME']
                        ,'BAS_DT':new Date()
                        ,'RATE': 0
                    });
                }
                else{
                    EMP_NO_ARR.push(record[i].data['EMP_NO']);
                    NAME_ARR.push(record[i].data['NAME']);
                }

            }
            if(EMP_NO_ARR.length >= 1){
                Ext.Msg.alert('확인','이미 등록된 사람이 있습니다(' + NAME_ARR + ')');
            }
            Ext.getCmp('PLAddWindow').destroy();
        }
        else{
            Ext.Msg.alert('확인', '선택된 데이터가 없습니다.');
        }

    },

    PLSaveBtnClick: function(button, e, eOpts) {
        var store = this.getStore('PLStore');
        Ext.MessageBox.confirm('확인', '저장 하시겠습니까?', function(btn) {
        	if (btn == 'yes') {
                store.sync({
                   params:{
                       V_COMP_ID: 'HSN',
                       V_TYPE : 'SYNC',
                       V_APPROV_NO : Ext.getCmp('V_PL_APPROV_NO').getValue(),
                       V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue()
                   },
                   callback : function(batch) {
                       store.reload();
                   },
                });
        	}
        });

    }

});
