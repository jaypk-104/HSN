/*
 * File: app/controller/RPoRegController.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('M_COL_DISTB.controller.ColPopController', {
    extend: 'Ext.app.Controller',
	stores : [ 'MyStore', 'MyStore2', 'MyStore3', 'ColStore'],
	control : {
		"#w_colSelBtn" : {
			click : 'w_colSelBtnClick'
		},
		'#w_colRegBtn' : {
			click : 'w_colRegBtnClick'
		},
		'#colGrid': {
			celldblclick: 'w_colGridDblClick'
		},
		"textfield[name=col_search]": {
            specialkey: 'tfEnter'
        }
	},
	
	w_colSelBtnClick: function() {
		var popStore = this.getColStoreStore();
		popStore.load({
    		params: {
    			V_TYPE: 'P',
    			V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
				V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
				V_BS_DT_FR : Ext.getCmp('V_BS_DT_FR').getValue(),
				V_BS_DT_TO : Ext.getCmp('V_BS_DT_TO').getValue(),
				V_S_BP_NM : Ext.getCmp('W_S_BP_NM2').getValue(),
				V_PO_NO: Ext.getCmp('W_PO_NO2').getValue(),
				V_MAST_DB_NO: Ext.getCmp('W_MAST_DB_NO').getValue(),
    		},
    		callback: function(records,operations,success){
    			
    		}
    	});
	
	},
	w_colRegBtnClick: function() {
		var w_gridRecord = Ext.getCmp('ColGrid').getSelectionModel().getSelection();
		
		if(w_gridRecord.length == 1) {
//			Ext.getCmp('V_PO_NO').setValue(w_gridRecord[0].data['PO_NO']);
//			Ext.getCmp('V_M_BP_NM').setValue(w_gridRecord[0].data['M_BP_NM']);
//			Ext.getCmp('V_M_BP_CD').setValue(w_gridRecord[0].data['M_BP_CD']);
//			Ext.getCmp('V_S_BP_NM').setValue(w_gridRecord[0].data['S_BP_NM']);
//			Ext.getCmp('V_S_BP_CD').setValue(w_gridRecord[0].data['S_BP_CD']);
//			Ext.getCmp('V_APPROV_NO').setValue(w_gridRecord[0].data['APPROV_NO']);
		} else {
//			Ext.Msg.alert('발주를 선택하세요.');
		}
		
		var popWin=  Ext.getCmp('WinColPop');
		popWin.destroy();
	},
	w_colGridDblClick : function(tableview, td, cellIndex, record, tr, rowIndex, e, eOpts) {
		Ext.getCmp('V_MAST_DB_NO').setValue(record.get('MAST_DB_NO'));
		Ext.getCmp('V_COL_TYPE').setValue(record.get('COL_TYPE'));
		Ext.getCmp('V_PO_NO').setValue(record.get('PO_NO'));
		Ext.getCmp('V_COL_DT').setValue(record.get('COL_DT'));
		Ext.getCmp('V_APPROV_NO').setValue(record.get('APPROV_NO'));
		Ext.getCmp('V_COL_MGM_NO').setValue(record.get('COL_MGM_NO'));
		Ext.getCmp('V_REF_COL_NO').setValue(record.get('REF_COL_NO'));
		Ext.getCmp('V_COL_TITLE').setValue(record.get('COL_TITLE'));
		Ext.getCmp('V_M_BP_NM').setValue(record.get('M_BP_NM'));
		Ext.getCmp('V_M_BP_CD').setValue(record.get('M_BP_CD'));
		Ext.getCmp('V_S_BP_NM').setValue(record.get('S_BP_NM'));
		Ext.getCmp('V_S_BP_CD').setValue(record.get('S_BP_CD'));
		Ext.getCmp('V_COL_TOT_AMT').setValue(record.get('COL_TOT_AMT'));
		Ext.getCmp('V_COL_AVL_AMT').setValue(record.get('COL_AVL_AMT'));
		Ext.getCmp('V_CLS_AR_NO').setValue(record.get('CLS_AR_NO'));

		Ext.getCmp('V_ERP_DB_YN').setValue(record.get('ERP_CREATE_YN'));
		Ext.getCmp('V_DB_TYPE_CHK').setValue(record.get('COL_TYPE'));/*담보유형 추가 GR20200130*/
		Ext.getCmp('V_TEMP_GL_NO').setValue(record.get('TEMP_GL_NO'));
		
		if(record.get('TEMP_GL_NO') == undefined || record.get('TEMP_GL_NO') == '') {
			
			if(record.get('ERP_CREATE_YN') == 'Y') {
				/*전표*/
				Ext.getCmp('tempGlCfmBtn2').setDisabled(false);
				Ext.getCmp('tempGlCancelBtn2').setDisabled(true);
				
				/*담보*/
				Ext.getCmp('tempGlCfmBtn').setDisabled(true);
				Ext.getCmp('tempGlCancelBtn').setDisabled(false);
				
				Ext.getCmp('saveBtn').setDisabled(true);
				Ext.getCmp('delBtn').setDisabled(true);
				Ext.getCmp('gridAddBtn').setDisabled(true);
				Ext.getCmp('gridDelBtn').setDisabled(true);
			} else {

				Ext.getCmp('tempGlCfmBtn2').setDisabled(true);
				Ext.getCmp('tempGlCancelBtn2').setDisabled(true);
				
				Ext.getCmp('tempGlCfmBtn').setDisabled(false);
				Ext.getCmp('tempGlCancelBtn').setDisabled(true);
				Ext.getCmp('saveBtn').setDisabled(false);
				Ext.getCmp('delBtn').setDisabled(false);
				Ext.getCmp('gridAddBtn').setDisabled(false);
				Ext.getCmp('gridDelBtn').setDisabled(false);
			}
		} else {
			Ext.getCmp('tempGlCfmBtn2').setDisabled(true);
			Ext.getCmp('tempGlCancelBtn2').setDisabled(false);
						
			Ext.getCmp('tempGlCfmBtn').setDisabled(true);
			Ext.getCmp('tempGlCancelBtn').setDisabled(true);
			Ext.getCmp('saveBtn').setDisabled(true);
			Ext.getCmp('delBtn').setDisabled(true);
			Ext.getCmp('gridAddBtn').setDisabled(true);
			Ext.getCmp('gridDelBtn').setDisabled(true);
		}
		
		
		Ext.getCmp('BO_JAN_AMT').setValue('');
		Ext.getCmp('BU_JAN_AMT').setValue('');
		Ext.getCmp('LOAD_YN').setValue('N');
		
    	var store = this.getMyStoreStore();
		store.load({
			params: {
				V_TYPE: 'SD',
				V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
				V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
				V_MAST_DB_NO : Ext.getCmp('V_MAST_DB_NO').getValue(),
			},
			callback: function(records){
				
			}
		});
		
		var store2 = this.getMyStore2Store();
		store2.load({
			params: {
				V_TYPE: 'SD2',
				V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
				V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
				V_MAST_DB_NO : Ext.getCmp('V_MAST_DB_NO').getValue(),
				V_PO_NO : Ext.getCmp('V_PO_NO').getValue(),
			},
			callback: function(records){
				
			}
		});
		
		var store3 = this.getMyStore3Store();
		store3.load({
			params: {
				V_TYPE: 'COL_S',
				V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
				V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
				V_CLS_AR_NO : Ext.getCmp('V_CLS_AR_NO').getValue(),
				V_MAST_DB_NO : Ext.getCmp('V_MAST_DB_NO').getValue(),
			},
			callback: function(records){
				
			}
		});
//
//		
		var popWin=  Ext.getCmp('WinCollPop');
		popWin.destroy();
	},
	
	tfEnter: function(field, e, eOpts) {
    	if (e.getKey() == e.ENTER) {
    		this.w_colSelBtnClick();
    	}
}

});
