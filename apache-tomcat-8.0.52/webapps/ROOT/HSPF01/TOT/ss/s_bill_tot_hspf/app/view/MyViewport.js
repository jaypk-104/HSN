/*
 * File: app/view/MyViewport.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('S_BILL_TOT_HSPF.view.MyViewport', {
    extend: 'Ext.container.Viewport',
    alias: 'widget.myviewport',

    requires: [
        'S_BILL_TOT_HSPF.view.MyViewportViewModel',
        'S_BILL_TOT_HSPF.view.MyViewportViewController',
        'S_BILL_TOT_HSPF.view.TbButton',
        'S_BILL_TOT_HSPF.view.MyForm',
        'S_BILL_TOT_HSPF.view.MyGrid',
        'S_BILL_TOT_HSPF.view.MyGrid1',
        'Ext.form.Panel',
        'Ext.grid.Panel',
        'Ext.resizer.Splitter',
        'Ext.form.FieldSet',
        'Ext.form.field.Date',
        'Ext.form.RadioGroup',
        'Ext.form.field.Radio'
    ],

    controller: 'myviewport',
    viewModel: {
        type: 'myviewport'
    },
    height: 250,
    style: 'background-color: white',
    width: 400,

    layout: {
        type: 'vbox',
        align: 'stretch'
    },
    items: [
        {
            xtype: 'toolbarBtn'
        },
        {
            xtype: 'container',
            flex: 1,
            padding: '0 10 0 10',
            layout: {
                type: 'vbox',
                align: 'stretch',
                pack: 'center'
            },
            items: [
                {
                    xtype: 'container',
                    flex: 0.5,
                    layout: {
                        type: 'vbox',
                        align: 'stretch'
                    },
                    items: [
                        {
                            xtype: 'myform',
                            bodyPadding: 0
                        },
                        {
                            xtype: 'myGrid',
                            flex: 1
                        }
                    ]
                },
                {
                    xtype: 'splitter',
                    collapseTarget: 'prev'
                },
                {
                    xtype: 'container',
                    flex: 0.5,
                    layout: {
                        type: 'vbox',
                        align: 'stretch'
                    },
                    items: [
                        {
                            xtype: 'fieldset',
                            cls: 'gridfieldset',
                            collapsible: true,
                            flex: 1,
                            height: 170,
                            maxHeight: 170,
                            minHeight: 170,
                            layout: {
                                type: 'vbox',
                                align: 'stretch',
                                pack: 'center'
                            },
                            items: [
                                {
                                    xtype: 'fieldcontainer',
                                    flex: 1,
                                    height: 35,
                                    margin: '0 0 3 0',
                                    maxHeight: 35,
                                    minHeight: 35,
                                    width: 400,
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'V_BILL_NO',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '매출채권번호',
                                            name: 'search_field',
                                            emptyText: '(Double Click)',
                                            listeners: {
                                                afterrender: function(c) {
                                                	c.getEl().on('dblclick', function() {
                                                		var popup = Ext.create("S_BILL_TOT_HSPF.view.MyWindow1");
                                            			popup.setSize(Ext.getBody().getViewSize());
                                                        
                                                        popup.center();
                                                        popup.show();

                                                        var popStore = Ext.getStore('PopStore');
                                                        popStore.removeAll();                                        
                                                        
                                                    });
                                                }
                                            },
                                        },
                                        {
                                            xtype: 'datefield',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '매출일자',
                                            format: 'Y-m-d',
                                            listeners: {
                                                render: {
                                                    fn: 'onDatefieldRender1',
                                                    single: false
                                                },
                                                change : function () {
                                                	if(Ext.getCmp('V_BILL_DT').getValue() instanceof Date){
	                                                	var billDt = Ext.getCmp('V_BILL_DT').getValue();
	                                                	var dnIssueDt = new Date();
//	                                                	dnIssueDt.setDate(billDt.getDate() + Number(Ext.getCmp('V_PAY_DUR').getValue()));
	                                                	dnIssueDt = Ext.Date.add(billDt, Ext.Date.DAY, Number(Ext.getCmp('V_PAY_DUR').getValue()));
	                                					Ext.getCmp('V_DN_ISSUE_DT').setValue(dnIssueDt);
                                                	}
                                                }
                                            },
                                            id: 'V_BILL_DT'
                                        },
                                        {
                                            xtype: 'combobox',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '매출채권형태',
                                            id: 'V_SALE_TYPE',
                                            blankText: '',
                                            displayField: 'DTL_NM',
                                            valueField: 'DTL_CD',
                                            editable: false,
                                            margin: '0 0 0 30',
                                            value: 'DSO',
                                            store: Ext.create('Ext.data.Store',{
                                          		autoLoad: true ,
                                          		storeId: 'storeSC02',
                                          		proxy: {
                                                      type: 'ajax',
                                                      extraParams: {
                                                       	V_MAST_CD: 'SC02',
                                                       	V_GRID: 'Y'
                                                      },	
                                                      api: {
                                                          read: '/HSPF01/common/sql/Combobox.jsp'
                                                      },
                                                      reader: {
                                                          type: 'json',
                                                          rootProperty: 'resultList'
                                                      }
                                                  }
                                          	}),
                                          	listConfig: {
                                                itemTpl: [
                                                          '<div>{DTL_NM} ({DTL_CD}) </div>'
                                                          ],
                                                  }
                                        
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'V_S_BP_NM2',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '매출처',
                                            labelWidth: 60,
                                            emptyText: '(Double Click)',
                                            listeners: {
                                                afterrender: function(c) {
                                                	c.getEl().on('dblclick', function() {
                                            			var popup = Ext.create("Popup.view.WinSBpPop");
                                            			popup.show();
                                            			
                                            			Ext.getCmp('fieldType').setValue('S_BILL_TOT_HSPF2');
                                            			var store = Ext.getStore('WinSBpPopStore');
                                            			store.removeAll();
                                                    });
                                                }
                                            }
                                        },
                                        {
                                        	xtype: 'textfield',
                                        	id: 'V_S_BP_CD2',
                                        	margin: '0 0 0 30',
                                        	fieldLabel: '매출처',
                                        	hidden: true
                                        },
                                        {
                                            xtype: 'numberfield',
                                            flex: 1,
                                            margin: '0 0 0 30',
                            	        	maxWidth: 170,
                            	        	minWidth: 170,
                            	        	width: 170,
                                            fieldLabel: '환율',
                                            labelWidth: 60,
                                            id: 'V_XCH_RATE',
                                            value: 1,
                                            decimalPrecision : 4,
                                            listeners: {
                                            	change: function(field, newValue, oldValue, eOpts) {
                                            		var store1 = Ext.getStore('MyStore1');
                                            		var XCH_RATE2 = Math.floor(newValue*10000)/10000;
                                            		var LOC_AMT2 = 0;
                                            		
                                            		store1.each(function(record, idx) {
//                                            			var PRICE2 = Math.floor(record.get('IV_PRC')*10000)/10000;
//                                            			var QTY2 = Math.floor(record.get('IV_QTY')*100)/100;
                                            			var BILL_AMT = record.get('BILL_AMT');
                                            			record.set('BILL_LOC_AMT', Math.round(BILL_AMT * XCH_RATE2));
                                            			
                                            			if(!!record.get('VAT_TYPE') && record.get('VAT_RATE') > 0){
                                            				record.set('VAT_AMT', Math.floor(record.get('BILL_LOC_AMT') * record.get('VAT_RATE') / 100))
                                            			}
                                            			
                                            			LOC_AMT2 += (BILL_AMT * XCH_RATE2);
                                            		});
                                            		
                                            		Ext.getCmp('V_EXPECT_LOC_AMT').setValue(Ext.util.Format.number(LOC_AMT2, '0,000'));
                                            	}
                                            }
                                        },
                                        {
                                            xtype: 'combobox',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '코스트센터',
                                            id: 'V_COST_CD',
                                            blankText: '',
                                            displayField: 'DTL_NM',
                                            valueField: 'DTL_CD',
                                            editable: false,
                                            margin: '0 0 0 30',
                                            value: '',
                                            store: Ext.create('Ext.data.Store',{
                                          		autoLoad: true ,
                                          		storeId: 'storeSC09',
                                          		proxy: {
                                                      type: 'ajax',
                                                      extraParams: {
                                                       	V_MAST_CD: 'SC09',
                                                       	V_GRID: 'Y'
                                                      },	
                                                      api: {
                                                          read: '/HSPF01/common/sql/Combobox.jsp'
                                                      },
                                                      reader: {
                                                          type: 'json',
                                                          rootProperty: 'resultList'
                                                      }
                                                  }
                                          	}),
                                          	listConfig: {
                                                itemTpl: [
                                                          '<div>{DTL_NM} ({DTL_CD}) </div>'
                                                ],
                                            },
                                            listeners: {
                                            	change: function(field, newValue, oldValue, eOpts) {
                                            		if(!newValue || oldValue === newValue) return;
                                            		
                                            		var store1 = Ext.getStore('MyStore1');
                                            		store1.each(function(record, idx) {
                                            			record.set('COST_CD', newValue);
                                            		})
                                            	}
                                            }
                                        
                                        },
                                    ]
                                },
                                {
                                    xtype: 'fieldcontainer',
                                    flex: 1,
                                    height: 35,
                                    margin: '0 0 3 0',
                                    maxHeight: 35,
                                    minHeight: 35,
                                    width: 400,
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'V_R_BP_NM',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '수금처',
                                            
                                            emptyText: '(Double Click)',
                                            listeners: {
                                                afterrender: function(c) {
                                                	c.getEl().on('dblclick', function() {
                                            			var popup = Ext.create("Popup.view.WinBpPop");
                                            			popup.show();
                                            			
                                            			Ext.getCmp('fieldType').setValue('S_BILL_DISTR');
                                            			var store = Ext.getStore('WinBpPopStore');
                                            			store.removeAll();
                                                    });
                                                }
                                            }
                                        },
                                        {
                            	        	xtype: 'combobox',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                            	        	fieldLabel: '수금그룹',
                                            margin: '0 0 0 30',
                            	        	blankText: '',
                            	        	id: 'V_TO_SALES_GRP',
                            	        	displayField: 'DTL_NM',
                            	        	valueField: 'DTL_CD',
                            	        	editable: false,
                            	        	store: Ext.create('Ext.data.Store',{
                            	        		autoLoad: true,
                            	        		storeId: 'storeSC07',
                            	        		proxy: {
                            	        			type: 'ajax',
                            	        			extraParams: {
                            	        				V_MAST_CD: 'SC07',
                            	        				V_GRID: 'Y'
                            	        			},	
                            	        			api: {
                            	        				read: '/HSPF01/common/sql/Combobox.jsp'
                            	        			},
                            	        			reader: {
                            	        				type: 'json',
                            	        				rootProperty: 'resultList'
                            	        			}
                            	        		}
                            	        	}),
                                        },
                                        {
                                        	xtype: 'textfield',
                                        	id: 'V_R_BP_CD',
                                        	hidden: true
                                        },
                                        {
                                            xtype: 'datefield',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '수금만기일',
                                            format: 'Y-m-d',
                                            id: 'V_DN_ISSUE_DT',
                                            listeners: {
                                                render: {
                                                    fn: 'onDatefieldRender1',
                                                    single: false
                                                },
                                            },
                                        },
                                        {
                                        	xtype: 'textfield',
                                        	id: 'V_PAY_DUR',
                                        	fieldLabel: 'V_PAY_DUR',
                                        	hidden: true
                                        },
                                        {
                                            xtype: 'combobox',
                                            maxWidth: 330,
                                            minWidth: 330,
                                            width: 330,
                                            labelWidth: 150,
                                            fieldLabel: '세금계산서신고사업장',
                                            margin: '0 0 0 30',
                                            id: 'V_TAX_CD',
                                            blankText: '',
                                            displayField: 'DTL_NM',
                                            valueField: 'DTL_CD',
                                            editable: false,
                                            value: 'TX1',
                                            store: Ext.create('Ext.data.Store',{
                                          		autoLoad: true,
                                          		storeId: 'storeMA16',
                                          		proxy: {
                                                      type: 'ajax',
                                                      extraParams: {
                                                       	V_MAST_CD: 'MA16',
                                                       	V_GRID: 'Y'
                                                      },	
                                                      api: {
                                                          read: '/HSPF01/common/sql/Combobox.jsp'
                                                      },
                                                      reader: {
                                                          type: 'json',
                                                          rootProperty: 'resultList'
                                                      }
                                                  }
                                          	}),
                                          	listConfig: {
                                                itemTpl: [
                                                          '<div>{DTL_NM} ({DTL_CD}) </div>'
                                                          ],
                                                  }
                                        },
                                        {
                            	        	xtype: 'combobox',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                            	        	fieldLabel: '화폐단위',
                                            margin: '0 0 0 30',
                            	        	blankText: '',
                            	        	id: 'V_CUR',
                            	        	value: 'KRW',
                            	        	displayField: 'DTL_NM',
                            	        	valueField: 'DTL_CD',
                            	        	editable: false,
                            	        	store: Ext.create('Ext.data.Store',{
                            	        		autoLoad: true,
                            	        		storeId: 'store1',
                            	        		proxy: {
                            	        			type: 'ajax',
                            	        			extraParams: {
                            	        				V_MAST_CD: 'BA04',
                            	        				V_GRID: 'Y'
                            	        			},	
                            	        			api: {
                            	        				read: '/HSPF01/common/sql/Combobox.jsp'
                            	        			},
                            	        			reader: {
                            	        				type: 'json',
                            	        				rootProperty: 'resultList'
                            	        			}
                            	        		}
                            	        	}),
                                        },
                                    ]
                                },
                                {
                                    xtype: 'fieldcontainer',
                                    flex: 1,
                                    height: 35,
                                    margin: '0 0 3 0',
                                    maxHeight: 35,
                                    minHeight: 35,
                                    width: 400,
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch'
                                    },
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            maxWidth: 350,
                                            minWidth: 350,
                                            width: 350,
                                            fieldLabel: '결제방법',
                                            id: 'V_PAY_METH',
                                            blankText: '',
                                            displayField: 'DTL_NM',
                                            valueField: 'DTL_CD',
                                            editable: false,
                                            value: 'CH',
                                            store: Ext.create('Ext.data.Store',{
                                          		autoLoad: true,
                                          		storeId: 'store1',
                                          		proxy: {
                                                      type: 'ajax',
                                                      extraParams: {
                                                       	V_MAST_CD: 'MA03',
                                                       	V_GRID: 'Y'
                                                      },	
                                                      api: {
                                                          read: '/HSPF01/common/sql/Combobox.jsp'
                                                      },
                                                      reader: {
                                                          type: 'json',
                                                          rootProperty: 'resultList'
                                                      }
                                                  }
                                          	}),
                                          	listConfig: {
                                                itemTpl: [
                                                          '<div>{DTL_NM} ({DTL_CD}) </div>'
                                                          ],
                                                  }
                                        
                                        },
                                        {
                            	        	xtype: 'combobox',
                                            maxWidth: 350,
                                            minWidth: 350,
                                            width: 350,
                                            margin: '0 0 0 30',
                            	        	fieldLabel: '가격조건',
                            	        	id: 'V_IN_TERMS',
                                            margin: '0 0 0 30',
                            	        	labelWidth: 120,
                            	        	blankText: '',
                            	        	displayField: 'DTL_NM',
                            	        	valueField: 'DTL_CD',
                            	        	editable: false,
                            	        	store: Ext.create('Ext.data.Store',{
                            	        		autoLoad: true,
                            	        		storeId: 'store1',
                            	        		proxy: {
                            	        			type: 'ajax',
                            	        			extraParams: {
                            	        				V_MAST_CD: 'MA04',
                            	        				V_GRID: 'Y'
                            	        			},	
                            	        			api: {
                            	        				read: '/HSPF01/common/sql/Combobox.jsp'
                            	        			},
                            	        			reader: {
                            	        				type: 'json',
                            	        				rootProperty: 'resultList'
                            	        			}
                            	        		}
                            	        	}),
                            	        	hidden: true,
                            	        	listConfig: {
                                                itemTpl: [
                                                          '<div>{DTL_NM} ({DTL_CD}) </div>'
                                                          ],
                                            }
                            	        },
                            	        {
                                    		xtype: 'combobox',
                                            fieldLabel: '부가세유형',
                                            margin: '0 0 0 30',
                                            maxWidth: 320,
                                            minWidth: 320,
                                            width: 320,
                                            labelAlign: 'left',
                                    		displayField: 'DTL_NM',
                                    		autoLoadOnValue: true,
                                    		valueField: 'DTL_CD',
                                    		editable: false,
                                    		id: 'V_VAT_TYPE',
                                    		store: Ext.create('Ext.data.Store',{
                                    			autoLoad: true,
                                    			storeId: 'storeVAT',
                                    			proxy: {
                                    		           type: 'ajax',
                                    		           extraParams: {
                                    		            	V_MAST_CD: 'VAT_RATE',
                                    		           },	
                                    		           api: {
                                    		               read: '/HSPF01/common/sql/Combobox.jsp'
                                    		           },
                                    		           reader: {
                                    		               type: 'json',
                                    		               rootProperty: 'resultList'
                                    		           }
                                    		       }
                                    		}),
                                    		listeners: {
                                            	change: function(field, newValue, oldValue, eOpts) {
                                            		if(!newValue) return;
                                            		
                                            		if(newValue === 'A'){
                                            			Ext.getCmp('rb1Y').setValue(true);
                                            		} else if(newValue === 'C'){
                                            			Ext.getCmp('rb1N').setValue(true);
                                            		}
                                            		
                                            		var store1 = Ext.getStore('MyStore1');
                                            		var storeVAT = Ext.getStore('storeVAT');
                                            		var match = storeVAT.findBy(function(record,id) {
                                            	        if(record.get('DTL_CD') == newValue) {
                                            	            return true;
                                            	        }
                                            	    });
                                            		
                                            		var vatRecord = storeVAT.getData().getAt(match);
                                            		var DTL_NM = vatRecord.get('DTL_NM');
                                            		var VAT_RATE = vatRecord.get('VAT_RATE');
                                            		
                                            		store1.each(function(record, idx) {
                                            			var BILL_AMT = record.get('BILL_LOC_AMT');
                                            			var VAT_AMT = 0;
                                            			if(BILL_AMT > 0 && VAT_RATE > 0){
                                            				VAT_AMT = Math.floor(BILL_AMT * VAT_RATE / 100); 
                                            			}
                                            			
                                            			record.set('VAT_TYPE', newValue);
                                            			record.set('VAT_TYPE_NM', DTL_NM);
                                            			record.set('VAT_RATE', VAT_RATE);
                                            			record.set('VAT_AMT', VAT_AMT);
                                            		})
                                            	}
                                            }
                                        },
                                        {
                                            xtype: 'radiogroup',
                                            flex: 1,
                                            margin: '0 0 0 30',
                                            maxWidth: 200,
                                            minWidth: 200,
                                            width: 200,
                                            fieldLabel: '부가세포함여부',
                                            id: 'V_VAT_INC',
                                            items: [
                                                {
                                                    xtype: 'radiofield',
                                                    boxLabel: 'Y',
                                                    name: 'rb1',
                                                    id: 'rb1Y',
                                                    inputValue: 'Y',
                                                },
                                                {
                                                    xtype: 'radiofield',
                                                    boxLabel: 'N',
                                                    name: 'rb1',
                                                    id: 'rb1N',
                                                    checked: true,
                                                    inputValue : 'N',
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'radiogroup',
                                            flex: 1,
                                            margin: '0 0 0 30',
                                            maxWidth: 170,
                                            minWidth: 170,
                                            width: 170,
                                            fieldLabel: '확정여부',
                                            labelWidth: 70,
                                            id: 'V_CFM_YN',
                                            items: [
                                                {
                                                    xtype: 'radiofield',
                                                    boxLabel: 'Y',
                                                    name: 'rb2',
                                                    id: 'rb2Y',
                                                    inputValue: 'Y',
                                                },
                                                {
                                                    xtype: 'radiofield',
                                                    boxLabel: 'N',
                                                    name: 'rb2',
                                                    id: 'rb2N',
                                                    checked: true,
                                                    inputValue : 'N',
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'V_REMARK',
                                            margin: '0 0 0 30',
                                            maxWidth: 290,
                                            minWidth: 290,
                                            width: 290,
                                            labelWidth: 70,
                                            fieldLabel: '비고',
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            id: 'V_TAX_BILL_YN',
                                        },
                                        {
                                        	xtype: 'hiddenfield',
                                        	id: 'V_TAX_BILL_SEND_YN',
                                        },
                                        {
                                        	xtype: 'hiddenfield',
                                        	id: 'V_CR_TYPE',
                                        },
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'mygrid1',
                            flex: 1
                        }
                    ]
                }
            ]
        }
    ]

});