/*
 * File: app/controller/MyGridController1.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('M_OFFER_CFM.controller.MyGridController1', {
    extend: 'Ext.app.Controller',
    stores: ['MyStore', 'MyStore1','Popup.store.WinBpPopStore'],
    control: {
        "#w_selBtn": {
        	click: 'w_selBtnClick'
        },
		"#popGrid" : {
			celldblclick : 'cellDblClick'
		},
        "#gridSaveBtn": {
        	click: 'gridSaveBtnClick'
        },
        "#gridCfmBtn": {
        	click: 'gridCfmBtnClick'
        },
        "#xlsxDown1" : {
			click : 'xlsxDown1Click'
		},
    },

    gridSaveBtnClick: function(button, e, eOpts) {
    	var store = Ext.getStore('MyStore');
    	var store1 = Ext.getStore('MyStore1');
    	var gridRecord = Ext.getCmp('myGrid1').getSelectionModel().getSelection();
    	
    	store1.each(function(rec,idx) {
			rec.set('V_TYPE','I');
    	});
    		
    	store1.sync({
			params: {
				V_TYPE : 'SYNC',
				V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
				V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
				V_MAST_PO_NO: Ext.getCmp('V_MAST_PO_NO').getValue(),
			},
			callback: function(records, operation, success) {
				store.reload();
				store1.reload();
			}
		});
    },
    
    gridCfmBtnClick: function(button, e, eOpts) {
    	var store = Ext.getStore('MyStore');
    	var store1 = Ext.getStore('MyStore1');
    	
    	Ext.Ajax.request({
			url:'sql/M_OFFER_CFM.jsp',
			method: 'post',
			params: {
    			V_COMP_ID: parent.Ext.getCmp('GCOMP_ID').getValue(),
    			V_USR_ID: parent.Ext.getCmp('GUSER_ID').getValue(),
				V_TYPE: "CF", //저장,
				V_MAST_PO_NO: store1.getAt(0).data.MAST_PO_NO
			},
			callback : function(records,operations,success){
		    },
		    success : function(response) {
		    	store.reload();
		    	store1.reload();
		    	
		    	var OF_CFM_YN = response.responseText;
		    	if(OF_CFM_YN == 'Y' && "/ADMIN/HDH_HSPF/LHR4558/JASONPARK/JWLEE/SMDSM1".indexOf(parent.Ext.getCmp('GUSER_ID').getValue()) < 0) {
		    		Ext.getCmp('gridSaveBtn').setDisabled(true);
		    	} else {
		    		Ext.getCmp('gridSaveBtn').setDisabled(false);
		    	}
		    }
		});
    },
    
    xlsxDown1Click: function(button, e, eOpts) {
        var currentDate = Ext.util.Format.date(new Date(), 'Y-m-d His');
        var grid = Ext.getCmp('myGrid1');
        grid.saveDocumentAs({
            type: 'xlsx',
            title: '수입발주관리', //엑셀내타이틀
            fileName: currentDate+'.xlsx' //엑셀파일이름
        });
    },
});
