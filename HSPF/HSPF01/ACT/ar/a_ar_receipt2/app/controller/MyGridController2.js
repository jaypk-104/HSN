/*
 * File: app/controller/MyGridController.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('A_AR_RECEIPT2.controller.MyGridController2', {
	extend : 'Ext.app.Controller',
	stores : [ 'MyStore2', 'MyStore3' ],
	control : {
		"#gridAddBtn2" : {
			click : 'gridAddBtn2Click'
		},
		"#gridDelBtn2" : {
			click : 'gridDelBtn2Click'
		},
		"#gridSaveBtn2" : {
			click : 'gridSaveBtn2Click'
		},
		"#myGrid2" : {
			cellclick : 'myGrid2Click'
		},
		"#xlsxDown2" : {
			click : 'xlsxDown2Click'
		}
	},
	
	gridAddBtn2Click : function(button, e, eOpts) {
		var popup = Ext.create("A_AR_RECEIPT2.view.WinAddRow");
		popup.show();
		Ext.getCmp('rowCount').setValue(1);
	},
	
	gridDelBtn2Click : function(button, e, eOpts) {
		var store2 = Ext.getStore('MyStore2');
		var gridRecord2 = Ext.getCmp('myGrid2').getSelectionModel().getSelection();
		var flag = 'F';
		
		for(var i=0; i<gridRecord2.length; i++) {
			if(gridRecord2[i].get('V_TYPE') == 'I') {
				store2.remove(gridRecord2[i]);
			} else {
				gridRecord2[i].set('V_TYPE', 'D');
				flag = 'T';
			}
		}
		
		if(flag == 'T') {
			Ext.Msg.confirm('확인', '삭제하시겠습니까?', function(button) {
				if (button == 'yes') {
					store2.sync({
						params : {
							V_TYPE : 'T2ID',
							V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
							V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
							V_CLS_AR_NO : Ext.getCmp('V_CLS_AR_NO').getValue(),
						},
						callback : function(records, operation, success) {
							store2.reload();
						}, 
					});
				}
			});
		}
	},
	
	gridSaveBtn2Click : function(button, e, eOpts) {
		
	},
	
	myGrid2Click : function(tableview, td, cellIndex, record, tr, rowIndex, e, eOpts) {
		var store3 = Ext.getStore('MyStore3');
		
		if (!!record.get('ACCT_CD')) {
			store3.removeAll();
			
			if(!!record.get('SEQ')){
				store3.load({
					params : {
						V_TYPE : 'T2T2S2',
						V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
						V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
						V_CLS_AR_NO : Ext.getCmp('V_CLS_AR_NO').getValue(),
						V_SEQ : record.get('SEQ'),
					},
					callback : function(records, operations, success) {
					}
				});
			} else {
				store3.load({
	        		params: {
	        			V_TYPE: 'ACCT_REF',
	        			V_COMP_ID: parent.Ext.getCmp('GCOMP_ID').getValue(),
	        			V_USR_ID: parent.Ext.getCmp('GUSER_ID').getValue(),
	        			V_ACCT_CD : record.get('ACCT_CD'),
	        		},
	        		callback: function(records,operations,success){
	        			
	        		},
	        	});
			}
			
		}
	},
	
	xlsxDown2Click: function(button, e, eOpts) {
        var currentDate = Ext.util.Format.date(new Date(), 'Y-m-d His');
    	var grid = Ext.getCmp('myGrid2');
    	grid.saveDocumentAs({
            type: 'xlsx',
            title: '추가계정등록', //엑셀내타이틀
            fileName: currentDate+'.xlsx' //엑셀파일이름
		});
    }
});
