/*
 * File: app/controller/TbButtonController.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('B_BIZ_TRADE_INFO.controller.TbButtonController', {
    extend: 'Ext.app.Controller',

    stores: ['MyStore'],
    control: {
        "#selBtn": {
            click: 'selBtnClick'
        },
        "#saveBtn": {
            click: 'saveBtnClick'
        },
        "#clrBtn": {
            click: 'clrBtnClick'
        },
        "#clsBtn": {
            click: 'clsBtnClick'
        },
        "myform textfield[name=search_field]": {
            specialkey: 'tfEnter'
        },
    },

    selBtnClick: function(button, e, eOpts) {
    	Ext.Ajax.request({
			url : 'sql/B_BIZ_TRADE_INFO.jsp',
			method : 'post',
			params : {
				V_TYPE : 'S',
				V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
				V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
				V_BP_CD : Ext.getCmp('V_BP_CD').getValue(),
			},
			success : function(response) {
				var res = Ext.JSON.decode(response.responseText).resultList[0];

				if(!!res){
					Ext.getCmp('V_BP_NM').setValue(res.BP_NM);
					Ext.getCmp('V_BP_SEQ').setValue(res.BP_SEQ);
					Ext.getCmp('V_BP_CD').setValue(res.BP_CD);
					
					Ext.getCmp('V_BUYER_ADDR').setValue(res.BUYER_ADDR);
					Ext.getCmp('V_CONSIGNEE').setValue(res.CONSIGNEE);
					Ext.getCmp('V_NOTIFY').setValue(res.NOTIFY);
					Ext.getCmp('V_SHIP_MARK').setValue(res.SHIP_MARK);
					Ext.getCmp('V_REMARK').setValue(res.REMARK);
					Ext.getCmp('V_SELLER').setValue(res.SELLER);
					Ext.getCmp('V_BANK_CD').setValue(res.BANK_CD);
					Ext.getCmp('V_BANK_ADDR').setValue(res.BANK_ADDR);
					Ext.getCmp('V_SWIFT_CODE').setValue(res.SWIFT_CODE);
					Ext.getCmp('V_ABA_NO').setValue(res.ABA_NO);
					Ext.getCmp('V_SHIPMENT').setValue(res.SHIPMENT);
					
					Ext.getCmp('V_DISCHGE_PORT').setValue(res.DISCHGE_PORT);
					Ext.getCmp('V_LOADING_PORT').setValue(res.LOADING_PORT);
				}
				
			}
		});
    },

    saveBtnClick: function(button, e, eOpts) {
    	var flag = '';
		var msg = '';
		
		if (!!!Ext.getCmp('V_BP_CD').getValue()) {
			flag = 'F';
			msg = '거래처를 선택하세요.';
		} else {
			flag = 'T';
		}
    	
		if (flag == 'T') {
	    	Ext.Ajax.request({
				url : 'sql/B_BIZ_TRADE_INFO.jsp',
				method : 'post',
				params : {
					V_TYPE : 'I',
					V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
					V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
					V_BP_CD : Ext.getCmp('V_BP_CD').getValue(),
					V_BP_SEQ : Ext.getCmp('V_BP_SEQ').getValue(),
					V_BUYER_ADDR : Ext.getCmp('V_BUYER_ADDR').getValue(),
					V_CONSIGNEE : Ext.getCmp('V_CONSIGNEE').getValue(),
					V_NOTIFY : Ext.getCmp('V_NOTIFY').getValue(),
					V_SHIP_MARK : Ext.getCmp('V_SHIP_MARK').getValue(),
					V_REMARK : Ext.getCmp('V_REMARK').getValue(),
					V_SELLER : Ext.getCmp('V_SELLER').getValue(),
					V_BANK_CD : Ext.getCmp('V_BANK_CD').getValue(),
					V_BANK_ADDR : Ext.getCmp('V_BANK_ADDR').getValue(),
					V_SWIFT_CODE : Ext.getCmp('V_SWIFT_CODE').getValue(),
					V_ABA_NO : Ext.getCmp('V_ABA_NO').getValue(),
					V_SHIPMENT : Ext.getCmp('V_SHIPMENT').getValue(),
					V_DISCHGE_PORT : Ext.getCmp('V_DISCHGE_PORT').getValue(),
					V_LOADING_PORT : Ext.getCmp('V_LOADING_PORT').getValue(),
				},
				success : function(response) {
					var tbController = B_BIZ_TRADE_INFO.app.getController("TbButtonController");
					tbController.selBtnClick();
					
					Ext.toast({
						title : ' ',
						timeout : 1000,
						html : '저장완료',
						style : 'text-align: center',
						align : 't',
						width : 130,
					});
				}
			});
		} else {
			Ext.Msg.alert('확인', msg);
		}
    },

    clrBtnClick: function(button, e, eOpts) {
    	Ext.getCmp('V_BP_CD').setValue('');
    	Ext.getCmp('V_BP_NM').setValue('');
    	Ext.getCmp('V_BP_SEQ').setValue('');
    	
    	Ext.getCmp('V_BUYER_ADDR').setValue('');
		Ext.getCmp('V_CONSIGNEE').setValue('');
		Ext.getCmp('V_NOTIFY').setValue('');
		Ext.getCmp('V_SHIP_MARK').setValue('');
		Ext.getCmp('V_REMARK').setValue('');
		Ext.getCmp('V_SELLER').setValue('');
		Ext.getCmp('V_BANK_CD').setValue('');
		Ext.getCmp('V_BANK_ADDR').setValue('');
		Ext.getCmp('V_SWIFT_CODE').setValue('');
		Ext.getCmp('V_ABA_NO').setValue('');
		Ext.getCmp('V_SHIPMENT').setValue('');
		
		Ext.getCmp('V_DISCHGE_PORT').setValue('');
		Ext.getCmp('V_LOADING_PORT').setValue('');
    },

    clsBtnClick: function(button, e, eOpts) {
		var tab = parent.Ext.getCmp('myTab');
		var activeTab = tab.getActiveTab();
		var tabIndex = tab.items.indexOf(activeTab);
		tab.remove(tabIndex, true);
	},

    tfEnter: function(field, e, eOpts) {
        if (e.getKey() == e.ENTER) {
        	this.selBtnClick();
        }
    },  
    
    onLaunch: function(application) {
    	var BPstore = Ext.getStore('WinBpPopStore');
        BPstore.load();
    },
    
});
