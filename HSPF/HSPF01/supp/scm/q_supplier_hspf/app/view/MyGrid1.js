/*
 * File: app/view/MyGrid1.js
 *
 * This file was generated by Sencha Architect version 4.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Q_SUPPLIER_HSPF.view.MyGrid1', {
    extend: 'Ext.grid.Panel',
    alias: 'widget.mygrid1',

    requires: [
        'Q_SUPPLIER_HSPF.view.MyGridViewModel1',
        'Q_SUPPLIER_HSPF.view.MyGridViewController1',
        'Ext.view.Table',
        'Ext.grid.column.RowNumberer',
        'Ext.grid.column.Number',
        'Ext.selection.CheckboxModel',
        'Ext.grid.plugin.Exporter'
    ],

    config: {
        tbar: [
            {
                id: 'gridAddBtn1',
                text: '',
                margin: '0 3 0 0',
                glyph: 'xf055@FontAwesome',
                iconCls: 'grid-add-btn',
                disabled: true
            },
            {
                id: 'gridDelBtn1',
                text: '',
                margin: '0 3 0 0',
                glyph: 'xf056@FontAwesome',
                iconCls: 'grid-del-btn',
                disabled: true
            },
            {
                xtype: 'container',
                flex: 1
            },
            {
	            id: 'gridSaveBtn1',
	            text: '',
	            margin: '0 3 0 0',
	            glyph: 'xf0c7@FontAwesome',
	            iconCls: 'grid-save-btn',
	            hidden:true
	        },
            {
                xtype: 'button',
                glyph: 'xf1c3@FontAwesome',
                id: 'xlsxDown1',
                cfg: {
                    type: 'excel07',
                    ext: 'xlsx'
                },
                iconCls: 'grid-excel-btn',
                margin: '0 3 0 0',
                
            }
        ]
    },

    controller: 'mygrid1',
    viewModel: {
        type: 'mygrid1'
    },
    id: 'myGrid1',
    style: '',
    bodyBorder: false,
    header: false,
    store: 'MyStore1',

    viewConfig: {
        enableTextSelection: true
    },
    columns: [
        {
            xtype: 'rownumberer',
            width: 40
        },
        {
            xtype: 'gridcolumn',
            hidden: true,
            text: 'V_TYPE'
        },
        {
            xtype: 'numbercolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 100,
            align: 'end',
            dataIndex: 'INSPSEQ',
            enableTextSelection: true,
            exportStyle: {
                alignment: {
                    horizontal: 'Right'
                }
            },
            text: '순서',//순서
            format: '0,000'
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 150,
            sortable: true,
            dataIndex: 'OBJ_DESC',
            enableTextSelection: true,
            text: '검사항목'//검사항목
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 150,
            sortable: true,
            dataIndex: 'OBJ_ID',
            enableTextSelection: true,
            text: '검사항목',
            hidden:true
        },
        {
            xtype: 'numbercolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 100,
            align: 'end',
            dataIndex: 'LOW_VAL',
            enableTextSelection: true,
            exportStyle: {
                alignment: {
                    horizontal: 'Right'
                }
            },
            text: '하한값',
            format: '0,000.00'
        }, //限值
        {
            xtype: 'numbercolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 100,
            align: 'end',
            dataIndex: 'MID_VAL',
            enableTextSelection: true,
            exportStyle: {
                alignment: {
                    horizontal: 'Right'
                }
            },
            text: '중심값',
            format: '0,000.00'
        },
        {
            xtype: 'numbercolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 100,
            align: 'end',
            dataIndex: 'UPP_VAL',
            enableTextSelection: true,
            exportStyle: {
                alignment: {
                    horizontal: 'Right'
                }
            },
            text: '상한값',
            format: '0,000.00'
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 200,
            sortable: true,
            dataIndex: 'INSP_STD',
            enableTextSelection: true,
            text: '검사기준'//검사기준
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 100,
            sortable: true,
            dataIndex: 'UNIT',
            enableTextSelection: true,
            text: '단위'//단위
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 150,
            sortable: true,
            dataIndex: 'QCM_MEA_NM',
            enableTextSelection: true,
            text: '측정방법'//측정방법
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 100,
            sortable: true,
            dataIndex: 'QCM_MEA',
            enableTextSelection: true,
            text: '측정방법',//측정방법
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            sortable: true,
            dataIndex: 'INSPECTOR',
            enableTextSelection: true,
            text: '검사자',//검사자
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            }
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 100,
            sortable: true,
            dataIndex: 'RESULT_YN',
            enableTextSelection: true,
            text: '검사결과',//검사결과
//            editor: {
//        		xtype: 'combobox',
//        		displayField: 'DTL_NM',
//        		autoLoadOnValue: true,
//        		valueField: 'DTL_CD',
//        		editable: false,
//        		value: 'Y',
//        		store: Ext.create('Ext.data.Store',{
//        			autoLoad: true,
//        			storeId: 'gStore1',
//        			proxy: {
//        		           type: 'ajax',
//        		           extraParams: {
//        		            	V_MAST_CD: 'QA06'
//        		           },	
//        		           api: {
//        		               read: '/HSPF01/common/sql/Combobox.jsp'
//        		           },
//        		           reader: {
//        		               type: 'json',
//        		               rootProperty: 'resultList'
//        		           }
//        		       }
//        		}),
//        	},
//        	renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
//                if(Ext.data.StoreManager.lookup('gStore1').findRecord('DTL_CD',value) !=null)
//                {
//                	record.data['RESULT_YN'] = value;
//                    return Ext.data.StoreManager.lookup('gStore1').findRecord('DTL_CD',value).get('DTL_NM');
//                }
//                return value;
//            }
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold;',
            width: 100,
            sortable: true,
            dataIndex: 'RESULT_YN',
            enableTextSelection: true,
            text: '검사결과',//검사결과
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            },
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            align: 'end',
            dataIndex: 'VALUE1',
            enableTextSelection: true,
//            exportStyle: {
//                format: 'Currency',
//                alignment: {
//                    horizontal: 'Right'
//                }
//            },
            text: '측정값1',//측정감1
//            format: '0,000',
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            }
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            align: 'end',
            dataIndex: 'VALUE2',
            enableTextSelection: true,
//            exportStyle: {
//                format: 'Currency',
//                alignment: {
//                    horizontal: 'Right'
//                }
//            },
            text: '측정값2',
//            format: '0,000'
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            }
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            align: 'end',
            dataIndex: 'VALUE3',
            enableTextSelection: true,
//            exportStyle: {
//                format: 'Currency',
//                alignment: {
//                    horizontal: 'Right'
//                }
//            },
            text: '측정값3',
//            format: '0,000'
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            }
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            align: 'end',
            dataIndex: 'VALUE4',
            enableTextSelection: true,
//            exportStyle: {
//                format: 'Currency',
//                alignment: {
//                    horizontal: 'Right'
//                }
//            },
            text: '측정값4',
//            format: '0,000'
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            },
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            align: 'end',
            dataIndex: 'VALUE5',
            enableTextSelection: true,
//            exportStyle: {
//                format: 'Currency',
//                alignment: {
//                    horizontal: 'Right'
//                }
//            },
            text: '측정값5',
//            format: '0,000'
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            },
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            align: 'end',
            dataIndex: 'VALUE6',
            enableTextSelection: true,
//            exportStyle: {
//                format: 'Currency',
//                alignment: {
//                    horizontal: 'Right'
//                }
//            },
            text: '측정값6',
//            format: '0,000'
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            },
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            align: 'end',
            dataIndex: 'VALUE7',
            enableTextSelection: true,
//            exportStyle: {
//                format: 'Currency',
//                alignment: {
//                    horizontal: 'Right'
//                }
//            },
            text: '측정값7',
//            format: '0,000'
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            },
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            align: 'end',
            dataIndex: 'VALUE8',
            enableTextSelection: true,
//            exportStyle: {
//                format: 'Currency',
//                alignment: {
//                    horizontal: 'Right'
//                }
//            },
            text: '측정값8',
//            format: '0,000'
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            },
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            align: 'end',
            dataIndex: 'VALUE9',
            enableTextSelection: true,
//            exportStyle: {
//                format: 'Currency',
//                alignment: {
//                    horizontal: 'Right'
//                }
//            },
            text: '측정값9',
//            format: '0,000'
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            },
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 100,
            align: 'end',
            dataIndex: 'VALUE10',
            enableTextSelection: true,
//            exportStyle: {
//                format: 'Currency',
//                alignment: {
//                    horizontal: 'Right'
//                }
//            },
            text: '측정값10',
//            format: '0,000'
            editor: {
                xtype: 'textfield',
                style: 'text-align:left',
            },
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 200,
            sortable: true,
            dataIndex: 'ASN_NO',
            enableTextSelection: true,
            text: 'ASN',
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 200,
            sortable: true,
            dataIndex: 'ITEM_CD',
            enableTextSelection: true,
            text: '품목',
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 200,
            sortable: true,
            dataIndex: 'LOT_NO',
            enableTextSelection: true,
            text: 'LOT NO',
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 200,
            sortable: true,
            dataIndex: 'WRITERYN',
            enableTextSelection: true,
            text: '작성자 승인유무',
            hidden:true
        },
        {
            xtype: 'gridcolumn',
            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6;',
            width: 200,
            sortable: true,
            dataIndex: 'COM_DAT',
            enableTextSelection: true,
            text: '데이터 타입',
            hidden:true
        }
    ],
    //selModel: {
    //    selType: 'checkboxmodel',
    //    checkOnly: true,
    //    listeners: {
    //        select: 'onCheckboxModelSelect',
    //        deselect: 'onCheckboxModelDeselect'
    //    }
    //},
    plugins: [
        {
            ptype: 'gridexporter'
        },
        {
        	ptype: 'cellediting',
            clicksToEdit: 1,
            listeners: {
    			beforeedit: function(editor, context, eOpts) {
    				var writeryn = context.record.data["WRITERYN"];
    				console.log('WRITERYN' + writeryn);
    				
    				if(writeryn == "Y"){
    					if(context.field == 'INSPECTOR' || context.field == 'RESULT_YN' || context.field == 'VALUE1' || context.field == 'VALUE2'
    					   || context.field == 'VALUE3' || context.field == 'VALUE4' || context.field == 'VALUE5' || context.field == 'VALUE6'
    					   || context.field == 'VALUE7' || context.field == 'VALUE8' || context.field == 'VALUE9' || context.field == 'VALUE10'){
    						context.cancel = true;
    					}
    				}
    				else{
    					if(context.field == 'INSPECTOR' || context.field == 'RESULT_YN' || context.field == 'VALUE1' || context.field == 'VALUE2'
     					   || context.field == 'VALUE3' || context.field == 'VALUE4' || context.field == 'VALUE5' || context.field == 'VALUE6'
     					   || context.field == 'VALUE7' || context.field == 'VALUE8' || context.field == 'VALUE9' || context.field == 'VALUE10'){
     						context.cancel = false;
     					}
    				}
    			},
    			edit: function(editor, context, eQpts){
    				var LOW_VAL = Number((context.record.data.LOW_VAL == "" ? "0" : context.record.data.LOW_VAL)); 
    				var MID_VAL = Number((context.record.data.MID_VAL == "" ? "0" : context.record.data.MID_VAL)); 
    				var UPP_VAL = Number((context.record.data.UPP_VAL == "" ? "0" : context.record.data.UPP_VAL)); 
    				var COM_DAT = context.record.data.COM_DAT;
    				console.log(COM_DAT);
    				
    				if(context.column.dataIndex == 'VALUE1' || context.column.dataIndex == 'VALUE2' || context.column.dataIndex == 'VALUE3') {
                        if(COM_DAT == "C"){
                        	var VALUE1 = (context.record.data.VALUE1 == null ? "" : context.record.data.VALUE1.toUpperCase());
        					var VALUE2 = (context.record.data.VALUE2 == null ? "" : context.record.data.VALUE2.toUpperCase());
        					var VALUE3 = (context.record.data.VALUE3 == null ? "" : context.record.data.VALUE3.toUpperCase());
        					
                        	if(VALUE1 == "OK" || VALUE1 == "NG" || VALUE1 == "" || VALUE2 == "OK" || VALUE2 == "NG" || VALUE2 == "" || VALUE3 == "OK" || VALUE3 == "NG" || VALUE3 == ""){
                        		
    						}
                        	else{
                        		context.record.set(context.column.dataIndex,  "");
                        	}
                        	
                        	VALUE1 = (context.record.data.VALUE1 == null ? "" : context.record.data.VALUE1.toUpperCase());
        					VALUE2 = (context.record.data.VALUE2 == null ? "" : context.record.data.VALUE2.toUpperCase());
        				    VALUE3 = (context.record.data.VALUE3 == null ? "" : context.record.data.VALUE3.toUpperCase());
                        	
                        	var Flg = "Y";
							
							if(VALUE1 == "NG"){
								Flg = "N";
							}
							
							if(VALUE2 == "NG"){
								Flg = "N";
							}
							
							if(VALUE3 == "NG"){
								Flg = "N";
							}
                    		
							context.record.set('RESULT_YN',  Flg);
							
							var LOT_QTY = Ext.getCmp('W_LOT_QTY').getValue();//.setValue(record.data['ASN_NO']);
//    						if(Flg == "Y"){
//    							Ext.getCmp('W_OK_QTY').setValue(LOT_QTY);
//    							Ext.getCmp('W_BAD_QTY').setValue(0);
//    						}
//    						else{
//    							Ext.getCmp('W_OK_QTY').setValue(0);
//    							Ext.getCmp('W_BAD_QTY').setValue(LOT_QTY);
//    						}
//							
							if(VALUE1 == "" && VALUE2 == "" && VALUE3 == ""){
    							context.record.set('RESULT_YN',  "");
    							context.record.set('RESULT_YN',  "");
    						}
    					}
    					else{
    						var VALUE1 = (context.record.data.VALUE1 == null ? "0" : context.record.data.VALUE1);
        					var VALUE2 = (context.record.data.VALUE2 == null ? "0" : context.record.data.VALUE2);
        					var VALUE3 = (context.record.data.VALUE3 == null ? "0" : context.record.data.VALUE3);
        					
    						if(isNaN(VALUE1) || isNaN(VALUE2) || isNaN(VALUE3)){
    							context.record.set(context.column.dataIndex,  "");
    						}
    						
    						VALUE1 = (context.record.data.VALUE1 == null ? "0" : context.record.data.VALUE1);
        					VALUE2 = (context.record.data.VALUE2 == null ? "0" : context.record.data.VALUE2);
        					VALUE3 = (context.record.data.VALUE3 == null ? "0" : context.record.data.VALUE3);
    						
        					var Flg = "Y";
        					
        					if((VALUE1 < LOW_VAL || VALUE1 > UPP_VAL) && VALUE1 != 0){
        						if(UPP_VAL != 0){
        							Flg = "N";
        						}
        					}
        					
        					if((VALUE2 < LOW_VAL || VALUE2 > UPP_VAL) && VALUE2 != 0){
        						if(UPP_VAL != 0){
        							Flg = "N";
        						}
        					}
        					
        					if((VALUE3 < LOW_VAL || VALUE3 > UPP_VAL) && VALUE3 != 0){
        						if(UPP_VAL != 0){
        							Flg = "N";
        						}
        					}
    						
        					context.record.set('RESULT_YN',  Flg);
        					
    						var LOT_QTY = Ext.getCmp('W_LOT_QTY').getValue();//.setValue(record.data['ASN_NO']);
//    						if(Flg == "Y"){
//    							Ext.getCmp('W_OK_QTY').setValue(LOT_QTY);
//    							Ext.getCmp('W_BAD_QTY').setValue(0);
//    						}
//    						else{
//    							Ext.getCmp('W_OK_QTY').setValue(0);
//    							Ext.getCmp('W_BAD_QTY').setValue(LOT_QTY);
//    						}
    						
    						if(VALUE1 == 0 && VALUE2 == 0 && VALUE3 == 0){
    							context.record.set('RESULT_YN',  "");
    							context.record.set('RESULT_YN',  "");
    						}
    					}
                        var store = Ext.getStore('MyStore1');
                        
                        store.each(function(rec,idx) {
                        	if(rec.get('RESULT_YN') == 'Y') {
                        		Ext.getCmp('W_OK_QTY').setValue(LOT_QTY);
                        		Ext.getCmp('W_BAD_QTY').setValue(0);
                        	} else if(rec.get('RESULT_YN') == 'N') {
                        		Ext.getCmp('W_OK_QTY').setValue(0);
                        		Ext.getCmp('W_BAD_QTY').setValue(LOT_QTY);
                        		return false;
                        	} else if((rec.get('RESULT_YN') != 'N') && (rec.get('RESULT_YN') != 'Y')){
                        		Ext.getCmp('W_OK_QTY').setValue(0);
                        		Ext.getCmp('W_BAD_QTY').setValue(0);
                        	}
                        });
                        
                     }
    			}
    		}
        }
    ]

});