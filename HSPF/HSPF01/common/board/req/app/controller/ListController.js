/*
 * File: app/controller/ListController.js
 *
 * This file was generated by Sencha Architect version 4.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('HSPF_REQ_BOARD.controller.ListController', {
    extend: 'Ext.app.Controller',

    control: {
        "#selectBtn": {
            click: 'selectBtnClick'
        },
        "#writeBtn": {
            click: 'writeBtnClick'
        },
        "#listGrid": {
            cellclick: 'onGridpanelCellClick'
        },
        "[cls=search]": {
            specialkey: 'onTextfieldSpecialkey'
        }
    },

    selectBtnClick: function(button, e, eOpts) {
        var store = this.getStore('MainStore');
        store.load({
            params:{
                V_COMP_ID : 'HSN',
                V_TYPE : 'S',
                V_TITLE : Ext.getCmp('V_TITLE').getValue(),
                V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
            }
        });

    },

    writeBtnClick: function(button, e, eOpts) {
        //필드값들 초기화
        Ext.getCmp('V_IDX_NUM').setValue();
        Ext.getCmp('V_WRITE_TITLE').setValue();
        Ext.getCmp('V_WRITE_CONTENT').setValue();
        Ext.getCmp('V_WRITE_SYS_ID').setValue();
        Ext.getCmp('V_WRITE_REQ_TYPE').setValue();
        Ext.getCmp('V_WRITE_END_REQ_DT').setValue();

        this.getStore('FileStore').removeAll();

        Ext.getCmp('list_container').hide();
        Ext.getCmp('board_container').hide();
        Ext.getCmp('write_container').show();

        Ext.getCmp('write_container').setWidth(Ext.getBody().getViewSize().width);
        Ext.getCmp('write_container').setHeight(Ext.getBody().getViewSize().height);
    },

    onGridpanelCellClick: function(tableview, td, cellIndex, record, tr, rowIndex, e, eOpts) {
        var cellDataIndex = tableview.eventPosition.column.dataIndex;
        if(cellDataIndex == 'TITLE'){
            var fileStore = this.getStore('FileStore');
            var replyStore = this.getStore('ReplyStore');
            Ext.Ajax.request({
                url:'sql/req_board_mgm.jsp',
                method: 'post',
                params: {
                    V_COMP_ID : 'HSN',
                    V_TYPE: 'DS',
                    V_IDX_NUM : record.data['IDX_NUM'],
                    V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
                },

                success : function(response) {
                    fileStore.removeAll();
                    fileStore.load({
                        params:{
                            V_TYPE : 'S',
                            V_IDX_NUM : record.data['IDX_NUM'],
                            V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
                        },
                        callback: function(){
                            if(fileStore.getCount() >= 1){
                                Ext.getCmp('boardFileGrid').show();
                            }
                            else{
                                Ext.getCmp('boardFileGrid').hide();
                            }
                        }
                    });
                    replyStore.load({
                        params:{
                            V_TYPE : 'S',
                            V_IDX_NUM : record.data['IDX_NUM'],
                            V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
                        },
                        callback: function(){
                            Ext.getCmp('replyGrid').setHeight(80 + replyStore.getCount() * 32 + 50);
                        }
                    });

                    var jsonResult = Ext.JSON.decode(response.responseText);
                    var result = jsonResult.resultList;

                    Ext.getCmp('V_IDX_NUM').setValue(record.data['IDX_NUM']);
                    Ext.getCmp('V_BOARD_CONTENT').setHtml(result[0].CONTENT);

                    Ext.getCmp('V_BOARD_TITLE').setValue(record.data['TITLE2']);
                    Ext.getCmp('V_BOARD_INSRT_DT').setValue(record.data['INSRT_DT']);

                    Ext.getCmp('V_BOARD_REQ_TYPE_NM').setValue(record.data['REQ_TYPE_NM']);
                    Ext.getCmp('V_BOARD_INSRT_USR_NM').setValue(record.data['INSRT_USR_NM']);
                    Ext.getCmp('V_BOARD_SYS_NM').setValue(record.data['SYS_NM']);
                    Ext.getCmp('V_BOARD_END_REQ_DT').setValue(record.data['END_REQ_DT']);

                    if(record.data['INSRT_USR_ID'] == parent.Ext.getCmp('GUSER_ID').getValue()){
                        Ext.getCmp('modifyBtn').show();
                        Ext.getCmp('deleteBtn').show();
                    }
                    else{
                        Ext.getCmp('modifyBtn').hide();
                        Ext.getCmp('deleteBtn').hide();
                    }


                    Ext.getCmp('signBtn').hide();
                    Ext.getCmp('finishBtn').hide();
                    if(parent.Ext.getCmp('GDEPT_CD').getValue() == '2417'){
                        if(record.data['STATUS'] == 'R'){
                            Ext.getCmp('signBtn').show();
                        }
                        else if (record.data['STATUS'] == 'I' && record.data['REC_USR_ID'] == parent.Ext.getCmp('GUSER_ID').getValue()){
                            Ext.getCmp('finishBtn').show();
                        }
                    }

                    Ext.getCmp('V_BOARD_STATUS_R').setStyle('color', '#999999');
                    Ext.getCmp('V_BOARD_STATUS_R').setStyle('font-weight', '200');
                    Ext.getCmp('V_BOARD_STATUS_R').setStyle('font-size', '13px');
                    Ext.getCmp('V_BOARD_STATUS_I').setStyle('color', '#999999');
                    Ext.getCmp('V_BOARD_STATUS_I').setStyle('font-weight', '200');
                    Ext.getCmp('V_BOARD_STATUS_I').setStyle('font-size', '13px');
                    Ext.getCmp('V_BOARD_STATUS_E').setStyle('color', '#999999');
                    Ext.getCmp('V_BOARD_STATUS_E').setStyle('font-weight', '200');
                    Ext.getCmp('V_BOARD_STATUS_E').setStyle('font-size', '13px');
                    if(record.data['STATUS'] == 'R'){
                        Ext.getCmp('V_BOARD_STATUS_R').setStyle('color', '#01387b');
                        Ext.getCmp('V_BOARD_STATUS_R').setStyle('font-weight', 'bold');
                        Ext.getCmp('V_BOARD_STATUS_R').setStyle('font-size', '17px');
                    }
                    else if(record.data['STATUS'] == 'I'){
                        Ext.getCmp('V_BOARD_STATUS_I').setStyle('color', '#01387b');
                        Ext.getCmp('V_BOARD_STATUS_I').setStyle('font-weight', 'bold');
                        Ext.getCmp('V_BOARD_STATUS_I').setStyle('font-size', '17px');
                    }
                    else if(record.data['STATUS'] == 'E'){
                        Ext.getCmp('V_BOARD_STATUS_E').setStyle('color', '#01387b');
                        Ext.getCmp('V_BOARD_STATUS_E').setStyle('font-weight', 'bold');
                        Ext.getCmp('V_BOARD_STATUS_E').setStyle('font-size', '17px');
                    }

                    Ext.getCmp('list_container').hide();
                    Ext.getCmp('board_container').show();
                    Ext.getCmp('write_container').hide();

                    Ext.getCmp('board_container').setWidth(Ext.getBody().getViewSize().width);
                    Ext.getCmp('board_container').setHeight(Ext.getBody().getViewSize().height);

                },
                scope: this
            });
        }
    },

    onTextfieldSpecialkey: function(field, e, eOpts) {
        if (e.getKey() == e.ENTER) {
            this.selectBtnClick();
        }
    }

});
