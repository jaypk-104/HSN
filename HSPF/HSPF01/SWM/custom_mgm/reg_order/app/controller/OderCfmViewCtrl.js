/*
 * File: app/controller/OderCfmViewCtrl.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('rawpurchase.controller.OderCfmViewCtrl', {
    extend: 'Ext.app.Controller',

    models: [
        'RawPurHeadSelect',
        'RawPurSave',
        'RawPurHeadSave'
    ],
    stores: [
        'RawHeadPopSelect',
        'RawDetailPopStore',
        'RawHeadPopSave'
    ],
    views: [
        'OrderCfmView'
    ],

    control: {
        "#OderCfmView": {
            beforeshow: 'onOrderView1BeforeShow'
        },
        "#svBtnOrdPop": {
            click: 'onButtonClick'
        },
        "#delBtnOrPop": {
            click: 'onButtonClick1'
        },
        "#svBtnOrdCfm": {
            click: 'CfmBtnClick'
        }
    },

    onOrderView1BeforeShow: function(component, eOpts) {

               Ext.getCmp('s_req_no_pop').setValue(Ext.getCmp('g_s_req_no').getValue());

                var store=this.getRawHeadPopSelectStore();
                var store2=this.getRawDetailPopStoreStore();
                store.load({
                    params:{

                        s_req_no:Ext.getCmp('s_req_no_pop').getValue()

                    },
                    callback : function(records,operations,success)
                    {
                        var acct_info;
                         acct_info=records[0].data;
                        var dlvyhopdt= acct_info.dlvy_hop_dt;

                        var remarks= acct_info.remark;
                        var dlvycfmdt=acct_info.dlvy_cfm_dt;
                        var cmfyn=acct_info.cmf_yn;
                        var goallocation=acct_info.goal_location;
                      //  alert(dlvyhopdt);
                        Ext.getCmp('dlvyhopdtcfmpop').setValue(dlvyhopdt);
                        Ext.getCmp('goalLocOrdPop').setValue(goallocation);
                        Ext.getCmp('remarkOrdPop').setValue(remarks);
                        store2.load({
                            params:{

                                s_req_no:Ext.getCmp('s_req_no_pop').getValue()
                            }

                        });

                    }
                });
    },

    onButtonClick: function(button, e, eOpts) {
                var store_sv=this.getRawDetailPopStoreStore();
                var store_sv2=this.getRawHeadPopSaveStore();
         var nows =new Date();
               store_sv2.load({

                   params:{

                        crud:'U',
                    s_req_no:Ext.getCmp('s_req_no_pop').getValue(),
                    bp_cd:Ext.getCmp('gBpCd').getValue(),
                    bp_usr_id:Ext.getCmp('gUserId').getValue(),
                    so_dt:nows,
                    dlvy_hop_dt:Ext.getCmp('dlvyhopdtcfmpop').getValue(),
                    remark:Ext.getCmp('remarkOrdPop').getValue(),
                    goal_location:Ext.getCmp('goalLocOrdPop').getValue()


                   },
                   callback : function(records,operations,success)
                   {
                        store_sv.sync({

                             callback : function(records,operations,success)
                                    {
                                        store_sv.reload({
                                            params:{
                                                 s_req_no:Ext.getCmp('s_req_no_pop').getValue()
                                            }
                                        });
                                    }
                        });
                       parent.Ext.getCmp(rawpurchase.app.gText).setValue('N');
                       Ext.Msg.alert("Info",'저장하였습니다.');
                   }
               });
    },

    onButtonClick1: function(button, e, eOpts) {
            var store=this.getRawDetailPopStoreStore();
             var tGrid=Ext.getCmp('popGrid1');
                var record = tGrid.getSelectionModel().getSelection();

                store.remove(record);
    },

    CfmBtnClick: function(button, e, eOpts) {
             var store_sv2=this.getRawHeadPopSaveStore();
         var store_sv=this.getRawDetailPopStoreStore();
             var nows =new Date();
                       store_sv2.load({
                           params:{
                                crud:'A',
                            s_req_no:Ext.getCmp('s_req_no_pop').getValue(),
                            bp_cd:Ext.getCmp('gBpCd').getValue(),
                            bp_usr_id:Ext.getCmp('gUserId').getValue(),
                            so_dt:nows,
                            dlvy_hop_dt:Ext.getCmp('dlvyhopdtcfmpop').getValue(),
                            remark:Ext.getCmp('remarkOrdPop').getValue(),
                            goal_location:Ext.getCmp('goalLocOrdPop').getValue()

                           },
                            callback : function(records,operations,success)
                                            {
                                                 Ext.Msg.alert("Info",'확정하였습니다.');

                                                store_sv.removeAll();
                                                   var popwin2=Ext.getCmp('OderCfmView');
                                                popwin2.destroy();
                                            }
                       });

    }

});
