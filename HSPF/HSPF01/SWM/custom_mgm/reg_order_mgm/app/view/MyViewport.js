/*
 * File: app/view/MyViewport.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Rawpurching.view.MyViewport', {
	extend: 'Ext.container.Viewport',
	alias: 'widget.myviewport',

	requires: ['Rawpurching.view.MyViewportViewModel1', 'Ext.form.Panel', 'Ext.button.Button', 'Ext.form.field.ComboBox', 'Ext.form.field.Hidden', 'Ext.form.field.Date', 'Ext.grid.Panel', 'Ext.grid.column.RowNumberer', 'Ext.grid.column.Check', 'Ext.form.field.Checkbox', 'Ext.grid.column.Date',
			'Ext.view.Table', 'Ext.grid.plugin.CellEditing'],

	viewModel: {
		type: 'myviewport'
	},
	id: 'MyViewport',
	layout: 'card',
	defaultListenerScope: true,
//	autoScroll: 'false',
//	overflowY: 'scroll',
	items: [{
		xtype: 'form',
		modal: true,
		layout: 'border',
		// bodyPadding: 10,
		bodyStyle: 'background-color: #FFFFFF !important',
		header: true,
		title: '▶주문진행관리',
		items: [{
			autoScroll: 'true',
			overflowY: 'scroll',
			xtype: 'panel',
			region: 'center',
			id: 'mainForm',
			layout: 'border',
			bodyPadding: 10,
			bodyStyle: 'background-color: #FFFFFF !important',
			title: '',
			titleAlign: 'left',
			header: false,
			items: [{
				xtype: 'container',
				region: 'north',
				height: 34,
				margin: '0 0 3 0',
				items: [{
					xtype: 'button',
					id: 'selectBtn',
					maxWidth: 100,
					minWidth: 100,
					height: 34,
					text: '조회',
					glyph: 'xf002@FontAwesome',
					margin: '0 3 0 0'
				}, {
					xtype: 'button',
					id: 'chgBtn',
					maxWidth: 100,
					minWidth: 100,
					height: 34,
					text: '주문변경',
					glyph: 'f1b8@FontAwesome',
					margin: '0 3 0 0'
				}, {
					xtype: 'button',
					id: 'cfmYBtn',
					maxWidth: 100,
					minWidth: 100,
					height: 34,
					text: '확정',
					glyph: 'f00c@FontAwesome',
					margin: '0 3 0 0'
				}, {
					xtype: 'button',
					id: 'cfmNBtn',
					maxWidth: 100,
					minWidth: 100,
					height: 34,
					text: '확정취소',
					glyph: 'f05e@FontAwesome',
				}]
			}, {
				xtype: 'container',
				region: 'north',
				modal: true,
				height: 200,
				style: 'background-color: #EDEFF5 !important',
				layout: {
					type: 'hbox',
					align: 'stretch'
				},
				items: [{
					xtype: 'container',
					flex: 0.4,
					dock: 'left',
					layout: {
						type: 'vbox',
						align: 'stretch'
					},
					items: [
					{
						xtype: 'textfield',
						id: 'txtItemCd',
						fieldLabel: '품목코드',
						labelAlign: 'right',
						labelStyle: 'background-color: #EDEFF5 !important; font-size:12px;',
						fieldStyle: 'font-size:12px; text-transform:uppercase;',
						margin: '5 0 0 0',
						width: 400,
						minWidth: 400,
						maxWidth: 400
					}, {
						xtype: 'textfield',
						id: 'txtItemNm',
						fieldLabel: '품목명',
						labelAlign: 'right',
						labelStyle: 'background-color: #EDEFF5 !important;font-size:12px;',
						fieldStyle: 'font-family:times,courier,arial;font-size:12px;',
						margin: '5 0 0 0',
						width: 400,
						minWidth: 400,
						maxWidth: 400
					}, {
						xtype: 'textfield',
						id: 'txtBpItemCd',
						fieldLabel: '주문처품목코드',
						labelAlign: 'right',
						labelStyle: 'background-color: #EDEFF5 !important; font-size:12px;',
						fieldStyle: 'font-family:times,courier,arial;font-size:12px;',
						margin: '5 0 0 0',
						width: 400,
						minWidth: 400,
						maxWidth: 400
					}, {
						xtype: 'textfield',
						id: 'txtSreqNo',
						fieldLabel: '주문번호',
						labelAlign: 'right',
						labelStyle: 'background-color: #EDEFF5 !important;font-size:12px;',
						fieldStyle: 'font-family:times,courier,arial;font-size:12px;',
						margin: '5 0 0 0',
						width: 400,
						minWidth: 400,
						maxWidth: 400
					}, {
						xtype: 'combobox',
						id: 'txtStatus',
						margin: '5 0 0 0',
						width: 400,
						minWidth: 400,
						maxWidth: 400,
						fieldLabel: '진행상태',
						hideEmptyLabel: false,
						labelAlign: 'right',
						labelStyle: 'background-color: #EDEFF5 !important;font-size:12px;',
						value: 'A',
						fieldStyle: 'font-family:times,courier,arial;font-size:12px;',
						readOnly: false,
						allowBlank: false,
						disableKeyFilter: true,
						enableKeyEvents: true,
						autoSelect: false,
						displayField: 'dtl_nm',
						queryMode: 'local',
						store: 'SatusCombo',
						typeAhead: true,
						valueField: 'dtl_cd',
						valueNotFoundText: 'No Code'
					}
				]
				}, {
					xtype: 'container',
					flex: 0.6,
					layout: {
						type: 'vbox',
						align: 'stretch'
					},
					items: [{
						xtype: 'hiddenfield',
						id: 'gridCol',
						fieldLabel: 'Label'
					}, {
						xtype: 'hiddenfield',
						id: 'itemPopCheck',
						fieldLabel: 'Label'
					}, {
						xtype: 'hiddenfield',
						id: 'gridCd1',
						fieldLabel: 'Label'
					}, {
						xtype: 'hiddenfield',
						id: 'gridCd2',
						fieldLabel: 'Label'
					}, {
						xtype: 'hiddenfield',
						id: 'gBpCd',
						fieldLabel: 'Label'
					}, {
						xtype: 'hiddenfield',
						id: 'gUserId',
						fieldLabel: 'Label'
					}, {
						xtype: 'hiddenfield',
						id: 'g_s_req_no',
						fieldLabel: 'Label'
					}, {
						xtype: 'hiddenfield',
						id: 'gStatus',
						fieldLabel: 'Label'
					}, {
						xtype: 'textfield',
						id: 'txtSpec',
						fieldLabel: '규격',
						labelAlign: 'right',
						labelStyle: 'background-color: #EDEFF5 !important;font-size:12px;',
						fieldStyle: 'font-family:times,courier,arial;font-size:12px;text-transform:uppercase;',
						margin: '5 0 0 0',
						width: 400,
						minWidth: 400,
						maxWidth: 400
//						}
//					]
					},
					{
						xtype: 'textfield',
						id: 'txtMaker',
						margin: '5 0 0 0',
						width: 400,
						minWidth: 400,
						maxWidth: 400,
						fieldLabel: 'Maker',
						labelAlign: 'right',
						labelStyle: 'background-color: #EDEFF5 !important;font-size:12px;',
						fieldStyle: 'font-family:times,courier,arial;font-size:12px;'
					},
					{
						xtype: 'textfield',
						id: 'txtBpItemNm',
						margin: '5 0 0 0',
						width: 400,
						minWidth: 400,
						maxWidth: 400,
						fieldLabel: '주문처품목명',
						labelAlign: 'right',
						labelStyle: 'background-color: #EDEFF5 !important;font-size:12px;',
						fieldStyle: 'font-family:times,courier,arial;font-size:12px;'
					},
					{
						xtype: 'container',
						layout: {
							type: 'hbox',
							align: 'stretch'
						},
						margin: '5 0 0 0',
						items: [
				        {
							xtype: 'datefield',
							id: 'txtdlvyhopdtfr',
							width: 240,
							minWidth: 240,
							maxWidth: 240,
							fieldLabel: '납기희망일',
							labelAlign: 'right',
							labelStyle: 'background-color: #EDEFF5 !important;font-size:12px;',
							fieldStyle: 'font-size:12px;text-align:center',
							format: 'Y-m-d',
							listeners: {
								render: 'onTxtdlvyhopdtfrRender'
							}
						},
						{
							xtype: 'datefield',
							id: 'txtdlvydthopto',
							width: 160,
							maxWidth: 160,
							minWidth: 160,
							fieldLabel: '~',
							labelAlign: 'right',
							labelSeparator: ' ',
							labelStyle: 'background-color: #EDEFF5 !important;font-size:12px;',
							labelWidth: 20,
							fieldStyle: 'font-size:12px;text-align:center',
							format: 'Y-m-d',
							listeners: {
								render: 'onTxtdlvydthoptoRender'
							}
						}
					]
					},
					{
							xtype: 'combobox',
							id: 'txtcfm',
							margin: '5 0 0 0',
							width: 400,
							minWidth: 400,
							maxWidth: 400,
							fieldLabel: '확정유무',
							labelAlign: 'right',
							labelStyle: 'background-color: #EDEFF5 !important;font-size:12px;',
							value: 'Y',
							fieldStyle: 'font-family:times,courier,arial;font-size:12px;',
							displayField: 'dtl_cd',
							store: 'YnCombo',
							valueField: 'dtl_cd'
					}
					]
				}]
			}, {
				xtype: 'container',
				region: 'north',
				items: [{
					xtype: 'gridpanel',
					multiSelect: false,
					id: 'grid1',
					bodyBorder: true,
					constrainHeader: true,
					minHeight: 300,
					maxHeight: 300,
					title: '▷ 주문진행내역',
					store: 'PurchaseIngStore',
					columns: [{
						xtype: 'rownumberer'
					}, {
						xtype: 'checkcolumn',
						id: 'checks',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 52,
						dataIndex: 'checks',
						text: '선택'
//						editor: {
//							xtype: 'checkboxfield'
//						}
					}, {
						xtype: 'gridcolumn',
						id: 's_req_no',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 57,
						align: 'center',
						dataIndex: 'cmf_yn',
						text: '확정'
					}, {
						xtype: 'gridcolumn',
						id: 's_req_no1',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 129,
						dataIndex: 's_req_no',
						text: '주문번호',
						editor: {
							xtype: 'textfield',
							editable: false
						}
					}, {
						xtype: 'gridcolumn',
						id: 's_req_seq',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 129,
						dataIndex: 's_req_seq',
						text: '주문순번'
					}, {
						xtype: 'gridcolumn',
						id: 'item_cd1',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 129,
						dataIndex: 'item_cd',
						text: '품목코드'
					}, {
						xtype: 'gridcolumn',
						id: 'item_nm',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 146,
						dataIndex: 'item_nm',
						text: '품목명'
					}, {
						xtype: 'gridcolumn',
						id: 'bp_item_cd',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 144,
						dataIndex: 'bp_item_cd',
						text: '주문처품목코드'
					}, {
						xtype: 'gridcolumn',
						id: 'bp_item_nm',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 139,
						dataIndex: 'bp_item_nm',
						text: '주문처품목명'
					}, {
						xtype: 'gridcolumn',
						id: 'spec',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 139,
						dataIndex: 'spec',
						text: '규격'
					}, {
						xtype: 'gridcolumn',
						id: 'maker',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 139,
						dataIndex: 'maker',
						text: 'Maker'
					}, {
						xtype: 'gridcolumn',
						id: 'unit',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 76,
						align: 'center',
						dataIndex: 'unit',
						text: '단위'
					}, {
						xtype: 'gridcolumn',
						renderer: function(value, metaData, record, rowIndex, colIndex, store, view){
							if (record.get('cmf_yn') === 'N') {
								metaData.tdCls = 'extjsGridPK';
							}
							return Ext.util.Format.number(value, '0,000');
						},
						id: 'so_qty',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 91,
						align: 'right',
						dataIndex: 'so_qty',
						text: '수량',
						editor: {
							xtype: 'textfield'
						}
					}, {
						xtype: 'gridcolumn',
						renderer: function(value, metaData, record, rowIndex, colIndex, store, view){
							return Ext.util.Format.number(value, '0,000');
						},
						id: 'so_prc',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 123,
						align: 'right',
						dataIndex: 'so_prc',
						text: '품목단가'
					}, {
						xtype: 'gridcolumn',
						renderer: function(value, metaData, record, rowIndex, colIndex, store, view){
							return Ext.util.Format.number(value, '0,000');
						},
						id: 'so_amt',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 123,
						align: 'right',
						dataIndex: 'so_amt',
						text: '금액'
					}, {
//						xtype: 'datecolumn',
						xtype: 'gridcolumn',
						id: 'dlvy_hop_dt_1',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 116,
						align: 'center',
						dataIndex: 'dlvy_hop_dt2',
						text: '납기요청일'
//						format: 'Y-m-d'
					}, {
						xtype: 'gridcolumn',
						id: 'net_usr_nm1',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 167,
						dataIndex: 'net_usr_id',
						text: '네트웍스 담당자'
					}, {
						xtype: 'gridcolumn',
						id: 'net_usr_nm',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 167,
						dataIndex: 'net_usr_nm',
						text: '네트웍스 담당자명'
					}, {
						xtype: 'gridcolumn',
						id: 'net_usr_mail',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 167,
						dataIndex: 'net_usr_mail',
						text: '네트웍스 E-MAIL'
					}, {
						xtype: 'gridcolumn',
						id: 'net_usr_tel',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						width: 167,
						dataIndex: 'net_usr_tel',
						text: '담당자 전화번호'
					}],
					viewConfig: {
						height: 348,
						enableTextSelection: true
					},
					plugins: [{
						ptype: 'cellediting',
						clicksToEdit: 1,
						listeners: {
							edit: 'onCellEditingEdit',
							beforeedit: 'onCellEditingBeforeEdit'
						}
					}]
				}
				]
			},
			{
				xtype: 'container',
				region: 'center',
				items: [{
					xtype: 'gridpanel',
					id: 'grid2',
					title: '  ▷ 납기진행내역',
					minHeight: 300,
					maxHeight: 300,
					columns: [{
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '주문번호'
					}, {
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '주문순번'
					}, {
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '품목코드'
					}, {
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '품목명'
					}, {
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '출하예정일'
					}, {
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '출하예정수량'
					}, {
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '납품수량'
					}, {
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '납품차량번호'
					}, {
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '납품차량담당자'
					}, {
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '납품차량전화번호'
					}, {
						xtype: 'gridcolumn',
						style: ' font-size:12px;text-align:center; background-color: #F8F8F8 !important',
						dataIndex: 'string',
						text: '도착예정일시'
					}]
				}]
			}]
		}]
	}],

	onTxtdlvyhopdtfrRender: function(component, eOpts){
		var nows = new Date();
		nows.setDate(nows.getDate() - 10);
		component.setValue(nows);
	},

	onTxtdlvydthoptoRender: function(component, eOpts){
		var nows = new Date();
		nows.setDate(nows.getDate() + 30);
		component.setValue(nows);
	},

	onCellEditingEdit: function(editor, context, eOpts){
		if (context.colIdx === 12) {
			if (context.record.get('cmf_yn') === 'N') {
				var so_qtys = context.record.get('so_qty');
				var so_prcs = context.record.get('so_prc');
				var so_amts = so_qtys * so_prcs;
				context.record.set('so_amt', so_amts);
			}
			parent.Ext.getCmp(Rawpurching.app.gText).setValue('N');

		}
	},

	onCellEditingBeforeEdit: function(editor, context, eOpts){

		if (context.record.get('cmf_yn') === 'N' && Ext.getCmp('txtStatus').getValue() === 'A') {

			return true;
		} else {

			return false;
		}
	}

});