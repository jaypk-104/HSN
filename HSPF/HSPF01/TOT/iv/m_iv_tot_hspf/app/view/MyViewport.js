/*
 * File: app/view/MyViewport.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('M_IV_TOT_HSPF.view.MyViewport', {
    extend: 'Ext.container.Viewport',
    alias: 'widget.myviewport',

    requires: [
        'M_IV_TOT_HSPF.view.MyViewportViewModel',
        'M_IV_TOT_HSPF.view.MyViewportViewController',
        'M_IV_TOT_HSPF.view.TbButton',
        'M_IV_TOT_HSPF.view.MyForm',
        'M_IV_TOT_HSPF.view.MyGrid',
        'M_IV_TOT_HSPF.view.MyGrid1',
        'Ext.form.Panel',
        'Ext.grid.Panel',
        'Ext.resizer.Splitter',
        'Ext.form.FieldSet',
        'Ext.form.field.Date',
        'Ext.form.RadioGroup',
        'Ext.form.field.Radio'
    ],

    controller: 'myviewport',
    viewModel: {
        type: 'myviewport'
    },
    height: 250,
    style: 'background-color: white',
    width: 400,

    layout: {
        type: 'vbox',
        align: 'stretch'
    },
    items: [
        {
            xtype: 'toolbarBtn'
        },
        {
            xtype: 'container',
            flex: 1,
            padding: '0 10 0 10',
            layout: {
                type: 'vbox',
                align: 'stretch',
                pack: 'center'
            },
            items: [
                {
                    xtype: 'container',
                    flex: 0.5,
                    layout: {
                        type: 'vbox',
                        align: 'stretch'
                    },
                    items: [
                        {
                            xtype: 'myform',
                            bodyPadding: 0
                        },
                        {
                            xtype: 'myGrid',
                            flex: 1
                        }
                    ]
                },
                {
                    xtype: 'splitter',
                    collapseTarget: 'prev'
                },
                {
                    xtype: 'container',
                    flex: 0.5,
                    layout: {
                        type: 'vbox',
                        align: 'stretch'
                    },
                    items: [
                        {
                            xtype: 'fieldset',
                            flex: 1,
                            height: 170,
                            maxHeight: 170,
                            minHeight: 170,
//                            title: '[ Search ]',
                            layout: {
                                type: 'vbox',
                                align: 'stretch',
                                pack: 'center'
                            },
                            collapsible: true,
                            items: [
                                {
                                    xtype: 'fieldcontainer',
                                    flex: 1,
                                    height: 35,
                                    margin: '0 0 3 0',
                                    maxHeight: 35,
                                    minHeight: 35,
                                    width: 400,
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'V_IV_NO',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '매입번호',
                                            emptyText: '(Double Click)',
                                            listeners: {
                                                afterrender: function(c) {
                                                	c.getEl().on('dblclick', function() {
                                                		var popup = Ext.create("M_IV_TOT_HSPF.view.MyWindow1");
                                            			popup.setSize(Ext.getBody().getViewSize());
                                                        
                                                        popup.center();
                                                        popup.show();

                                                        var popStore = Ext.getStore('PopStore');
                                                        popStore.removeAll();                                        
                                                        
                                                    });
                                                }
                                            },
                                        },
                                        {
                                            xtype: 'datefield',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '매입일자',
                                            format: 'Y-m-d',
                                            listeners: {
                                                render: {
                                                    fn: 'onDatefieldRender',
                                                    single: false
                                                }
                                            },
                                            id: 'V_IV_DT'
                                        },
                                        {
                                            xtype: 'combobox',
                                            id: 'V_IV_TYPE',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '매입형태',
                                            displayField: 'DTL_NM',
                                            valueField: 'DTL_CD',
                                            editable: false,
                                            margin: '0 0 0 30',
                                            store: Ext.create('Ext.data.Store',{
                                          		autoLoad: true,
                                          		storeId: 'storeMA02',
                                          		proxy: {
                                                      type: 'ajax',
                                                      extraParams: {
                                                       	V_MAST_CD: 'MA02',
                                                       	V_GRID: 'Y'
                                                      },	
                                                      api: {
                                                          read: '/HSPF01/common/sql/Combobox.jsp'
                                                      },
                                                      reader: {
                                                          type: 'json',
                                                          rootProperty: 'resultList'
                                                      }
                                                  }
                                          	}),
                                          	listConfig: {
                                                itemTpl: [
                                                          '<div>{DTL_NM} ({DTL_CD}) </div>'
                                                          ],
                                            },
                                            listeners : {
                                            	change: function(me, newValue, oldValue, eOpts) {
                                                	if(oldValue === newValue){
                                                	} else if(newValue === 'EXIV'){
                                                		Ext.getCmp('gridAddBtn').setDisabled(false);
                                                	} else {
                                                		Ext.getCmp('gridAddBtn').setDisabled(true);
                                                	}
                                                }
                                            }
                                        
                                        },
                                        {
                                        	xtype: 'textfield',
                                        	id: 'V_M_BP_NM2',
                                        	margin: '0 0 0 30',
                                        	maxWidth: 250,
                                        	minWidth: 250,
                                        	width: 250,
                                        	fieldLabel: '매입처',
//                                        	name: 'search_field',
                                            listeners: {
                                                afterrender: function(c) {
                                                	c.getEl().on('dblclick', function() {
                                            			var popup = Ext.create("Popup.view.WinMBpPop");
                                            			popup.show();
                                            			
                                            			Ext.getCmp('fieldType').setValue('M_IV_DISTR2');
                                            			var store = Ext.getStore('WinMBpPopStore');
                                            			store.removeAll();
                                                    });
                                                }
                                            },
                                            emptyText: '(Double Click)',
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'V_M_BP_CD2',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            hidden: true
//                                            name: 'search_field'
                                        },
                                        {
                                            xtype: 'numberfield',
                                            flex: 1,
                                            margin: '0 0 0 30',
                            	        	maxWidth: 170,
                            	        	minWidth: 170,
                            	        	width: 170,
                                            fieldLabel: '환율',
                                            labelWidth: 60,
                                            id: 'V_XCH_RATE',
                                            value: 1,
                                            decimalPrecision : 4,
                                            listeners: {
                                            	change: function(field, newValue, oldValue, eOpts) {
                                            		var store1 = Ext.getStore('MyStore1');
                                            		var XCH_RATE2 = Math.floor(newValue*10000)/10000;
                                            		
                                            		store1.each(function(record, idx) {
                                            			var CUR = record.get('CUR');
                                            			var PRC = record.get('PRC');
                                            			var IV_QTY = record.get('IV_QTY');
                                            			
                                            			if(CUR == 'USD'){
                                            				record.set('IV_AMT', (IV_QTY * PRC).toFixed(4));
                                            				record.set('IV_PRC', (XCH_RATE2 * PRC).toFixed(4));
//                                            				record.set('IV_LOC_AMT', Math.round((IV_QTY * PRC).toFixed(4) * XCH_RATE2));
                                            				record.set('IV_LOC_AMT', Math.round(record.get('IV_PRC') * IV_QTY));
                                            			} else {
                                            				record.set('IV_LOC_AMT', Math.round(record.get('IV_PRC') * IV_QTY));
                                            			}
                                            			
                                            			if(!!record.get('VAT_TYPE')){
                                        					var storeVAT = Ext.getStore('storeVAT');
                                                    		var match = storeVAT.findBy(function(rec,id) {
                                                    	        if(rec.get('DTL_CD') == record.get('VAT_TYPE')) {
                                                    	            return true;
                                                    	        }
                                                    	    });
                                                    		
                                                    		var vatRecord = storeVAT.getData().getAt(match);
                                                    		var VAT_RATE = vatRecord.get('VAT_RATE');
                                                    		var LOC_AMT = record.get('IV_LOC_AMT');
                                                			var VAT_AMT = 0;
                                                			
                                                			if(LOC_AMT > 0 && VAT_RATE > 0){
                                                				VAT_AMT = Math.floor(LOC_AMT * VAT_RATE / 100); 
                                                			}
                                                			record.set('VAT_AMT', VAT_AMT);
                                        				}
                                            		});
                                            	}
                                            }
                                        },
                                    ]
                                },
                                {
                                    xtype: 'fieldcontainer',
                                    flex: 1,
                                    height: 35,
                                    margin: '0 0 3 0',
                                    maxHeight: 35,
                                    minHeight: 35,
                                    width: 400,
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'V_T_BP_NM',
                                            margin: '',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '지급처',
                                            emptyText: '(Double Click)',
                                            listeners: {
                                                afterrender: function(c) {
                                                	c.getEl().on('dblclick', function() {
                                            			var popup = Ext.create("Popup.view.WinBpPop");
                                            			popup.show();
                                            			
                                            			Ext.getCmp('fieldType').setValue('M_IV_DISTR');
                                            			var store = Ext.getStore('WinBpPopStore');
                                            			store.removeAll();
                                                    });
                                                }
                                            },
//                                            hidden: true
                                        },
                                        {
                                        	xtype: 'textfield',
                                        	id: 'V_T_BP_CD',
                                        	margin: '',
                                            hidden: true
                                        },
                                        {
                                            xtype: 'datefield',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '지불예정일',
                                            format: 'Y-m-d',
                                            listeners: {
                                                render: {
                                                    fn: 'onDatefieldRender1',
                                                    single: false
                                                }
                                            },
                                            id: 'V_IV_ISSUE_DT'
                                        },
                                        {
                                            xtype: 'numberfield',
                                            id: 'V_XCHG_RT',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '선물환율',
                                            format: '0,000.00',
                                            value: 1,
                                            hidden: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'V_REMARK',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            labelWidth: 60,
                                            fieldLabel: '비고',
                                        },
                                        {
                                            xtype: 'combobox',
                                            id: 'V_CUR',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '화폐단위',
                            	        	value: 'USD',
                            	        	displayField: 'DTL_NM',
                            	        	valueField: 'DTL_CD',
                            	        	editable: false,
                            	        	store: Ext.create('Ext.data.Store',{
                            	        		autoLoad: true,
                            	        		storeId: 'store1',
                            	        		proxy: {
                            	        			type: 'ajax',
                            	        			extraParams: {
                            	        				V_MAST_CD: 'BA04',
                            	        				V_GRID: 'Y'
                            	        			},	
                            	        			api: {
                            	        				read: '/HSPF01/common/sql/Combobox.jsp'
                            	        			},
                            	        			reader: {
                            	        				type: 'json',
                            	        				rootProperty: 'resultList'
                            	        			}
                            	        		}
                            	        	}),
                            	        	listeners: {
                                            	change: function(field, newValue, oldValue, eOpts) {
                                            		if(newValue == 'KRW'){
                                            			Ext.getCmp('V_XCH_RATE').setValue(1);
                                            		}
                                            		var XCH_RATE2 = Ext.getCmp('V_XCH_RATE').getValue();

                                            		var store1 = Ext.getStore('MyStore1');
                                            		store1.each(function(record, idx) {
                                            			record.set('CUR', newValue);
                                            			
                                            			var PRC = record.get('PRC');
                                            			var IV_QTY = record.get('IV_QTY');
                                            			if(newValue == 'USD'){
                                            				record.set('IV_AMT', (IV_QTY * PRC).toFixed(4));
                                            				record.set('IV_PRC', (XCH_RATE2 * PRC).toFixed(4));
//                                            				record.set('IV_LOC_AMT', Math.round((IV_QTY * PRC).toFixed(4) * XCH_RATE2));
                                            				record.set('IV_LOC_AMT', Math.round(record.get('IV_PRC') * IV_QTY));
                                            			} else {
                                            				record.set('IV_LOC_AMT', Math.round(record.get('IV_PRC') * IV_QTY));
                                            			}
                                            			
                                            			if(!!record.get('VAT_TYPE')){
                                        					var storeVAT = Ext.getStore('storeVAT');
                                                    		var match = storeVAT.findBy(function(rec,id) {
                                                    	        if(rec.get('DTL_CD') == record.get('VAT_TYPE')) {
                                                    	            return true;
                                                    	        }
                                                    	    });
                                                    		
                                                    		var vatRecord = storeVAT.getData().getAt(match);
                                                    		var VAT_RATE = vatRecord.get('VAT_RATE');
                                                    		var LOC_AMT = record.get('IV_LOC_AMT');
                                                			var VAT_AMT = 0;
                                                			
                                                			if(LOC_AMT > 0 && VAT_RATE > 0){
                                                				VAT_AMT = Math.floor(LOC_AMT * VAT_RATE / 100); 
                                                			}
                                                			record.set('VAT_AMT', VAT_AMT);
                                        				}
                                            		});
                                            		
                                            	}
                                            }
                                        },
                                        {
                                        	xtype: 'textfield',
                                        	margin: '0 0 0 30',
                                        	maxWidth: 230,
                                        	minWidth: 230,
                                        	width: 230,
                                        	fieldLabel: '전표번호',
//                                        	labelWidth: 70,
                                        	blankText: '',
                                        	id: 'V_TEMP_GL_NO',
                                        	editable: false
                                        },
                                    ]
                                },
                                {
                                    xtype: 'fieldcontainer',
                                    flex: 1,
                                    height: 35,
                                    margin: '0 0 3 0',
                                    maxHeight: 35,
                                    minHeight: 35,
                                    width: 400,
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'V_BL_DOC_NO',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: 'B/L번호',
                                            hidden: true
                                        },
                                        {
                                            xtype: 'combobox',
                                            id: 'V_TAX_CD',
//                                            margin: '0 0 0 30',
                                            maxWidth: 300,
                                            minWidth: 300,
                                            width: 300,
                                            fieldLabel: '세금계산서신고사업장',
                                            labelWidth: 150,
                                            blankText: '',
                                            displayField: 'DTL_NM',
                                            valueField: 'DTL_CD',
                                            editable: false,
                                            value: 'TX1',
                                            store: Ext.create('Ext.data.Store',{
                                          		autoLoad: true,
                                          		storeId: 'storeMA16',
                                          		proxy: {
                                                      type: 'ajax',
                                                      extraParams: {
                                                       	V_MAST_CD: 'MA16',
                                                       	V_GRID: 'Y'
                                                      },	
                                                      api: {
                                                          read: '/HSPF01/common/sql/Combobox.jsp'
                                                      },
                                                      reader: {
                                                          type: 'json',
                                                          rootProperty: 'resultList'
                                                      }
                                                  }
                                          	}),
                                          	listConfig: {
                                                itemTpl: [
                                                          '<div>{DTL_NM} ({DTL_CD}) </div>'
                                                          ],
                                                  }
                                        },
                                        {
                                            xtype: 'combobox',
                                            maxWidth: 350,
                                            minWidth: 350,
                                            width: 350,
                                            fieldLabel: '결제방법',
                                            id: 'V_PAY_METH',
                                            blankText: '',
                                            displayField: 'DTL_NM',
                                            valueField: 'DTL_CD',
                                            editable: false,
                                            margin: '0 0 0 30',
                                            value: 'CH',
                                            store: Ext.create('Ext.data.Store',{
                                          		autoLoad: true,
                                          		storeId: 'store1',
                                          		proxy: {
                                                      type: 'ajax',
                                                      extraParams: {
                                                       	V_MAST_CD: 'MA03',
                                                       	V_GRID: 'Y'
                                                      },	
                                                      api: {
                                                          read: '/HSPF01/common/sql/Combobox.jsp'
                                                      },
                                                      reader: {
                                                          type: 'json',
                                                          rootProperty: 'resultList'
                                                      }
                                                  }
                                          	}),
                                          	listConfig: {
                                                itemTpl: [
                                                          '<div>{DTL_NM} ({DTL_CD}) </div>'
                                                          ],
                                                  }
                                        
                                        },
                                        {
                            	        	xtype: 'combobox',
                                            maxWidth: 350,
                                            minWidth: 350,
                                            width: 350,
                                            margin: '0 0 0 30',
                            	        	fieldLabel: '가격조건',
                            	        	id: 'V_IN_TERMS',
                                            margin: '0 0 0 30',
                            	        	labelWidth: 120,
                            	        	name: 'search_field',
                            	        	blankText: '',
                            	        	displayField: 'DTL_NM',
                            	        	valueField: 'DTL_CD',
                            	        	editable: false,
                            	        	hidden: true,
                            	        	store: Ext.create('Ext.data.Store',{
                            	        		autoLoad: true,
                            	        		storeId: 'store1',
                            	        		proxy: {
                            	        			type: 'ajax',
                            	        			extraParams: {
                            	        				V_MAST_CD: 'MA04',
                            	        				V_GRID: 'Y'
                            	        			},	
                            	        			api: {
                            	        				read: '/HSPF01/common/sql/Combobox.jsp'
                            	        			},
                            	        			reader: {
                            	        				type: 'json',
                            	        				rootProperty: 'resultList'
                            	        			}
                            	        		}
                            	        	}),
                            	        	listConfig: {
                                                itemTpl: [
                                                          '<div>{DTL_NM} ({DTL_CD}) </div>'
                                                          ],
                                            }
                            	        },
                                        {
                                            xtype: 'radiogroup',
                                            flex: 1,
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            fieldLabel: '전자세금계산서유무',
                                            labelWidth: 150,
                                            id: 'V_ELEC_VAT_YN',
                                            items: [
                                                    {
                                                        xtype: 'radiofield',
                                                        boxLabel: 'Y',
                                                        name: 'rb1',
                                                        id: 'rb1Y',
                                                        inputValue: 'Y',
                                                        checked: true,
                                                    },
                                                    {
                                                        xtype: 'radiofield',
                                                        boxLabel: 'N',
                                                        name: 'rb1',
                                                        id: 'rb1N',
                                                        inputValue : 'N',
                                                    }
                                            ]
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'V_INSRT_USR_ID',
                                            margin: '0 0 0 30',
                                            maxWidth: 250,
                                            minWidth: 250,
                                            width: 250,
                                            labelWidth: 60,
                                            fieldLabel: 'V_INSRT_USR_ID',
                                            hidden: true
                                        },
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'mygrid1',
                            flex: 1
                        }
                    ]
                }
            ]
        }
    ]

});