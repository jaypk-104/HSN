/*
 * File: app/controller/TbButtonController.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('M_PO_TOT_MGM.controller.RefWindowController', {
    extend: 'Ext.app.Controller',
    stores: ['MyStore', 'MyStore1','Popup.store.WinBpPopStore', 'PoBaseInfoStore', 'RefStore', 'RefStore2'],
    control: {
        "#ref_selBtn": {
            click: 'ref_selBtnClick'
        },
        "#refGrid": {
            cellclick: 'refGridCellClick'
        },
        "#refOkBtn": {
        	click: 'refOkBtnClick'
        },
        "#ref_xlsxDown2": {
            click: 'ref_xlsxDown2Click'
        },
        "[cls=ref_search]": {
            specialkey: 'refEnter'
        }
    },

    ref_selBtnClick: function(button, e, eOpts) {
    	var store1 = Ext.getStore('RefStore');
    	store1.removeAll();
    	
    	store1.load({
    		params: {
    			V_TYPE: 'REF_H',
    			V_COMP_ID: parent.Ext.getCmp('GCOMP_ID').getValue(),
    			V_USR_ID: parent.Ext.getCmp('GUSER_ID').getValue(),
    			REF_PO_DT_FR : Ext.getCmp('REF_PO_DT_FR').getValue(),
    			REF_PO_DT_TO : Ext.getCmp('REF_PO_DT_TO').getValue(),
    			REF_M_BP_NM : Ext.getCmp('REF_M_BP_NM').getValue(),
    			REF_PO_USR_NM : Ext.getCmp('REF_PO_USR_NM').getValue(),
    			
    		},
    		callback: function(records,operations,success){
    			
    		}
    	});
    	
    },
    
    refGridCellClick: function(tableview, td, cellIndex, record, tr, rowIndex, e, eOpts) {
    	var store = this.getStore("RefStore2");
    	store.load({
    		params:{
    			V_TYPE : 'REF_D',
    			V_COMP_ID : parent.Ext.getCmp('GCOMP_ID').getValue(),
    			V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
    			V_MAST_PO_NO : record.data['MAST_PO_NO']
    		}
    	});
    },
    
    refOkBtnClick: function(button, e, eOpts) {
    	var record = Ext.getCmp('refGrid').getSelectionModel().getSelection();
    	
    	var mainStore = Ext.getCmp('myGrid').getStore();
    	mainStore.removeAll();
    	
    	if(record.length == 1){
    		Ext.getCmp('V_MAST_PO_NO').setValue('');
    		Ext.getCmp('V_M_BP_CD').setValue(record[0].data['M_BP_CD']);
    		Ext.getCmp('V_M_BP_NM').setValue(record[0].data['M_BP_CD']);
    		Ext.getCmp('V_PO_TYPE').setValue(record[0].data['PO_TYPE_CD']);
    		Ext.getCmp('V_CUR').setValue(record[0].data['CUR']);
    		Ext.getCmp('V_IN_TERMS').setValue(record[0].data['IN_TERMS_CD']);
    		Ext.getCmp('V_PAY_METH').setValue(record[0].data['PAY_METH_CD']);
    		Ext.getCmp('V_VAT_TYPE').setValue(record[0].data['VAT_TYPE_CD']);
    		Ext.getCmp('V_DLV_TYPE').setValue(record[0].data['DLV_TYPE_CD']);
    		Ext.getCmp('V_GR_TYPE').setValue(record[0].data['GR_TYPE_CD']);
    		Ext.getCmp('V_S_BP_NM').setValue(record[0].data['S_BP_NM']);
    		Ext.getCmp('V_S_BP_CD').setValue(record[0].data['S_BP_CD']);
    		Ext.getCmp('V_REMARK').setValue(record[0].data['REMARK']);
    		Ext.getCmp('V_SYS_TYPE').setValue(record[0].data['SYS_TYPE_CD']);
    		Ext.getCmp('V_TRANS_TYPE').setValue(record[0].data['TRANS_TYPE_CD']);
    		Ext.getCmp('V_DISCHGE_PORT').setValue(record[0].data['DISCHGE_PORT_CD']);
    		
    		var d_record = Ext.getCmp('refGrid2').getStore().getRange();
    		
    		for(var i = 0 ; i < d_record.length ; i ++){
    			var rec = Ext.create('M_PO_TOT_MGM.model.MyModel', {
    				ITEM_CD : d_record[i].data['ITEM_CD'],
    				ITEM_NM : d_record[i].data['ITEM_NM'],
    				SPEC : d_record[i].data['SPEC'],
    				MAKER : d_record[i].data['MAKER'],
    				AGENT : d_record[i].data['AGENT'],
    				UNIT : d_record[i].data['UNIT'],
    				TOT_PO_QTY : d_record[i].data['TOT_PO_QTY'],
    				PO_PRC : d_record[i].data['PO_PRC'],
    				TOT_PO_AMT : d_record[i].data['TOT_PO_AMT'],
    				HOPE_SL_CD : d_record[i].data['HOPE_SL_CD'],
    				GR_SL_CD : d_record[i].data['GR_SL_CD'],
    				SUPP_REMARK : d_record[i].data['SUPP_REMARK'],
    				DLVY_HOPE_DT1 : d_record[i].data['DLVY_HOPE_DT1'],
    				PO_QTY1 : d_record[i].data['PO_QTY1'],
    				PO_AMT1 : d_record[i].data['PO_AMT1'],
    				PO_REMARK1 : d_record[i].data['PO_REMARK1'],
        		});
    			mainStore.add(rec);
    		}
    		
    		
    		
    		Ext.getCmp('RefWindow').destroy();
    	}
    	else{
    		Ext.Msg.alert('확인', '상단에서 행을 하나 선택해주세요.');
    	}
    },
    
    ref_xlsxDown2Click: function(button, e, eOpts) {
    	
        var currentDate = Ext.util.Format.date(new Date(), 'Y-m-d His');
    	var grid = Ext.getCmp('refGrid2');
    	grid.saveDocumentAs({
            type: 'xlsx',
            title: '발주참조', //엑셀내타이틀
            fileName: currentDate+'.xlsx' //엑셀파일이름
		});
    },
    
    refEnter: function(field, e, eOpts) {
    	if (e.getKey() == e.ENTER) {
    		this.ref_selBtnClick();
    	}
}
   

});
