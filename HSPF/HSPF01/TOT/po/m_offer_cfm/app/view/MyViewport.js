/*
 * File: app/view/MyViewport.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('M_OFFER_CFM.view.MyViewport', {
    extend: 'Ext.container.Viewport',
    alias: 'widget.myviewport',

    requires: [
        'M_OFFER_CFM.view.MyViewportViewModel',
        'M_OFFER_CFM.view.TbButton',
        'M_OFFER_CFM.view.MyForm',
        'Ext.form.Panel',
        'Ext.grid.Panel',
        'Ext.grid.column.RowNumberer',
        'Ext.grid.column.Number',
        'Ext.view.Table',
        'Ext.selection.CheckboxModel',
        'Ext.grid.plugin.Exporter',
        'Ext.grid.plugin.CellEditing',
        'Ext.grid.filters.Filters',
        'Ext.grid.column.Date',
        'Ext.resizer.Splitter'
    ],

    viewModel: {
        type: 'myviewport'
    },
    height: 250,
    style: 'background-color: white',
    width: 400,

    layout: {
        type: 'vbox',
        align: 'stretch'
    },
    items: [
        {
            xtype: 'toolbarBtn'
        },
        {
            xtype: 'container',
            flex: 1,
            padding: '0 10 0 10',
            layout: 'fit',
            items: [
                {
                    xtype: 'container',
                    layout: {
                        type: 'vbox',
                        align: 'stretch'
                    },
                    items: [
                        {
                            xtype: 'myform'
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            layout: {
                                type: 'vbox',
                                align: 'stretch'
                            },
                            items: [
                                {
                                    xtype: 'gridpanel',
                                    flex: 0.4,
                                    style: 'border: 1px solid lightgray; padding: 5px;',
                                    header: false,
                                    title: 'My Grid Panel',
                                    id: 'myGrid',
                                    store: 'MyStore',
                                    columns: [
                                        {
                                            xtype: 'rownumberer',
                                            width: 40
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 114,
                                            dataIndex: 'V_TYPE',
                                            text: 'V_TYPE',
                                            hidden: true
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 90,
                                            dataIndex: 'PO_USR_NM',
                                            text: '발주자',
                                            filter: {
                                                type: 'list'
                                            }
                                            
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 150,
                                            dataIndex: 'MAST_PO_NO',
                                            text: '발주번호'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 80,
                                            dataIndex: 'BP_CD',
                                            text: '공급사코드'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 200,
                                            dataIndex: 'BP_NM',
                                            text: '공급사명',
                                            filter: {
                                                type: 'list'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 160,
                                            dataIndex: 'IN_TERMS_NM',
                                            text: '가격조건'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 160,
                                            dataIndex: 'PAY_METH_NM',
                                            text: '결제방법'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 100,
                                            dataIndex: 'DLV_TYPE_NM',
                                            text: '입고구분'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 80,
                                            dataIndex: 'GR_TYPE_NM',
                                            text: '입고단위'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 80,
                                            dataIndex: 'SYS_TYPE_NM',
                                            text: '시스템구분'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 80,
                                            dataIndex: 'CUR',
                                            text: '화폐단위'
                                        },
                                        {
                                            xtype: 'numbercolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            align: 'end',
                                            dataIndex: 'XCH_RATE',
                                            text: '환율',
                                            format: '0,000.',
                                            width: 100
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 160,
                                            dataIndex: 'VAT_TYPE_NM',
                                            text: '부가세유형'
                                        },
                                        {
                                        	xtype: 'gridcolumn',
                                        	style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                        	width: 100,
                                        	dataIndex: 'CHG_YN',
                                        	text: '변경여부',
                                        	align: 'center'
                                        },
                                        {
                                        	xtype: 'gridcolumn',
                                        	style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                        	width: 100,
                                        	dataIndex: 'OF_CFM_YN',
                                        	text: '오퍼확정여부',
                                        	align: 'center',
                                        	hidden: true
                                        }
                                    ],
                                    viewConfig: {
                                    	enableTextSelection: true,
                                    },
                                    selModel: {
                                        selType: 'checkboxmodel',
                                        mode: 'SINGLE',
                                    },
                                    plugins: [
                                        {
                                            ptype: 'gridexporter'
                                        },
                                        {
                                            ptype: 'cellediting'
                                        },
                                        {
                                            ptype: 'gridfilters'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'splitter',
                                    height: 10
                                },
                                {
                                    xtype: 'gridpanel',
                                    flex: 0.6,
                                    tbar: [
                                        {
                                            id: 'gridAddBtn',
                                            text: '',
                                            margin: '0 3 0 0',
                                            glyph: 'xf055@FontAwesome',
                                            iconCls: 'grid-add-btn',
                                            disabled: true
                                        },
                                        {
                                            id: 'gridDelBtn',
                                            text: '',
                                            margin: '0 3 0 0',
                                            glyph: 'xf056@FontAwesome',
                                            iconCls: 'grid-del-btn',
                                            disabled: true
                                        },
                                        {
                                        	id: 'gridSaveBtn',
                                        	text: '',
                                        	margin: '0 3 0 0',
                                        	glyph: 'xf0c7@FontAwesome',
                                        	iconCls: 'grid-save-btn',
                                        },
                                        {
                                        	id: 'gridCfmBtn',
                                        	text: '확정/취소',
                                        	margin: '0 3 0 0',
                                        	 cls: 'blue-btn',
                                             style: 'background-color: white; border: 0.5px solid #3367d6;',
                                             	hidden: true
                                        },
                                        {
                                            xtype: 'container',
                                            flex: 1
                                        },
                                        {
                                            xtype: 'button',
                                            glyph: 'xf1c3@FontAwesome',
                                            id: 'xlsxDown1',
                                            cfg: {
                                                type: 'excel07',
                                                ext: 'xlsx'
                                            },
                                            iconCls: 'grid-excel-btn',
                                            margin: '0 3 0 0',
                                            
                                        }
                                    ],
                                    flex: 0.7,
                                    style: 'border: 1px solid lightgray; padding: 5px;',
                                    header: false,
                                    title: 'My Grid Panel',
                                    id: 'myGrid1',
                                    store: 'MyStore1',
                                    columns: [
                                        {
                                            xtype: 'rownumberer',
                                            width: 40
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 114,
                                            dataIndex: 'V_TYPE',
                                            text: 'V_TYPE',
                                            hidden: true
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 150,
                                            dataIndex: 'PO_NO',
                                            text: '세부발주번호'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 80,
                                            dataIndex: 'PO_SEQ',
                                            text: '발주순번',
                                            align: 'end'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 120,
                                            dataIndex: 'ITEM_CD',
                                            text: '품목코드'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 200,
                                            dataIndex: 'ITEM_NM',
                                            text: '품목명'
                                        },
                                        {
                                        	xtype: 'gridcolumn',
                                        	style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                        	width: 150,
                                        	dataIndex: 'MAKER',
                                        	text: 'MAKER'
                                        },
                                        {
                                        	xtype: 'gridcolumn',
                                        	style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                        	width: 150,
                                        	dataIndex: 'AGENT',
                                        	text: 'AGENT'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 110,
                                            dataIndex: 'SPEC',
                                            text: '규격'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            width: 80,
                                            dataIndex: 'UNIT',
                                            text: '단위'
                                        },
                                        {
                                            xtype: 'numbercolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            align: 'end',
                                            dataIndex: 'PO_PRC',
                                            text: '발주단가',
                                            format: '0,000.00000',
                                            editor: {
                                            	xtype: 'numberfield',
                                            	decimalPrecision: 5
                                            },
                                            sortable: false,
                                        },
                                        {
                                            xtype: 'numbercolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            align: 'end',
                                            dataIndex: 'PO_QTY',
                                            text: '발주수량',
                                            format: '0,000.00',
                                            editor: {
                                            	xtype: 'numberfield',
                                            	decimalPrecision: 2
                                            },
                                            sortable: false,
                                    		summaryType : 'sum',
                                    		summaryRenderer : function(value, summaryData, dataIndex) {
                                    			return "<font color='green'>" + Ext.util.Format.number(value, '0,000.00') + "<font>";
                                    		},
                                        },
                                        {
                                            xtype: 'numbercolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            align: 'end',
                                            dataIndex: 'PO_AMT',
                                            width: 120,
                                            text: '발주금액',
                                            format: '0,000.0000',
                                            editor: {
                                            	xtype: 'numberfield',
                                            	decimalPrecision: 4
                                            },
                                            sortable: false,
                                    		summaryType : 'sum',
                                    		summaryRenderer : function(value, summaryData, dataIndex) {
                                    			return "<font color='green'>" + Ext.util.Format.number(value, '0,000.0000') + "<font>";
                                    		},
                                        },
                                        {
                                            xtype: 'datecolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                                            text: '납기요청일',
                                            dataIndex: 'DLVY_HOPE_DT',
                                            format: 'Y-m-d'
                                        },
                                        {
                                            xtype: 'numbercolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                                            align: 'end',
                                            dataIndex: 'CHG_PO_PRC',
                                            text: '변경발주단가',
                                            format: '0,000.00000',
                                            editor: {
                                            	xtype: 'numberfield',
                                                decimalPrecision:5
                                            },
                                            tdCls: 'x-change-cell1',
                                        },
                                        {
                                            xtype: 'numbercolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                                            align: 'end',
                                            dataIndex: 'CHG_PO_QTY',
                                            text: '변경발주수량',
                                            format: '0,000.00',
                                            editor: {
                                            	xtype: 'numberfield',
                                            	decimalPrecision: 2
                                            },
                                            sortable: false,
                                    		summaryType : 'sum',
                                    		summaryRenderer : function(value, summaryData, dataIndex) {
                                    			return "<font color='green'>" + Ext.util.Format.number(value, '0,000.00') + "<font>";
                                    		},
                                            tdCls: 'x-change-cell2',
                                        },
                                        {
                                            xtype: 'numbercolumn',
                                            width: 120,
                                            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                                            align: 'end',
                                            dataIndex: 'CHG_PO_AMT',
                                            text: '변경발주금액',
                                            format: '0,000.0000',
                                            editor: {
                                            	xtype: 'numberfield',
                                                decimalPrecision:4
                                            },
                                            sortable: false,
                                    		summaryType : 'sum',
                                    		summaryRenderer : function(value, summaryData, dataIndex) {
                                    			return "<font color='green'>" + Ext.util.Format.number(value, '0,000.0000') + "<font>";
                                    		},
                                            tdCls: 'x-change-cell3' 	,
                                        },
                                        {
                                            xtype: 'datecolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                                            text: '변경납기요청일',
                                            dataIndex: 'CHG_DLV_DT',
                                            format: 'Y-m-d',
                                            submitFormat: 'Y-m-d',
                                            editor: {
                                                xtype: 'datefield',
                                                altFormats: 'm/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d|n-j|n/j|Ymd',
                                                format: 'Y-m-d',
                                                allowBlank: false
                                            },
                                            sortable: false,
                                            tdCls: 'x-change-cell4' 	,
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                                            width: 200,
                                            dataIndex: 'OFFERNO',
                                            text: 'OFFER 번호',
                                            editor: {
                                            	xtype: 'textfield'
                                            },
                                            tdCls: 'x-change-cell5' 	,
                                        },
                                        {
                                        	xtype: 'gridcolumn',
                                        	style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                                        	width: 200,
                                        	dataIndex: 'OF_CFM_YN',
                                        	text: 'OF_CFM_YN',
                                        	hidden: true
                                        },
                                        {
                                        	xtype: 'gridcolumn',
                                        	style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                                        	width: 200,
                                        	dataIndex: 'MAST_PO_NO',
                                        	text: 'MAST_PO_NO',
                                        	hidden: true
                                        }
                                    ],
                                    viewConfig: {
                                    	enableTextSelection: true,
                                    	getRowClass: function(record, index) {
                                            var PO_PRC = record.get('PO_PRC'); 
                                            var PO_QTY = record.get('PO_QTY'); 
                                            var PO_AMT = record.get('PO_AMT'); 
                                            var DLVY_HOPE_DT = record.get('DLVY_HOPE_DT'); 
                                            
                                            var CHG_PO_PRC = record.get('CHG_PO_PRC'); 
                                            var CHG_PO_QTY = record.get('CHG_PO_QTY'); 
                                            var CHG_PO_AMT = record.get('CHG_PO_AMT'); 
                                            var CHG_DLV_DT = record.get('CHG_DLV_DT'); 

                                            var OFFERNO = record.get('OFFERNO'); 
                                            var OF_CFM_YN = record.get('OF_CFM_YN'); 
                                            
                                            if((PO_PRC != CHG_PO_PRC) || (PO_QTY != CHG_PO_QTY) || (PO_AMT != CHG_PO_AMT ) || (DLVY_HOPE_DT != CHG_DLV_DT ) || (OFFERNO != undefined)){
                                            	return 'bg-green';
                                            }
                                        },
                                    },
                                    selModel: {
                                        selType: 'checkboxmodel',
	                                    listeners: {
	                                    	select: function(rowmodel, record, index, eOpts) {
	                                        	record.set('V_TYPE', 'V');
	                                        },
	                                        deselect: function(rowmodel, record, index, eOpts) {
	                                        	record.set('V_TYPE', '');
	                                        }
	                                    }},
                                    plugins: [
                                        {
                                            ptype: 'gridexporter'
                                        },
                                        {
                                            ptype: 'cellediting',
                                            listeners: {
                                            	afteredit: function(editor, context, eOpts) {
                                            		
                                            		/*변경발주단가*/
                                            		if(context.column.dataIndex=='CHG_PO_PRC') {
                                            			var CHG_PO_PRC = context.record.get('CHG_PO_PRC');
                                            			var CHG_PO_QTY = context.record.get('CHG_PO_QTY');

                                            			context.record.set('CHG_PO_AMT', CHG_PO_PRC * CHG_PO_QTY);
                                            		} 
                                            		
                                            		/*변경발주수량*/
                                            		else if(context.column.dataIndex=='CHG_PO_QTY') {
                                            			
                                            			var CHG_PO_PRC = context.record.get('CHG_PO_PRC');
                                            			var CHG_PO_QTY = context.record.get('CHG_PO_QTY');
                                            			
                                            			context.record.set('CHG_PO_AMT', CHG_PO_PRC * CHG_PO_QTY);
                                            		} 

                                            		/*변경발주금액*/
                                            		else if(context.column.dataIndex=='CHG_PO_AMT') {
                                            			
                                            			var CHG_PO_AMT = context.record.get('CHG_PO_AMT');
                                            			var CHG_PO_QTY = context.record.get('CHG_PO_QTY');
                                            			
                                            			context.record.set('CHG_PO_PRC', CHG_PO_AMT / CHG_PO_QTY);
                                            		} 
                                            	},
                                            }
                                        },
                                        {
                                            ptype: 'gridfilters'
                                        }
                                    ],
                                	features : [ {
                                		ftype: 'summary',
                                	} ],
                                }
                            ]
                        }
                    ]
                },
            ]
        }
    ]

});