/*
 * File: app/view/MyViewport.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('HsnaPoReqMgm.view.MyViewport', {
    extend: 'Ext.container.Viewport',
    alias: 'widget.myviewport',

    requires: [
        'HsnaPoReqMgm.view.MyViewportViewModel1',
        'Ext.form.Panel',
        'Ext.button.Button',
        'Ext.form.field.Date',
        'Ext.form.RadioGroup',
        'Ext.form.field.Radio',
        'Ext.grid.Panel',
        'Ext.grid.column.RowNumberer',
        'Ext.grid.column.Check',
        'Ext.view.Table',
        'Ext.grid.plugin.CellEditing',
//        'Ext.ux.exporter.Exporter'
    ],

    viewModel: {
        type: 'myviewport'
    },
    id: 'MyViewport',
    layout: 'card',
    defaultListenerScope: true,

    items: [
        {
            xtype: 'form',
            modal: true,
            layout: 'border',
            bodyStyle: 'background-color: #FFFFFF !important',
            header: false,
            title: 'My Form',
            items: [
                {
                    xtype: 'panel',
                    region: 'center',
                    id: 'mainForm',
                    layout: 'border',
                    bodyPadding: 10,
                    bodyStyle: 'background-color: #FFFFFF !important',
                    title: '▶해외법인 주문접수',
                    titleAlign: 'left',
                    items: [
                        {
                            xtype: 'container',
                            region: 'north',
                            height: 34,
                            items: [
                                {
                                    xtype: 'button',
                                    id: 'selectBtn',
                                    margin: '0 3 0 0',
                                    maxWidth: 100,
                                    minWidth: 100,
                                    height:34,
                                    text: '조회',
                                    glyph: 'xf002@FontAwesome',
                                },
                                {
                                    xtype: 'button',
                                    id: 'orderBtn',
                                    margin: '0 3 0 0',
                                    maxWidth: 100,
                                    minWidth: 100,
                                    height:34,
                                    text: '주문접수',
                                    glyph: 'xf0c7@FontAwesome',
                                },
                                {
                                    xtype: 'button',
                                    id: 'cancelBtn',
                                    margin: '0 3 0 0',
                                    maxWidth: 100,
                                    minWidth: 100,
                                    height:34,
                                    text: '접수취소',
                                    glyph: 'f05e@FontAwesome',
                                },
                                {
                                	xtype: 'button',
                                	id: 'removeBtn',
                                	margin: '0 3 0 0',
                                	maxWidth: 100,
                                	minWidth: 100,
                                	height:34,
                                	text: '주문삭제',
                                	glyph: 'f05e@FontAwesome',
                                },
                                {
                                    xtype: 'button',
                                    height: 35,
                                    id: 'loadBtn',
                                    margin: '0 3 0 0',
                                    maxWidth: 200,
                                    minWidth: 200,
                                    width: 200,
                                    text: 'HSNA 발주데이터 불러오기',
                                    glyph: 'f1b8@FontAwesome',
                                },
                                {
                                	xtype: 'button',
                                	height: 35,
                                	id: 'reRegBtn',
                                	margin: '0 3 0 0',
                                	maxWidth: 150,
                                	minWidth: 150,
                                	width: 150,
                                	text: 'HSNA 품목재설정',
                                	icon: '../../../images/btn/refErpbutton.jpg',
                                	hidden: true
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            region: 'north',
                            height: 100,
                            style: 'background-color: #EDEFF5 !important',
                            layout: {
                                type: 'hbox',
                                align: 'stretch'
                            },
                            items: [
                                {
                                    xtype: 'container',
//                                    flex: 1,
                                    flex: 0.4,
                                    layout: {
                                        type: 'vbox',
                                        align: 'stretch'
                                    },
                                    items: [
                                        {
                                            xtype: 'container',
                                            margin: '5 0 5 0',
                                            layout: {
                                                type: 'hbox',
                                                align: 'stretch'
                                            },
                                            items: [
                                                {
                                                    xtype: 'datefield',
                                                    id: 'u_na_dt_from',
                                                    maxWidth: 240,
                                                    minWidth: 240,
                                                    width: 240,
                                                    fieldLabel: '발주일자',
                                                    labelAlign: 'right',
                                                    labelStyle: 'background-color: #EDEFF5 !important; font-size:12px;',
                                                    fieldStyle: 'text-align: center;',
                                                    format: 'Y-m-d',
                                                    listeners: {
                        								render: 'onTxtunadtFromRender'
                        							}
                                                },
                                                {
                                                    xtype: 'datefield',
                                                    flex: 1,
                                                    id: 'u_na_dt_to',
                                                    maxWidth: 160,
                                                    minWidth: 160,
                                                    width: 160,
                                                    fieldLabel: '~',
                                                    labelAlign: 'right',
                                                    labelStyle: 'background-color: #EDEFF5 !important; font-size:12px;',
                                                    fieldStyle: 'text-align: center;',
                                                    labelWidth: 20,
                                                    format: 'Y-m-d',
                        							listeners: {
                        								render: 'onTxtunadtToRender'
                        							}
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'container',
                                            layout: {
                                                type: 'hbox',
                                                align: 'stretch'
                                            },
                                            items: [
                                                {
                                                    xtype: 'datefield',
                                                    id: 'u_dt_from',
                                                    maxWidth: 240,
                                                    minWidth: 240,
                                                    width: 240,
                                                    fieldLabel: '납기요청일',
                                                    labelAlign: 'right',
                                                    labelStyle: 'background-color: #EDEFF5 !important; font-size:12px;',
                                                    fieldStyle: 'text-align: center;',
                                                    format: 'Y-m-d',
                                                    listeners: {
                        								render: 'onTxtunadtFromRender'
                        							}
                                                },
                                                {
                                                    xtype: 'datefield',
                                                    flex: 1,
                                                    id: 'u_dt_to',
                                                    maxWidth: 160,
                                                    minWidth: 160,
                                                    width: 160,
                                                    fieldLabel: '~',
                                                    labelAlign: 'right',
                                                    labelStyle: 'background-color: #EDEFF5 !important; font-size:12px;',
                                                    fieldStyle: 'text-align: center;',
                                                    labelWidth: 20,
                                                    format: 'Y-m-d',
                        							listeners: {
                        								render: 'onTxtunadtToRender1'
                        							}
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'container',
//                                    flex: 1,
                                    flex: 0.6,
                                    dock: 'left',
                                    items: [
                                        {
                                            xtype: 'container',
                                            margin: '5 0 0 0',
                                            items: [
                                                {
                                                    xtype: 'radiogroup',
                                                    width: 400,
                                                    fieldLabel: 'PO생성유무',
                                                    labelAlign: 'right',
                                                    labelStyle: 'background-color: #EDEFF5 !important; font-size:12px;',
                                                    id: 'poradio',
                                                    name: 'poradio',
                                                    items: [
                                                        {
                                                            xtype: 'radiofield',
                                                            name: 'poradio',
                                                            boxLabel: 'Y',
                                                            inputValue: 'Y'
                                                        },
                                                        {
                                                            xtype: 'radiofield',
                                                            name: 'poradio',
                                                            boxLabel: 'N',
                                                            inputValue: 'N',
                                                        	checked: true
                                                        },
                                                        {
                                                            xtype: 'radiofield',
                                                            name: 'poradio',
                                                            fieldLabel: 'Label',
                                                            hideLabel: true,
                                                            boxLabel: 'ALL',
                                                            inputValue: 'ALL',
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'container',
                                            layout: {
                                                type: 'hbox',
                                                align: 'stretch'
                                            },
                                            items: [
                                                {
                                                    xtype: 'textfield',
                                                    flex: 1,
                                                    id: 'u_po_no',
                                                    maxWidth: 400,
                                                    minWidth: 400,
                                                    width: 400,
                                                    fieldLabel: '발주번호',
                                                    labelAlign: 'right',
                                                    labelStyle: 'background-color: #EDEFF5 !important; font-size:12px;',
                                                    fieldStyle: 'font-family:gulim,times,courier,arial;font-size:12px;'
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'gridpanel',
                            multiSelect: false,
                            region: 'center',
                            id: 'grid1',
                            bodyBorder: true,
                            constrainHeader: true,
                            header: false,
                            store: 'PoReqStore',
                            title: '   ',
                            plugin: 'cellediting',
                            tbar: [ 
//                                   {
//                                      xtype: 'exporterbutton',
//                                      text: '엑셀다운로드',
//                                      title: '주문접수'
//                                   },
									{
                                      xtype: 'button',
                                      text: '엑셀다운로드',
                                      id: 'excelBtn'
                                   },
                                   {
                                   	xtype: 'checkboxfield',
                                   	boxLabel: 'HSAA',
                                   	id: 'chk_AA',
                                   	margin: '0 10 0 0',
                                   	value: true
                                   },
                                   {
                                   	xtype: 'checkboxfield',
                                   	boxLabel: 'HSAU',
                                   	id: 'chk_AU',
                                   	margin: '0 10 0 0',
                                   	value: true
                                   },
                                   {
                                   	xtype: 'checkboxfield',
                                   	boxLabel: 'HSAM',
                                   	id: 'chk_AM',
                                   	margin: '0 10 0 0',
                                   	value: true
                                   },
                           ],
                            columns: [
                                {
                                	xtype: 'rownumberer',
                                    width: 35
                                },
                                {
                                	xtype: 'gridcolumn',
                                    hidden: true,
                                    id: 'dummy',
                                    style: 'font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    dataIndex: 'dummy',
                                    text: 'dummy'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    id: 'PO_YN',
                                    style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    width: 100,
                                    dataIndex: 'PO_YN',
                                    text: '발주생성유무',
                                	align: 'center'
                                },
                                {
                                xtype: 'gridcolumn',
                                text: '해외법인',
                                columns: [
                                    {
                                        xtype: 'gridcolumn',
                                        id: 'PO_DT',
                                        style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                        width: 100,
                                        dataIndex: 'PO_DT',
                                        text: '발주일자',
                                		align: 'center'
                                    },
                                    {
                                    	xtype: 'gridcolumn',
                                    	id: 'PO_NO',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 90,
                                    	dataIndex: 'PO_NO',
                                    	text: '발주번호',
                                    	align: 'left'
                                    },
                                    {
                                    	xtype: 'numbercolumn',
                                    	format: '0.',
                                    	id: 'PO_SEQ',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 90,
                                    	dataIndex: 'PO_SEQ',
                                    	text: '발주순번',
                                    	align: 'right'
                                    },
                                    {
                                    	xtype: 'gridcolumn',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 50,
                                    	dataIndex: 'PLANT_CD',
                                    	align: 'center'
                                    },
                                    {
                                    	xtype: 'gridcolumn',
                                    	id: 'PLANT_CD',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 90,
                                    	dataIndex: 'PLANT_NM',
                                    	text: '공장구분',
                                    	align: 'left',
                                    	filter: { 			//필터
                                    		type : 'list',
                                        },
                                    },
                                    {
                                    	xtype: 'gridcolumn',
                                    	id: 'BP_ITEM_CD',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 120,
                                    	dataIndex: 'BP_ITEM_CD',
                                    	text: '해외법인<br>품목코드',
                                    	align: 'left'
                                    },
                                    {
                                    	xtype: 'gridcolumn',
                                    	id: 'ITEM_NM',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 200,
                                    	align: 'left',
                                    	dataIndex: 'ITEM_NM',
                                    	text: '품목명',
                                    	editor: {
                                    		xtype: 'textfield'
                                    	},
                                    },
                                    {
                                    	xtype: 'gridcolumn',
                                    	id: 'SPEC',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 123,
                                    	align: 'right',
                                    	dataIndex: 'SPEC',
                                    	text: '규격',
                                    	align: 'left'
                                    },
                                    {
//                                    xtype: 'gridcolumn',
                                    	xtype: 'numbercolumn',
                                    	id: 'SL_QTY',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 90,
                                    	dataIndex: 'SL_QTY',
                                    	text: '발주수량',
                                    	align: 'right',
                                    	format : '0,000' 
                                    },
                                    {
//                                    	xtype: 'gridcolumn',
                                    	xtype: 'numbercolumn',
                                    	id: 'SL_PRC',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 90,
                                    	dataIndex: 'SL_PRC',
                                    	text: '단가',
                                    	align: 'right',
                                    	format : '0.0000' 
                                    },
                                    {
//                                    xtype: 'gridcolumn',
                                    	xtype: 'numbercolumn',
                                    	id: 'SL_AMT',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 110,
                                    	dataIndex: 'SL_AMT',
                                    	text: '금액',
                                    	align: 'right',
                                    	format : '0,000' 
                                    },
                                    {
                                    	xtype: 'gridcolumn',
                                    	id: 'DLV_DT',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	width: 100,
                                    	dataIndex: 'DLV_DT',
                                    	text: '납기요청일',
                                    	align: 'center'
                                    },
                                    {
                                    	xtype: 'gridcolumn',
                                    	id: 'REMARK',
                                    	style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                    	align: 'left',
                                    	text: '비고',
                                    	dataIndex: 'REMARK'
                                    }
                                ]
                            },
                        	{
                            xtype: 'gridcolumn',
                            text: 'HSN',
                            columns: [
                                	{
                                		xtype: 'gridcolumn',
                                		id: 'ITEM_CD',
                                		style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                		width: 107,
                                		dataIndex: 'ITEM_CD',
                                		text: '품목코드',
                                		align: 'left'
                                	},
                                	{
                                		xtype: 'numbercolumn',
                                		id: 'BASE_SL_PRC',
                                		style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                		width: 90,
                                		dataIndex: 'BASE_SL_PRC',
                                		text: '기준단가',
                                		align: 'right',
                                		format: '0.0000'
                                	},
                                	{
                                		xtype: 'gridcolumn',
                                		id: 'M_BP_CD',
                                		style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                		width: 85,
                                		dataIndex: 'M_BP_CD',
                                		text: '매입처코드',
                                		align: 'left'
                                	},
                                	{
                                		xtype: 'gridcolumn',
                                		id: 'M_BP_NM',
                                		style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                		width: 150,
                                		dataIndex: 'M_BP_NM',
                                		text: '매입처명',
                                		align: 'left'
                                	},
                                	{
                                		xtype: 'numbercolumn',
                                		format: '0.0000',
                                		id: 'M_PRC',
                                		style: ' font-size:12px;font-family:times,courier,arial;font-weight:bold;text-align:center; background-color: #F8F8F8 !important',
                                		width: 107,
                                		dataIndex: 'M_PRC',
                                		text: '매입단가',
                                		align: 'right'
                                	}
                        		]
                        	}],
                            viewConfig: {
                              	enableTextSelection: true,
                              	columnLines: true,
                              	getRowClass: function(record, index) {
                                },
                            },
                            plugins: [
                                {
                                    ptype: 'cellediting',
                                    clicksToEdit: 1,
                                    listeners: {
                                        edit: 'onCellEditingEdit'
                                    }
                                },
                                {
                                    ptype: 'gridfilters' ///이부분
                                },
                                {
                                    ptype: 'gridexporter'
                                }
                            ],
                            selModel: {
                                selType: 'checkboxmodel',
                                listeners: {
                                    select: function(rowmodel, record, index, eOpts) {
                                        record.set('dummy', new Date());
                                    },
                                    
                                    deselect: function(rowmodel, record, index, eOpts) {
                                        record.set('dummy', '');
                                    }
                                }
                            }
                        }
                    ]
                }
            ]
        }
    ],
    
    onTxtunadtFromRender: function(component, eOpts){
////    	var year = new Date().getFullYear(); //2017
//    	var year = "01/01/" + (new Date().getFullYear());
//		var nows = new Date(year);
//		component.setValue(nows);
    	var nows = new Date();
		nows.setDate(nows.getDate() -30);
		component.setValue(nows);
	},

	onTxtunadtToRender: function(component, eOpts){
		var nows = new Date();
		nows.setDate(nows.getDate());
		component.setValue(nows);
	},
	
	//납기요청일
	onTxtunadtToRender1: function(component, eOpts){
		var nows = new Date();
		nows.setDate(nows.getDate() + 90);
		component.setValue(nows);
	},

    onCellEditingEdit: function(editor, context, eOpts) {
         //  alert(context.colIdx);

                if(context.colIdx===9)
                    {
                            var so_qtys=context.record.get('so_qty');
                            var so_prcs=context.record.get('so_prc');
                            var so_amts=so_qtys*so_prcs;
                            context.record.set('so_amt',so_amts);
                    }
    },
    onNumRender : function(value, metaData, record, rowIndex,colIndex, store, view){
	   Ext.util.Format.numberRenderer(value,'0.0000');
	   return value;            
	},
	onNumRender1 : function(value, metaData, record, rowIndex,colIndex, store, view){
		   Ext.util.Format.numberRenderer(value,'000,000');
		   return value;            
		}

        });