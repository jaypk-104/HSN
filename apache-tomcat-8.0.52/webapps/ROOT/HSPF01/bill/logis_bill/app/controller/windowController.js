/*
 * File: app/controller/windowController.js
 *
 * This file was generated by Sencha Architect version 4.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('LOGIS_BILL.controller.windowController', {
    extend: 'Ext.app.Controller',

    stores: [
        'MyStore'
    ],

    control: {
        "#W_excelBtn": {
            click: 'W_excelBtnClick'
        },
        "#windowCloseBtn": {
            click: 'windowCloseBtnClick'
        },
        "#printBtn": {
            click: 'printBtnClick'
        },
        "#W_codeSaveBtn": {
            click: 'W_codeSaveBtnClick'
        },
        "#W_erpBtn": {
            click: 'W_erpBtnClick'
        },
        "#fileGrid": {
            cellclick: 'onGridpanelCellClick'
        },
        "#fileSendTestBtn": {
            click: 'fileSendTestBtnClick'
        }
    },

    W_excelBtnClick: function(button, e, eOpts) {
        var currentDate = Ext.util.Format.date(new Date(), 'Y-m-d His');
        var grid = Ext.getCmp('windowGrid');
        grid.saveDocumentAs({
            type: 'xlsx',
            title: '세금계산서 세부항목', //엑셀내타이틀
            fileName: currentDate+'.xlsx' //엑셀파일이름
        });
    },

    windowCloseBtnClick: function(button, e, eOpts) {
        Ext.getCmp('myWindow').destroy();
    },

    printBtnClick: function(button, e, eOpts) {
        var V_BGM_1004 = Ext.getCmp('SERIAL_NUMBER').getValue();
        var myWin = new Ext.Window({
            title : '출력',
            html : '<iframe name="xxx" border =0 src="http://123.142.124.170:8080/aireport/on_server/LOGIS_BILL.jsp?V_BGM_1004='+V_BGM_1004+'" width="100%" height="100%"></iframe>',
            width : 1000,
            height : 768,
            modal : true
        });
        myWin.show();
        myWin.setSize(Ext.getBody().getViewSize());
        myWin.setPagePosition(0, 0);
    },

    W_codeSaveBtnClick: function(button, e, eOpts) {
        var grid = Ext.getCmp('windowGrid');
        var store = grid.getStore();


        Ext.MessageBox.confirm('확인', '코드를 저장 하시겠습니까?', function(btn) {
        	if (btn == 'yes') {
                store.sync({
                    params:{
                        V_TYPE : 'CODE_SAVE'
                    },
                    callback : function() {
                        store.reload();
                    }

                });
        	}
        });
    },

    W_erpBtnClick: function(button, e, eOpts) {
        var myMask = new Ext.LoadMask(Ext.getCmp('myWindow') , {msg:"ERP 전송 중"});
        var store = this.getMyStoreStore();

        if(Ext.getCmp('ERP_SEND_YN').getValue() == 'Y'){
            Ext.Msg.alert('확인', '이미 ERP 전송 된 데이터입니다.');
        }
        else{
            Ext.Msg.confirm('확인','ERP 전송 하시겠습니까?', function(button){
                if(button == 'yes') {
                    myMask.show();

                    Ext.Ajax.request({
                        url : 'sql/logis_bill.jsp',
                        method : 'post',
                        params : {
                            V_TYPE : 'ERP',
                            V_SERIAL_NUMBER : Ext.getCmp('SERIAL_NUMBER').getValue(),
                            V_USR_ID : parent.Ext.getCmp('GUSER_ID').getValue(),
                        },
                        success : function(response) {
                            var res = Ext.JSON.decode(response.responseText);
                            myMask.hide();
                            Ext.Msg.alert('확인', res.resultList[0].MSG);
                            if(res.resultList[0].SUCCESS_FLAG == '1'){
                                Ext.getCmp('ERP_SEND_YN').setValue('Y');
                            }

                            store.reload();
                        },
                        scope : this
                    });

                }
            });
        }


    },

    onGridpanelCellClick: function(tableview, td, cellIndex, record, tr, rowIndex, e, eOpts) {
        var V_FILE_NM = record.data['FILE_NAME'];
        var V_FILE_IN_SYSTEM_NM = record.data['FILE_IN_SYSTEM_NAME'];
        V_FILE_NM = encodeURI(V_FILE_NM);
        V_FILE_IN_SYSTEM_NM = encodeURI(V_FILE_IN_SYSTEM_NM);

        if(V_FILE_NM != null && V_FILE_IN_SYSTEM_NM != '') {
            var myWin=new Ext.Window(
                {
                    title : '파일다운로드',
                    //html : '<iframe name="xxx" border =0 src="/mro/admin/mroadinquirrec/sql/fileDown.do?V_FILE_NM='+file_nm+'&V_FILE_NM_PC='+file_nm_pc+'" width="1%" height="1%"></iframe>',
                    html : '<iframe name="xxx" border =0 src="sql/logis_bill_file.jsp?V_TYPE=D&V_FILE_NM='+V_FILE_NM+'&V_FILE_IN_SYSTEM_NM='+V_FILE_IN_SYSTEM_NM+'" width="1%" height="1%"></iframe>',
                    width :500,
                    height:500
                });
            myWin.show();
            myWin.hide();

        }
    },

    fileSendTestBtnClick: function(button, e, eOpts) {
        var store = Ext.getCmp('fileGrid').getStore();
        var allRecord = store.getRange();
        for(var i = 0 ; i < allRecord.length ; i ++){
            allRecord[i].set('V_TYPE','CP');
        }

        store.sync({
            params:{
                V_TYPE : 'CP'
            }
        });
    }

});
