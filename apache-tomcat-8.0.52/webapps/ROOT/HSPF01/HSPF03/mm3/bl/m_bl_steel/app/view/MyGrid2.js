/*
 * File: app/view/MyGrid2.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('M_BL_STEEL.view.MyGrid2', {
    extend: 'Ext.grid.Panel',
    alias: 'widget.mygrid2',

    requires: [
        'M_BL_STEEL.view.MyGrid2ViewModel',
        'Ext.view.Table',
        'Ext.grid.column.RowNumberer',
        'Ext.form.field.Text',
        'Ext.grid.column.Number',
        'Ext.selection.CheckboxModel',
        'Ext.grid.plugin.Exporter',
        'Ext.grid.plugin.CellEditing'
    ],

    config: {
        tbar: [
			{
			    id: 'gridAddBtn2',
			    text: '',
			    margin: '0 3 0 0',
			    glyph: 'xf055@FontAwesome',
			    iconCls: 'grid-add-btn',
//			    disabled: true
			},
			{
			    id: 'gridDelBtn2',
			    text: '',
			    margin: '0 3 0 0',
			    glyph: 'xf056@FontAwesome',
			    iconCls: 'grid-del-btn',
//			    disabled: true
			},
			{
               	id: 'gridSaveBtn',
               	xtype: 'button',
               	glyph: 'xf0c7@FontAwesome',
               	iconCls: 'grid-save-btn',
               	margin: '0 3 0 0'
           },
            {
                xtype: 'container',
                flex: 1
            },
            {
                xtype: 'button',
                glyph: 'xf1c3@FontAwesome',
                id: 'xlsxDown1',
                cfg: {
                    type: 'excel07',
                    ext: 'xlsx'
                },
                iconCls: 'grid-excel-btn',
                margin: '0 3 0 0',
                
            }
        ]
    },

    viewModel: {
        type: 'mygrid2'
    },
    id: 'myGrid2',
    style: 'border: 1px solid #659DDC; padding: 5px;',
    bodyBorder: false,
    header: false,
    store: 'MyStore2',
    columns: [
        {
            xtype: 'rownumberer',
            width: 40
        },
        {
            xtype: 'gridcolumn',
            hidden: true,
            dataIndex: 'V_TYPE',
            text: 'V_TYPE'
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'ITEM_GROUP_CD',
        	enableTextSelection: true,
        	text: '품목그룹코드',
        	width: 170,
        	hidden: true
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'BL_SEQ2',
        	enableTextSelection: true,
        	text: 'BL_SEQ2',
        	width: 100,
        	hidden: true
        },
        {
            xtype: 'gridcolumn',
            style: 'text-align: center; font-weight: bold;  ',
            sortable: true,
            dataIndex:'ST_TYPE',
            enableTextSelection: true,
            text: '강종',
            width: 100
        },
        {
            xtype: 'gridcolumn',
            style: 'text-align: center; font-weight: bold; color: #3367d6',
            sortable: true,
            dataIndex: 'ST_TYPE_NM',
            enableTextSelection: true,
            text: '강종명',
            width: 140,
            editor: {
        		xtype: 'combobox',
        		displayField: 'DTL_NM',
        		autoLoadOnValue: false,
        		valueField: 'DTL_NM',
        		editable: false,
        		store:'StStore',
              	listConfig: {
                    itemTpl: [
                        '<div>{DTL_NM} ({DTL_CD})</div>'
                    ],
                }
        	},
        },
        {
            xtype: 'gridcolumn',
            style: 'text-align: center; font-weight: bold;  color: #3367d6',
            sortable: true,
            dataIndex: 'SPEC1',
            enableTextSelection: true,
            text: '스펙1',
            width: 100,
            editor: {
            	xtype: 'textfield'
            }
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;  color: #3367d6',
        	sortable: true,
        	dataIndex: 'SPEC2',
        	enableTextSelection: true,
        	text: '스펙2',
        	width: 100,
            editor: {
            	xtype: 'textfield'
            }
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;  color: #3367d6',
        	sortable: true,
        	dataIndex: 'SPEC3',
        	enableTextSelection: true,
        	text: '스펙3',
        	width: 100,
            editor: {
            	xtype: 'textfield'
            },
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;  color: #3367d6',
        	sortable: true,
        	dataIndex: 'LENGTH',
        	enableTextSelection: true,
//        	text: '길이', //원래 길이로 쓸려고 했으나 스펙4로 변경하기로함.
        	text: '스펙4',
        	width: 100,
            editor: {
            	xtype: 'textfield'
            }
        },
        {
            xtype: 'gridcolumn',
            style: 'text-align: center; font-weight: bold;',
            sortable: true,
            dataIndex: 'UNIT',
            enableTextSelection: true,
            text: '단위',
            width: 80,
            hidden: true
        },
        {
            xtype: 'gridcolumn',
            style: 'text-align: center; font-weight: bold; color: #3367d6',
            sortable: true,
            dataIndex:'BON_QTY',
            enableTextSelection: true,
            width: 100,
            align: 'right',
            text: '본수',
            editor: {
            	xtype: 'textfield'
            },
            summaryType: 'sum',
            summaryRenderer: function (value, summaryData, dataIndex) {
	            return "<font color='green'>"+Ext.util.Format.number(value, '0,000')+"<font>"; 
	        },
        },
        {
            xtype: 'numbercolumn',
            style: 'text-align: center; font-weight: bold;  color: #3367d6',
            text: '수량',
            format: '0,000.00',
            align: 'right', 
            dataIndex: 'QTY',
            summaryType: 'sum',
            summaryRenderer: function (value, summaryData, dataIndex) {
	            return "<font color='green'>"+Ext.util.Format.number(value, '0,000.00')+"<font>"; 
	        },
            editor: {
            	xtype: 'numberfield',
            	decimalPrecision: 4,
            	align: 'right'
            },
            width: 130
        },
        {
            xtype: 'numbercolumn',
            style: 'text-align: center; font-weight: bold; ',
            text: '단위중량',
            format: '0,000.00',
            align: 'right',
            dataIndex: 'BON_WGT_UNIT',
            editor: {
            	xtype: 'numberfield',
            	decimalPrecision: 4,
            	align: 'right'
            },
//            summaryType: 'sum',
//            summaryRenderer: function (value, summaryData, dataIndex) {
//	            return "<font color='green'>"+Ext.util.Format.number(value, '0,000.00')+"<font>"; 
//	        },
        },
        {
            xtype: 'numbercolumn',
            style: 'text-align: center; font-weight: bold; color: #3367d6',
            text: '단가',
            dataIndex:'PRICE',
            format: '0,000.00',
            align: 'right',
            editor: {
            	xtype: 'numberfield',
            	decimalPrecision: 6,
            	align: 'right'
            },
        },
        {
            xtype: 'numbercolumn',
            style: 'text-align: center; font-weight: bold;  color: #3367d6',
            text:'외화금액',
            dataIndex:'DOC_AMT',
            format: '0,000.00',
            align: 'right',
            summaryType: 'sum',
            summaryRenderer: function (value, summaryData, dataIndex) {
	            return "<font color='green'>"+Ext.util.Format.number(value, '0,000.00')+"<font>"; 
	        },
	        width: 130,
            editor: {
            	xtype: 'numberfield',
            	align: 'right',
            	decimalPrecision: 6,
            },
        },
        {
        	xtype: 'numbercolumn',
        	style: 'text-align: center; font-weight: bold; color: #3367d6; ',
        	text:'자국금액',
        	dataIndex:'LOC_AMT',
        	align: 'right',
        	format: '0,000',
        	summaryType: 'sum',
        	summaryRenderer: function (value, summaryData, dataIndex) {
        		return "<font color='green'>"+Ext.util.Format.number(value, '0,000')+"<font>"; 
        	},
        	width: 130,
        	editor: {
            	xtype: 'numberfield',
            	align: 'right',
            	decimalPrecision: 0,
            },
        },
        {
            xtype: 'gridcolumn',
            style: 'text-align: center; font-weight: bold;',
            sortable: true,
            dataIndex: 'ITEM_CD',
            enableTextSelection: true,
            text: '품목코드',
            width: 200
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'ITEM_NM',
        	enableTextSelection: true,
        	text: '품목명',
        	width: 100
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'BL_NO',
        	enableTextSelection: true,
        	text: 'B/L NO',
        	width: 150
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'BL_SEQ',
        	enableTextSelection: true,
        	text: 'BL_SEQ',
        	width: 100
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'PO_NO',
        	enableTextSelection: true,
        	text: 'PO_NO',
        	width: 150
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'PO_SEQ',
        	enableTextSelection: true,
        	text: 'PO_SEQ',
        	width: 100
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'LC_NO',
        	enableTextSelection: true,
        	text: 'LC_NO',
        	width: 150
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'LC_SEQ',
        	enableTextSelection: true,
        	text: 'LC_SEQ',
        	width: 100
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'CHARGE_YN',
        	enableTextSelection: true,
        	text: '경비유무',
        	align: 'center'
        },
        {
        	xtype: 'gridcolumn',
        	style: 'text-align: center; font-weight: bold;',
        	sortable: true,
        	dataIndex: 'CC_YN',
        	enableTextSelection: true,
        	text: '통관유무',
        	align: 'center'
        },
    ],
    selModel: {
        selType: 'checkboxmodel',
        checkOnly: true,
        listeners: {
        	select: function(rowmodel, record, index, eOpts) {
        		record.set('V_TYPE', 'V');
        	},
        	deselect: function(rowmodel, record, index, eOpts) {
        		record.set('V_TYPE', '');
        	}
        }
    },
    plugins: [
        {
            ptype: 'gridexporter'
        },
        {
            ptype: 'clipboard'
        },
        {
            ptype: 'cellediting',
            clicksToEdit: 2,
            listeners: {
            	beforeedit: function(editor, context, eOpts) {
            		if(Ext.getCmp('myGrid1').getSelectionModel().getSelection().length > 0 &&
            				context.field == 'ST_TYPE_NM') {
            			var StStore  = Ext.getStore('StStore');
                    	StStore.load(
        					{   
        						params: 
        						{
        							V_MAST_CD : 'ST',
        							V_PARAM1 :  Ext.getCmp('myGrid1').getSelectionModel().getSelection()[0].get('ITEM_CD'),
        							V_GRID: 'Y' 
        						},
        					});
            		}
            		
            	},
            	edit: function(editor, context, eOpts) {
            		var QTY = context.record.get('QTY').toFixed(4);
        			var PRICE = context.record.get('PRICE').toFixed(2);
        			var DOC_AMT = context.record.get('DOC_AMT').toFixed(2);
        			
        			var XCH_RATE = Ext.getCmp('V_XCH_RATE').getValue().toFixed(2);
            		
            		if(context.field == 'QTY' || context.field == 'PRICE') {
            			context.record.set('DOC_AMT', QTY * PRICE);
            			context.record.set('LOC_AMT', (QTY * PRICE * XCH_RATE).toFixed(0));
            		}
            		
            		if(context.field == 'DOC_AMT') {
            			context.record.set('LOC_AMT', (DOC_AMT * XCH_RATE).toFixed(0));
            		}
            		
            		if(context.field == 'SPEC1' || context.field == 'SPEC2' || context.field == 'SPEC3') {
            			if(context.value.length > 4){
            				Ext.Msg.alert('확인', '4자리 수를 초과할 수 없습니다.');
            				context.record.set(context.field, context.originalValue);
            			}
            		}
            		
            		if(context.field == 'LENGTH') {
            			if(context.value.length > 2){
            				Ext.Msg.alert('확인', '2자리 수를 초과할 수 없습니다.');
            				context.record.set(context.field, context.originalValue);
            			}
            		}
            	}
            }
        }
    ],
    viewConfig: {
    	enableTextSelection: true,
    },
    features : [ {
		ftype : 'summary',
		dock: 'bottom'
	} ],


});