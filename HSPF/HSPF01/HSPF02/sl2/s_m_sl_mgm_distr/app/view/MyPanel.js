/*
 * File: app/view/MyPanel.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('S_M_SL_MGM_DISTR.view.MyPanel', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.mypanel',

    requires: [
        'S_M_SL_MGM_DISTR.view.MyPanelViewModel',
        'Ext.grid.Panel',
        'Ext.grid.column.RowNumberer',
        'Ext.grid.column.Number',
        'Ext.view.Table',
        'Ext.selection.CheckboxModel',
        'Ext.grid.plugin.Exporter',
        'Ext.grid.plugin.CellEditing'
    ],

    viewModel: {
        type: 'mypanel'
    },
    itemId: 'mypanel',
    layout: 'fit',
    header: false,
    title: 'Tab 1',

    items: [
        {
            xtype: 'container',
            flex: 1,
            layout: {
                type: 'vbox',
                align: 'stretch'
            },
            items: [
            	{
                    xtype: 'fieldcontainer',
                    height: 35,
                    maxHeight: 35,
                    minHeight: 35,
                    width: 400,
                    margin: '10 0 10 0',
                    layout: {
                        type: 'hbox',
                        align: 'stretch'
                    },
                    items: [
//                    	{
//                            margin: '0 0 0 30',
//                            maxWidth: 300,
//                            minWidth: 300,
//                            width: 300,
//                            fieldLabel: '<span style=\'color:red\'>*</span>창고코드',
//                            labelWidth: 80,
//                            name: 'search_field',
//
//                    		xtype: 'combobox',
//                    		displayField: 'DTL_CD',
//                    		autoLoadOnValue: true,
//                    		valueField: 'DTL_CD',
//                            id: 'V_SL_CD',
//                    		store: Ext.create('Ext.data.Store',{
//                    			autoLoad: true,
//                    			storeId: 'sl_combo22',
//                    			proxy: {
//                    		           type: 'ajax',
//                    		           extraParams: {
//                    		            	V_MAST_CD: 'SL_DISTR',
//                    		            	V_GRID: 'Y'
//                    		           },	
//                    		           api: {
//                    		               read: '/HSPF01/common/sql/Combobox.jsp'
//                    		           },
//                    		           reader: {
//                    		               type: 'json',
//                    		               rootProperty: 'resultList'
//                    		           }
//                    		       }
//                    		}),
//                    		listeners: {
//                    			change: function(field, newValue, oldValue, eOpts) {
//                    				if((newValue != undefined) || (newValue != null)) {
//                    					Ext.getCmp('V_SL_NM').setValue(field.selection.data.DTL_NM);
//                    				}
//                    			}
//                    		},
//                    		listConfig: {
//                                itemTpl: [
//                                    '<div>{DTL_CD} ({DTL_NM})</div>'
//                                ]
//                            }
//                        },
                        {
                            xtype: 'textfield',
                            margin: '0 0 0 30',
                            maxWidth: 230,
                            minWidth: 230,
                            width: 230,
                            fieldLabel: '창고명',
                            labelWidth: 80,
                            name: 'search_field',
                            id: 'V_SL_NM'
                        },
                    ]
            	},
                {
                    xtype: 'gridpanel',
                    flex: 1,
                    style: 'border: 1px solid lightgray; padding: 5px;',
                    header: false,
                    title: 'My Grid Panel',
                    id: 'myGrid',
                    store: 'MyStore',
	                tbar: [
	                	{
	                        id: 'gridAddBtn',
	                        text: '',
	                        margin: '0 3 0 0',
	                        glyph: 'xf055@FontAwesome',
	                        iconCls: 'grid-add-btn',
	                        hidden: true
	                    },
	                    {
	                        id: 'gridDelBtn',
	                        text: '',
	                        margin: '0 3 0 0',
	                        glyph: 'xf056@FontAwesome',
	                        iconCls: 'grid-del-btn',
	                        hidden: true
	                    },
	                    {
	                    	disabledCls: 'af-item-disabled',
	                        xtype: 'combobox',
	                        flex: 1,
	                        margin: '0 5 0 5',
	                        maxWidth: 210,
	                        minWidth: 210,
	                        width: 210,
	                        fieldLabel: '수금구분',
	                        labelWidth: 60,
	                        id: 'V_ISSUE_DT',
	                        value: 'NM10',
	                        displayField: 'DTL_NM',
	                        valueField: 'DTL_CD',
	                        editable: false,
	                        fieldStyle: 'background-color: #ffefbb',
	                        store : Ext.create('Ext.data.Store',{
	        					fields : ['DTL_NM','DTL_CD'],
	        					data : [['익월 10일','NM10'],['익월 30일','NM30']]
	                        }),
	                    },
	                    {
	                       	id: 'gridSaveBtn',
	                       	xtype: 'button',
	                       	glyph: 'xf0c7@FontAwesome',
	                      	iconCls: 'grid-save-btn',
	                      	margin: '0 3 0 0'
	                    },
	                    {
	                    	xtype: 'container',
	                    	flex: 1
	                    },
	                  /*  {
                            xtype: 'datefield',
                            maxWidth: 200,
                            minWidth: 200,
                            width: 200,
                            fieldLabel: '전표일자',
                            labelWidth: 60,
                            editable: false,
                            format: 'Y-m-d',
                            id: 'V_TEMP_GL_DT',
                        },
	                    {
	                  	   xtype: 'button',
	                  	   id: 'slIvCfmBtn',
	                  	   margin: '0 3 0 0',
	                  	   text: 'ERP전표생성',
	                  	   style: 'background-color: white; border: 0.5px solid #3367d6;',
	                  	   cls: 'blue-btn',
	                     },
	                     {
	                  	   xtype: 'button',
	                  	   id: 'slIvCancelBtn',
	                  	   margin: '0 3 0 0',
	                  	   text: 'ERP전표취소',
	                  	   style: 'background-color: white; border: 0.5px solid #3367d6;',
	                  	   cls: 'blue-btn',
	                     },*/
	                    {
	                    	xtype: 'button',
	                    	glyph: 'xf1c3@FontAwesome',
	                    	id: 'xlsxDown',
	                    	cfg: {
	                    		type: 'excel07',
	                    		ext: 'xlsx'
	                    	},
	                    	iconCls: 'grid-excel-btn',
	                    }
	                ],
                    columns: [
                        {
                            xtype: 'rownumberer',
                            width: 40
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                            width: 114,
                            dataIndex: 'V_TYPE',
                            text: 'V_TYPE',
                            hidden: true
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                            width: 150,
                            dataIndex: 'SL_CD',
                            text: '창고코드',
                            hidden: true
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                            width: 200,
                            dataIndex: 'SL_NM',
                            text: '창고',
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                            width: 75,
                            dataIndex: 'S_BP_CD',
                            text: '수주처코드',
                            emptyCellText: '(Double Click)',
                            editor: {
                                xtype: 'textfield',
                                allowBlank: false,
                                editable: false,
                                listeners: {
                                    afterrender: function(c) {
                                    	c.getEl().on('dblclick', function() {
                                    		var popup = Ext.create("Popup.view.WinBpPop");
                                            popup.show();
                                            
                                            var store = Ext.getStore('WinBpPopStore');
                                    		store.removeAll();
                                    		
                                    		Ext.getCmp('fieldType').setValue('B_STORAGE_DISTR');
                                        });
                                    }
                                }
                            },
                        	filter: { //필터
                        		type : 'list',
                            },
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                            width: 230,
                            dataIndex: 'S_BP_NM',
                            text: '수주처',
                        	filter: { //필터
                        		type : 'list',
                            },
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                            width: 75,
                            dataIndex: 'M_BP_CD',
                            text: '매출처코드',
                            emptyCellText: '(Double Click)',
                            editor: {
                                xtype: 'textfield',
                                allowBlank: false,
                                editable: false,
                                listeners: {
                                    afterrender: function(c) {
                                    	c.getEl().on('dblclick', function() {
                                    		var popup = Ext.create("Popup.view.WinBpPop");
                                            popup.show();
                                            
                                            var store = Ext.getStore('WinBpPopStore');
                                    		store.removeAll();
                                    		
                                    		Ext.getCmp('fieldType').setValue('M_CHARGE_DISTB1');
                                        });
                                    }
                                }
                            },
                        	filter: { //필터
                        		type : 'list',
                            },
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                            width: 230,
                            dataIndex: 'M_BP_NM',
                            text: '매출처',
                        	filter: { //필터
                        		type : 'list',
                            },
                        },
                        {
                            xtype: 'numbercolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                            width: 110,
                            align: 'end',
                            dataIndex: 'SL_AMT',
                            text: '창고료',
                            format: '0,000',
                            editor: {
                        		xtype: 'numberfield',
                        		format: '0,000',
                        		align: 'right',
                        		editable: true,
                        	},
                        	summaryType: 'sum',
                            summaryRenderer: function (value, summaryData, dataIndex) {
                	            return "<font color='green'>"+Ext.util.Format.number(value, '0,000')+"<font>"; 
                	        },
                        },
                        {
                            xtype: 'numbercolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                            width: 110,
                            align: 'end',
                            dataIndex: 'VAT_AMT',
                            text: '부가세',
                            format: '0,000',
                            editor: {
                        		xtype: 'numberfield',
                        		format: '0,000',
                        		align: 'right',
                        		editable: true
                        	},
                        	summaryType: 'sum',
                            summaryRenderer: function (value, summaryData, dataIndex) {
                	            return "<font color='green'>"+Ext.util.Format.number(value, '0,000')+"<font>"; 
                	        },
                        }, 
                        {
                        	xtype: 'gridcolumn',
                        	style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                        	width: 150,
                        	dataIndex: 'VAT_TYPE',
                        	text: '부가세유형',
                        	editor: {
                        		xtype: 'combobox',
                        		displayField: 'DTL_NM',
                        		autoLoadOnValue: true,
                        		valueField: 'DTL_CD',
//                        		editable: false,
                        		store: Ext.create('Ext.data.Store',{
                        			autoLoad: true,
                        			storeId: 'storev',
                        			proxy: {
                        		           type: 'ajax',
                        		           extraParams: {
                        		            	V_MAST_CD: 'BA05',
                        		            	V_GRID: 'Y'
                        		           },	
                        		           api: {
                        		               read: '/HSPF01/common/sql/Combobox.jsp'
                        		           },
                        		           reader: {
                        		               type: 'json',
                        		               rootProperty: 'resultList'
                        		           }
                        		       }
                        		}),
                	        	listConfig: {
                                    itemTpl: [
                                              '<div>{DTL_NM} ({DTL_CD}) </div>'
                                              ],
                                      }
                        	},
                        	renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                if(Ext.data.StoreManager.lookup('storev').findRecord('DTL_CD',value) !==null)
                                {
                                    return Ext.data.StoreManager.lookup('storev').findRecord('DTL_CD',value).get('DTL_NM');
                                }
                                return value;
                            },
                        },
                     /*   {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                            width: 80,
                            align: 'center',
                            dataIndex: 'GL_YN',
                            text: '전표유무',
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold;',
                            width: 150,
                            align: 'center',
                            dataIndex: 'TEMP_GL_NO',
                            text: '전표번호',
                        },*/
                        {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold; ',
                            width: 130,
                            dataIndex: 'SALE_ISSUE_DT',
                            text: '수금만기일',
                        },
                        {
                            xtype: 'gridcolumn',
                            style: 'font-size: 12px; text-align: center; font-weight: bold; color: #3367d6',
                            width: 230,
                            dataIndex: 'REMARK',
                            text: '비고',
                            editor: {
                        		xtype: 'textfield',
                        		editable: true
                        	},
                        },
                    ],
               /*    selModel: {
                        selType: 'checkboxmodel',
                        checkOnly: true,
                        listeners: {
                        	select: function(rowmodel, record, index, eOpts) {
                        		record.set('V_TYPE', 'V');
                        	},
                        	deselect: function(rowmodel, record, index, eOpts) {
                        		record.set('V_TYPE', '');
                        	}
                        }
                    },*/
                    viewConfig: {
                    	enableTextSelection: true,
                        },
                    plugins: [
                        {
                            ptype: 'gridexporter'
                        }, {
                    		ptype : 'cellediting',
                    	    clicksToEdit: 1,
                    	    listeners : {
        						afteredit : function(e) {
        							var rec = e.grid.getSelection()[0];
        							var field = e.context.field;
        							var val = e.context.value;
        							if (field == 'SL_AMT' && rec != undefined) {
        								if(val === 0){
        									rec.set('VAT_AMT', 0);
        								} else {
        									var vatAmt = Math.floor(val/10);
            								rec.set('VAT_AMT', vatAmt);
        								}
        							}
        						},
        						beforeedit: function (e, editor) {
        							var rec = editor.record.data;
        							var field = editor.field;

        							if(rec.GL_YN === 'Y'){
        						    	return false;
        							}
        					    	
        					        return true;
        					    }
        					},
                    	}
                    ],
                	features : [ {
                		ftype: 'summary',
                        dock: 'bottom'
                	} ],
                }
            ]
        }
    ]

});